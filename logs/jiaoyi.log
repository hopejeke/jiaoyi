2025-10-27 09:18:42 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 42292 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 09:18:42 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 09:18:42 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 09:18:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 09:18:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 09:18:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 14 ms. Found 0 Redis repository interfaces.
2025-10-27 09:18:44 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 09:18:44 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 09:18:44 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 09:18:44 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 09:18:44 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2294 ms
2025-10-27 09:18:44 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 09:18:44 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 09:18:45 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 09:18:45 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 09:18:45 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 27 mappings in 'requestMappingHandlerMapping'
2025-10-27 09:18:45 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 09:18:45 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 09:18:45 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 09:18:46 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 09:18:46 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 09:18:46 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 4.945 seconds (process running for 5.834)
2025-10-27 09:18:46 [RMI TCP Connection(6)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@40800d32
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@5245b594
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 09:18:46 [RMI TCP Connection(3)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-27 09:18:46 [RMI TCP Connection(6)-192.168.0.120] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@5990e53e
2025-10-27 09:18:46 [RMI TCP Connection(6)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 10:32:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:32:07 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 10:32:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 10:32:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 10:32:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 10:32:07 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:32:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 10:32:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 10:32:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 10:32:07 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 10:32:10 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:32:10 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:32:10 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:E/MwhjvhMv/W2YR7t2f1bg==
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:32:11.211131(LocalDateTime)
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: NEWUSER100
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: NEWUSER100(String)
2025-10-27 10:32:11 [http-nio-8080-exec-5] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: Table 'jiaoyi.coupons' doesn't exist
### The error may exist in file [D:\软件\ideaproject\jiaoyi\target\classes\mapper\CouponMapper.xml]
### The error may involve com.jiaoyi.mapper.CouponMapper.selectByCouponCode-Inline
### The error occurred while setting parameters
### SQL: SELECT           id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount,         status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products,         start_time, end_time, create_time, update_time               FROM coupons         WHERE coupon_code = ?
### Cause: java.sql.SQLSyntaxErrorException: Table 'jiaoyi.coupons' doesn't exist
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy93.selectOne(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectOne(SqlSessionTemplate.java:160)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:87)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy94.selectByCouponCode(Unknown Source)
	at com.jiaoyi.service.CouponService.getCouponByCode(CouponService.java:33)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:713)
	at com.jiaoyi.service.CouponService$$SpringCGLIB$$0.getCouponByCode(<generated>)
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:97)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Table 'jiaoyi.coupons' doesn't exist
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy136.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:65)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:80)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:65)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectOne(DefaultSqlSession.java:75)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 102 common frames omitted
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:32:11.486206600(LocalDateTime)
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:32:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:32:11 [http-nio-8080-exec-5] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: Table 'jiaoyi.coupons' doesn't exist
### The error may exist in file [D:\软件\ideaproject\jiaoyi\target\classes\mapper\CouponMapper.xml]
### The error may involve com.jiaoyi.mapper.CouponMapper.selectByCouponCode-Inline
### The error occurred while setting parameters
### SQL: SELECT           id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount,         status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products,         start_time, end_time, create_time, update_time               FROM coupons         WHERE coupon_code = ?
### Cause: java.sql.SQLSyntaxErrorException: Table 'jiaoyi.coupons' doesn't exist
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy93.selectOne(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectOne(SqlSessionTemplate.java:160)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:87)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy94.selectByCouponCode(Unknown Source)
	at com.jiaoyi.service.CouponService.getCouponByCode(CouponService.java:33)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:713)
	at com.jiaoyi.service.CouponService$$SpringCGLIB$$0.getCouponByCode(<generated>)
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:97)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Table 'jiaoyi.coupons' doesn't exist
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy136.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:65)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:80)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:65)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectOne(DefaultSqlSession.java:75)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 102 common frames omitted
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: <EOL><EOL>### Error querying database.  Cause: java.sql.SQLSyntaxError (truncated)...]
2025-10-27 10:32:11 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:E/MwhjvhMv/W2YR7t2f1bg==
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:33:31.948693900(LocalDateTime)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: NEWUSER100
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: NEWUSER100(String)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] WARN  com.jiaoyi.service.CouponService - 优惠券不在有效期内，当前时间: 2025-10-27T10:33:31.956260800, 开始时间: 2024-01-01T00:00, 结束时间: 2024-12-31T23:59:59
2025-10-27 10:33:31 [http-nio-8080-exec-2] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:33:31.961243800(LocalDateTime)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:33:31 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:33:31 [http-nio-8080-exec-2] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 10:33:31 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:E/MwhjvhMv/W2YR7t2f1bg==
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:33:52.891494800(LocalDateTime)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] WARN  com.jiaoyi.service.CouponService - 优惠券不在有效期内，当前时间: 2025-10-27T10:33:52.895477600, 开始时间: 2024-01-01T00:00, 结束时间: 2024-12-31T23:59:59
2025-10-27 10:33:52 [http-nio-8080-exec-6] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 10:33:52 [http-nio-8080-exec-6] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:33:52.898467700(LocalDateTime)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:33:52 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:33:52 [http-nio-8080-exec-6] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 10:33:52 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:E/MwhjvhMv/W2YR7t2f1bg==
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:33:54.908602500(LocalDateTime)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] WARN  com.jiaoyi.service.CouponService - 优惠券不在有效期内，当前时间: 2025-10-27T10:33:54.912589800, 开始时间: 2024-01-01T00:00, 结束时间: 2024-12-31T23:59:59
2025-10-27 10:33:54 [http-nio-8080-exec-7] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 10:33:54 [http-nio-8080-exec-7] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:33:54.915582600(LocalDateTime)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:33:54 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:33:54 [http-nio-8080-exec-7] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 10:33:54 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:E/MwhjvhMv/W2YR7t2f1bg==
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:34:15.465868800(LocalDateTime)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] WARN  com.jiaoyi.service.CouponService - 订单金额不满足优惠券最低消费要求，订单金额: 60, 最低消费: 300.00
2025-10-27 10:34:15 [http-nio-8080-exec-8] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 10:34:15 [http-nio-8080-exec-8] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:34:15.474838900(LocalDateTime)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:34:15 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:34:15 [http-nio-8080-exec-8] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 10:34:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:34:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:34:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:34:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:E/MwhjvhMv/W2YR7t2f1bg==
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:34:17.480018600(LocalDateTime)
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] WARN  com.jiaoyi.service.CouponService - 订单金额不满足优惠券最低消费要求，订单金额: 60, 最低消费: 300.00
2025-10-27 10:34:17 [http-nio-8080-exec-9] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 10:34:17 [http-nio-8080-exec-9] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:34:17.485001700(LocalDateTime)
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:34:17 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:34:17 [http-nio-8080-exec-9] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 10:34:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:36:37 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 10:36:37 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 10:36:37 [http-nio-8080-exec-1] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 10:36:37 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 10:36:37 [http-nio-8080-exec-1] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:36:37 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 10:36:37 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 10:36:37 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 10:36:37 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 10:36:39 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 10:36:39 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 10:36:39 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 10:36:39 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 10:36:39 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:36:39 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 10:36:39 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 10:36:39 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 10:36:39 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 10:36:42 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-27 10:36:42 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-27 10:36:48 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 25764 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 10:36:48 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 10:36:48 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 10:36:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 10:36:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 10:36:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-10-27 10:36:49 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 10:36:49 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 10:36:49 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 10:36:49 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 10:36:49 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1337 ms
2025-10-27 10:36:49 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 10:36:49 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 10:36:49 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 10:36:50 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 10:36:50 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 27 mappings in 'requestMappingHandlerMapping'
2025-10-27 10:36:50 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 10:36:50 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 10:36:50 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 10:36:51 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 10:36:51 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 10:36:51 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 3.333 seconds (process running for 4.045)
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 10:36:51 [RMI TCP Connection(2)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@5a31b055
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@42cf893
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 10:36:51 [RMI TCP Connection(1)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-10-27 10:36:51 [RMI TCP Connection(2)-192.168.0.120] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@3111262e
2025-10-27 10:36:51 [RMI TCP Connection(2)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 10:37:20 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:37:20 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 10:37:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 10:37:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 10:37:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 10:37:20 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:37:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 10:37:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 10:37:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 10:37:20 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:37:22.735277100(LocalDateTime)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: NEWUSER100
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: NEWUSER100(String)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] WARN  com.jiaoyi.service.CouponService - 优惠券不在有效期内，当前时间: 2025-10-27T10:37:22.750325100, 开始时间: 2024-01-01T00:00, 结束时间: 2024-12-31T23:59:59
2025-10-27 10:37:22 [http-nio-8080-exec-2] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:37:22.755314(LocalDateTime)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:37:22 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:37:22 [http-nio-8080-exec-2] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 10:37:22 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:37:50.175421(LocalDateTime)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615326701774804(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T10:37:50.192603100(LocalDateTime), 2025-10-27T10:37:50.192603100(LocalDateTime)
2025-10-27 10:37:50 [http-nio-8080-exec-4] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
org.springframework.jdbc.BadSqlGrammarException: 
### Error updating database.  Cause: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
### The error may exist in file [D:\软件\ideaproject\jiaoyi\target\classes\mapper\OrderMapper.xml]
### The error may involve com.jiaoyi.mapper.OrderMapper.insert-Inline
### The error occurred while setting parameters
### SQL: INSERT INTO orders (             order_no, user_id, status, total_amount, coupon_id, coupon_code,              discount_amount, actual_amount, receiver_name, receiver_phone,              receiver_address, remark, create_time, update_time         ) VALUES (             ?, ?, ?, ?, ?, ?,             ?, ?, ?, ?,             ?, ?, ?, ?         )
### Cause: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy93.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy101.insert(Unknown Source)
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:136)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy136.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:48)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:75)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 96 common frames omitted
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:37:50.364346200(LocalDateTime)
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:37:50 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:37:50 [http-nio-8080-exec-4] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
org.springframework.jdbc.BadSqlGrammarException: 
### Error updating database.  Cause: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
### The error may exist in file [D:\软件\ideaproject\jiaoyi\target\classes\mapper\OrderMapper.xml]
### The error may involve com.jiaoyi.mapper.OrderMapper.insert-Inline
### The error occurred while setting parameters
### SQL: INSERT INTO orders (             order_no, user_id, status, total_amount, coupon_id, coupon_code,              discount_amount, actual_amount, receiver_name, receiver_phone,              receiver_address, remark, create_time, update_time         ) VALUES (             ?, ?, ?, ?, ?, ?,             ?, ?, ?, ?,             ?, ?, ?, ?         )
### Cause: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy93.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy101.insert(Unknown Source)
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:136)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy136.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:48)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:75)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 96 common frames omitted
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: <EOL><EOL>### Error updating database.  Cause: java.sql.SQLSyntaxError (truncated)...]
2025-10-27 10:37:50 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:38:22 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:38:22 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:38:22 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 400(Integer), 410(Integer), 下单锁定库存(String), 2025-10-27T10:38:24.537859(LocalDateTime)
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:38:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:38:24 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:38:51 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 10:38:51 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 10:38:51 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 10:38:56 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 10:39:01 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 10:39:24 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615327045397717(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T10:39:26.893184200(LocalDateTime), 2025-10-27T10:39:26.893184200(LocalDateTime)
2025-10-27 10:39:26 [http-nio-8080-exec-5] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
org.springframework.jdbc.BadSqlGrammarException: 
### Error updating database.  Cause: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
### The error may exist in file [D:\软件\ideaproject\jiaoyi\target\classes\mapper\OrderMapper.xml]
### The error may involve com.jiaoyi.mapper.OrderMapper.insert-Inline
### The error occurred while setting parameters
### SQL: INSERT INTO orders (             order_no, user_id, status, total_amount, coupon_id, coupon_code,              discount_amount, actual_amount, receiver_name, receiver_phone,              receiver_address, remark, create_time, update_time         ) VALUES (             ?, ?, ?, ?, ?, ?,             ?, ?, ?, ?,             ?, ?, ?, ?         )
### Cause: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy93.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy101.insert(Unknown Source)
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:136)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy136.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:48)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:75)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 96 common frames omitted
2025-10-27 10:39:26 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 10:39:26 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 555555505(Integer), 555555505(Integer), 410(Integer), 400(Integer), 订单取消解锁库存(String), 2025-10-27T10:39:26.922086500(LocalDateTime)
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:39:26 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 10:39:26 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 10:39:26 [http-nio-8080-exec-5] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
org.springframework.jdbc.BadSqlGrammarException: 
### Error updating database.  Cause: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
### The error may exist in file [D:\软件\ideaproject\jiaoyi\target\classes\mapper\OrderMapper.xml]
### The error may involve com.jiaoyi.mapper.OrderMapper.insert-Inline
### The error occurred while setting parameters
### SQL: INSERT INTO orders (             order_no, user_id, status, total_amount, coupon_id, coupon_code,              discount_amount, actual_amount, receiver_name, receiver_phone,              receiver_address, remark, create_time, update_time         ) VALUES (             ?, ?, ?, ?, ?, ?,             ?, ?, ?, ?,             ?, ?, ?, ?         )
### Cause: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
; bad SQL grammar []
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:246)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:92)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)
	at jdk.proxy2/jdk.proxy2.$Proxy93.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy101.insert(Unknown Source)
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:136)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.sql.SQLSyntaxErrorException: Unknown column 'coupon_id' in 'field list'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:121)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:354)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:58)
	at jdk.proxy3/jdk.proxy3.$Proxy136.execute(Unknown Source)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:48)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:75)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:425)
	... 96 common frames omitted
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: <EOL><EOL>### Error updating database.  Cause: java.sql.SQLSyntaxError (truncated)...]
2025-10-27 10:39:26 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:48:14 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:48:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:48:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 0(Integer), 10(Integer), 下单锁定库存(String), 2025-10-27T10:48:17.147620100(LocalDateTime)
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:48:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:48:17 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615332971496207(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T10:48:19.814951800(LocalDateTime), 2025-10-27T10:48:19.814951800(LocalDateTime)
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615332971496207
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 13(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 13
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 13(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T10:48:19.851828800(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T10:48:19.851828800(LocalDateTime)
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 10
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 13, 订单号: ORD17615332971496207, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 10:48:19 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615332971496207
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=13, orderNo=ORD17615332971496207, userId (truncated)...]
2025-10-27 10:48:19 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:48:28 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/.well-known/appspecific/com.chrome.devtools.json", parameters={}
2025-10-27 10:48:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 10:48:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 10:48:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 10:48:28 [http-nio-8080-exec-8] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 10:48:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:48:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 10:48:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.]
2025-10-27 10:48:28 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 10:49:18 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 25416 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 10:49:18 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 10:49:18 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 10:49:19 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 10:49:19 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 10:49:19 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-27 10:49:20 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 10:49:20 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 10:49:20 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 10:49:20 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 10:49:20 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1210 ms
2025-10-27 10:49:20 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 10:49:20 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 10:49:20 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 10:49:22 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 10:49:22 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 27 mappings in 'requestMappingHandlerMapping'
2025-10-27 10:49:23 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 10:49:23 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 10:49:23 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 10:49:24 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 10:49:24 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 10:49:24 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 5.976 seconds (process running for 6.221)
2025-10-27 10:49:44 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 10:49:44 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@43d12c53
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@a1c0e1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 10:49:44 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 8 ms
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders", parameters={}
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getAllOrders()
2025-10-27 10:49:44 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 获取所有订单
2025-10-27 10:49:44 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 获取所有订单
2025-10-27 10:49:44 [http-nio-8080-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 10:49:44 [http-nio-8080-exec-1] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@5c777753
2025-10-27 10:49:44 [http-nio-8080-exec-1] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectAll - ==>  Preparing: SELECT * FROM orders ORDER BY create_time DESC
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectAll - ==> Parameters: 
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectAll - <==      Total: 13
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 3(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 2(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 5(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 4(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 9(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 8(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 7(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 3
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 11(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 10(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 12(Long)
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=获取订单列表成功, data=[OrderResponse(id=13, orderNo=ORD17615332971496207, use (truncated)...]
2025-10-27 10:49:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=1001, receiverName=????, receiverPhone=13800138001, receiverAddress=????,  (truncated)...]
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:fNKrxQP8ZYDLdN7wxMXEZA==
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 1001
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 1001
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 1001
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2001, 数量: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2001(Long)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 1(Integer), 2001(Long), 1(Integer)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==> Parameters: 2001(Long), null, LOCK(String), 1(Integer), 150(Integer), 150(Integer), 0(Integer), 1(Integer), 下单锁定库存(String), 2025-10-27T10:49:50.566803900(LocalDateTime)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2001, 锁定数量: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 1001(Long), 4(Long)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 600, 优惠金额: 60.00
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 60.00, 实际支付金额: 540.00
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615333905839694(String), 1001(Long), PENDING(String), 600(BigDecimal), 4(Long), DISCOUNT10(String), 60.00(BigDecimal), 540.00(BigDecimal), ????(String), 13800138001(String), ????(String), ????(String), 2025-10-27T10:49:50.599864900(LocalDateTime), 2025-10-27T10:49:50.599864900(LocalDateTime)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615333905839694
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 14(Long), 2001(Long), iPhone 15 Pro(String), https://example.com/iphone.jpg(String), 600(BigDecimal), 1(Integer), 600(BigDecimal)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 1001, 订单ID: 14
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 1001(Long), 14(Long), DISCOUNT10(String), 60.00(BigDecimal), 2025-10-27T10:49:50.636743500(LocalDateTime), 600(BigDecimal), 540.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T10:49:50.636743500(LocalDateTime)
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 11
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 60.00
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 14, 订单号: ORD17615333905839694, 总金额: 600, 优惠金额: 60.00, 实际支付: 540.00
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 1001
2025-10-27 10:49:50 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615333905839694
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=14, orderNo=ORD17615333905839694, userId (truncated)...]
2025-10-27 10:49:50 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=1001, receiverName=测试用户, receiverPhone=13800138001, receiverAddress=测试地址,  (truncated)...]
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:Oj/+ejX12aBKgabuf1sFzA==
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 1001
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 1001
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 1001
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2001, 数量: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2001(Long)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 1(Integer), 2001(Long), 1(Integer)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==> Parameters: 2001(Long), null, LOCK(String), 1(Integer), 150(Integer), 150(Integer), 1(Integer), 2(Integer), 下单锁定库存(String), 2025-10-27T10:49:56.226002200(LocalDateTime)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2001, 锁定数量: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 1001(Long), 4(Long)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 600.00, 优惠金额: 60.0000
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 60.0000, 实际支付金额: 540.0000
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615333962297587(String), 1001(Long), PENDING(String), 600.00(BigDecimal), 4(Long), DISCOUNT10(String), 60.0000(BigDecimal), 540.0000(BigDecimal), 测试用户(String), 13800138001(String), 测试地址(String), 测试订单(String), 2025-10-27T10:49:56.236964900(LocalDateTime), 2025-10-27T10:49:56.236964900(LocalDateTime)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615333962297587
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 15(Long), 2001(Long), iPhone 15 Pro(String), https://example.com/iphone.jpg(String), 600.00(BigDecimal), 1(Integer), 600.00(BigDecimal)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 1001, 订单ID: 15
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 1001(Long), 15(Long), DISCOUNT10(String), 60.0000(BigDecimal), 2025-10-27T10:49:56.252201400(LocalDateTime), 600.00(BigDecimal), 540.0000(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T10:49:56.252201400(LocalDateTime)
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 12
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 60.0000
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 15, 订单号: ORD17615333962297587, 总金额: 600.00, 优惠金额: 60.0000, 实际支付: 540.0000
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 1001
2025-10-27 10:49:56 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615333962297587
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=15, orderNo=ORD17615333962297587, userId (truncated)...]
2025-10-27 10:49:56 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:03:16 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 12920 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 11:03:16 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 11:03:16 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 11:03:17 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 11:03:17 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 11:03:17 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-10-27 11:03:18 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 11:03:18 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 11:03:18 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 11:03:18 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 11:03:19 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2150 ms
2025-10-27 11:03:19 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 11:03:20 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 11:03:21 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 11:03:22 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 11:03:22 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 27 mappings in 'requestMappingHandlerMapping'
2025-10-27 11:03:23 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 11:03:23 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 11:03:23 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 11:03:26 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 11:03:26 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 11:03:26 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 10.512 seconds (process running for 10.901)
2025-10-27 11:04:42 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 31656 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 11:04:42 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 11:04:42 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 11:04:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 11:04:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 11:04:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-27 11:04:43 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 11:04:43 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 11:04:43 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 11:04:43 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 11:04:43 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1386 ms
2025-10-27 11:04:43 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 11:04:44 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 11:04:44 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 11:04:44 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 11:04:45 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 27 mappings in 'requestMappingHandlerMapping'
2025-10-27 11:04:45 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 11:04:45 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 11:04:45 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 11:04:46 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 11:04:46 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2025-10-27 11:04:46 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 11:04:46 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2025-10-27 11:06:59 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 38228 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 11:06:59 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 11:06:59 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 11:07:00 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 11:07:00 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 11:07:00 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-10-27 11:07:01 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 11:07:01 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 11:07:01 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 11:07:01 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 11:07:01 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1274 ms
2025-10-27 11:07:01 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 11:07:01 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 11:07:01 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 11:07:01 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 11:07:02 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 27 mappings in 'requestMappingHandlerMapping'
2025-10-27 11:07:02 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 11:07:02 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 11:07:02 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 11:07:03 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 11:07:03 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 11:07:03 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 3.759 seconds (process running for 4.414)
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 11:07:03 [RMI TCP Connection(2)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@6a64c2a7
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@42de94c2
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 11:07:03 [RMI TCP Connection(4)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-27 11:07:03 [RMI TCP Connection(2)-192.168.0.120] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@7581d289
2025-10-27 11:07:03 [RMI TCP Connection(2)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 10(Integer), 20(Integer), 下单锁定库存(String), 2025-10-27T11:09:11.526135700(LocalDateTime)
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:09:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:09:11 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615345515406044(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:09:16.450252(LocalDateTime), 2025-10-27T11:09:16.450252(LocalDateTime)
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615345515406044
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 16(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 16
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 16(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:09:16.473179100(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:09:16.473179100(LocalDateTime)
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 13
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 16, 订单号: ORD17615345515406044, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:09:16 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615345515406044
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=16, orderNo=ORD17615345515406044, userId (truncated)...]
2025-10-27 11:09:16 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 11:09:27 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:09:27 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/.well-known/appspecific/com.chrome.devtools.json", parameters={}
2025-10-27 11:09:27 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:09:27 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:09:27 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:09:27 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:09:27 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:09:27 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:09:27 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.]
2025-10-27 11:09:27 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:09:31 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 11:09:31 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:09:31 [http-nio-8080-exec-4] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:09:31 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:09:31 [http-nio-8080-exec-4] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:09:31 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 11:09:31 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:09:31 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 11:09:31 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 20(Integer), 30(Integer), 下单锁定库存(String), 2025-10-27T11:09:33.423566600(LocalDateTime)
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:09:33 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:09:33 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615345734256811(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:09:36.196654400(LocalDateTime), 2025-10-27T11:09:36.196654400(LocalDateTime)
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615345734256811
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 17(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 17
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 17(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:09:36.200640600(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:09:36.200640600(LocalDateTime)
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 14
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 17, 订单号: ORD17615345734256811, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:09:36 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615345734256811
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=17, orderNo=ORD17615345734256811, userId (truncated)...]
2025-10-27 11:09:36 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/17/pay", parameters={}
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 11:09:39 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:17_pay
2025-10-27 11:09:39 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 17, 支付方式: ALIPAY
2025-10-27 11:09:39 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 17, 支付方式: ALIPAY
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 17(Long)
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 11:09:39 [http-nio-8080-exec-6] ERROR c.jiaoyi.controller.OrderController - 支付处理失败
java.lang.RuntimeException: 支付金额不匹配
	at com.jiaoyi.service.PaymentService.processPayment(PaymentService.java:48)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.PaymentService$$SpringCGLIB$$0.processPayment(<generated>)
	at com.jiaoyi.controller.OrderController.payOrder(OrderController.java:163)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.payOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=支付处理失败: 支付金额不匹配, data=null)]
2025-10-27 11:09:39 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 30(Integer), 40(Integer), 下单锁定库存(String), 2025-10-27T11:09:42.354197500(LocalDateTime)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] WARN  com.jiaoyi.service.CouponService - 用户使用次数已达上限，已使用: 3, 限制: 3
2025-10-27 11:09:42 [http-nio-8080-exec-7] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 11:09:42 [http-nio-8080-exec-7] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 80(Integer), 80(Integer), 40(Integer), 30(Integer), 订单取消解锁库存(String), 2025-10-27T11:09:42.363520(LocalDateTime)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 11:09:42 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:09:42 [http-nio-8080-exec-7] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 11:09:42 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 304
2025-10-27 11:09:45 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 11:09:45 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 11:09:45 [http-nio-8080-exec-9] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:09:45 [http-nio-8080-exec-9] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:09:45 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:09:45 [http-nio-8080-exec-9] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:09:45 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 11:09:45 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:09:45 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 11:09:45 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 30(Integer), 40(Integer), 下单锁定库存(String), 2025-10-27T11:09:46.678896800(LocalDateTime)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] WARN  com.jiaoyi.service.CouponService - 用户使用次数已达上限，已使用: 3, 限制: 3
2025-10-27 11:09:46 [http-nio-8080-exec-10] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 11:09:46 [http-nio-8080-exec-10] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 80(Integer), 80(Integer), 40(Integer), 30(Integer), 订单取消解锁库存(String), 2025-10-27T11:09:46.687865300(LocalDateTime)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 11:09:46 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:09:46 [http-nio-8080-exec-10] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 11:09:46 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 30(Integer), 40(Integer), 下单锁定库存(String), 2025-10-27T11:09:56.742292800(LocalDateTime)
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:09:56 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:09:56 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:10:04 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:10:04 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:10:04 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:10:06 [http-nio-8080-exec-1] WARN  com.jiaoyi.service.CouponService - 用户使用次数已达上限，已使用: 3, 限制: 3
2025-10-27 11:10:06 [http-nio-8080-exec-1] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 11:10:06 [http-nio-8080-exec-1] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:10:06 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 11:10:06 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 80(Integer), 80(Integer), 40(Integer), 30(Integer), 订单取消解锁库存(String), 2025-10-27T11:10:06.621783100(LocalDateTime)
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:10:06 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 11:10:06 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 11:10:06 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:10:06 [http-nio-8080-exec-1] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 11:10:06 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 0(Integer), 10(Integer), 下单锁定库存(String), 2025-10-27T11:14:09.065776500(LocalDateTime)
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:14:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:14:09 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:14:14 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:14:14 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:14:14 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615348490660883(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:14:15.959741300(LocalDateTime), 2025-10-27T11:14:15.959741300(LocalDateTime)
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615348490660883
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 13(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 13
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 13(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:14:15.964725200(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:14:15.964725200(LocalDateTime)
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 10
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 13, 订单号: ORD17615348490660883, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:14:15 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615348490660883
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=13, orderNo=ORD17615348490660883, userId (truncated)...]
2025-10-27 11:14:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:14:20 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/.well-known/appspecific/com.chrome.devtools.json", parameters={}
2025-10-27 11:14:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:14:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:14:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:14:20 [http-nio-8080-exec-4] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:14:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:14:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:14:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.]
2025-10-27 11:14:20 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 10(Integer), 20(Integer), 下单锁定库存(String), 2025-10-27T11:14:27.349192400(LocalDateTime)
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:14:27 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:14:27 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615348673511369(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:14:29.628796900(LocalDateTime), 2025-10-27T11:14:29.628796900(LocalDateTime)
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615348673511369
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 14(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 14
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 14(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:14:29.630790200(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:14:29.630790200(LocalDateTime)
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 11
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 14, 订单号: ORD17615348673511369, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:14:29 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615348673511369
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=14, orderNo=ORD17615348673511369, userId (truncated)...]
2025-10-27 11:14:29 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 20(Integer), 30(Integer), 下单锁定库存(String), 2025-10-27T11:16:03.218942800(LocalDateTime)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615349632204885(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:16:03.223925200(LocalDateTime), 2025-10-27T11:16:03.223925200(LocalDateTime)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615349632204885
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 15(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 15
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 15(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:16:03.227911700(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:16:03.227911700(LocalDateTime)
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 12
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 15, 订单号: ORD17615349632204885, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:16:03 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615349632204885
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=15, orderNo=ORD17615349632204885, userId (truncated)...]
2025-10-27 11:16:03 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 30(Integer), 40(Integer), 下单锁定库存(String), 2025-10-27T11:24:36.448455700(LocalDateTime)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] WARN  com.jiaoyi.service.CouponService - 用户使用次数已达上限，已使用: 3, 限制: 3
2025-10-27 11:24:36 [http-nio-8080-exec-9] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 11:24:36 [http-nio-8080-exec-9] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 80(Integer), 80(Integer), 40(Integer), 30(Integer), 订单取消解锁库存(String), 2025-10-27T11:24:36.454436500(LocalDateTime)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 11:24:36 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:24:36 [http-nio-8080-exec-9] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 11:24:36 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 30(Integer), 40(Integer), 下单锁定库存(String), 2025-10-27T11:24:51.299248200(LocalDateTime)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] WARN  com.jiaoyi.service.CouponService - 用户使用次数已达上限，已使用: 3, 限制: 3
2025-10-27 11:24:51 [http-nio-8080-exec-10] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 11:24:51 [http-nio-8080-exec-10] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 80(Integer), 80(Integer), 40(Integer), 30(Integer), 订单取消解锁库存(String), 2025-10-27T11:24:51.306224600(LocalDateTime)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 11:24:51 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:24:51 [http-nio-8080-exec-10] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 11:24:51 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 30(Integer), 40(Integer), 下单锁定库存(String), 2025-10-27T11:24:59.669013700(LocalDateTime)
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:24:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:24:59 [http-nio-8080-exec-1] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:25:26 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:25:26 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:25:26 [http-nio-8080-exec-1] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:25:47 [http-nio-8080-exec-1] WARN  com.jiaoyi.service.CouponService - 用户使用次数已达上限，已使用: 3, 限制: 3
2025-10-27 11:25:47 [http-nio-8080-exec-1] WARN  com.jiaoyi.service.OrderService - 优惠券验证失败，优惠券ID: 4
2025-10-27 11:25:47 [http-nio-8080-exec-1] ERROR com.jiaoyi.service.OrderService - 订单创建失败，解锁库存
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:25:47 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量解锁库存，订单ID: null, 商品数量: 1
2025-10-27 11:25:47 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 解锁库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.InventoryMapper.unlockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.InventoryMapper.unlockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.InventoryMapper.unlockStock - <==    Updates: 1
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, UNLOCK(String), 10(Integer), 80(Integer), 80(Integer), 40(Integer), 30(Integer), 订单取消解锁库存(String), 2025-10-27T11:25:47.581752(LocalDateTime)
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:25:47 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 库存解锁成功，商品ID: 2002, 解锁数量: 10
2025-10-27 11:25:47 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.InventoryService - 批量库存解锁完成
2025-10-27 11:25:47 [http-nio-8080-exec-1] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.RuntimeException: 优惠券不可用
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:110)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:45)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 优惠券不可用, data=null)]
2025-10-27 11:25:47 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 0(Integer), 10(Integer), 下单锁定库存(String), 2025-10-27T11:27:33.906404100(LocalDateTime)
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:27:33 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:27:33 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615356539070015(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:27:47.142445(LocalDateTime), 2025-10-27T11:27:47.142445(LocalDateTime)
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615356539070015
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 13(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 13
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 13(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:27:47.145435400(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:27:47.145435400(LocalDateTime)
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 10
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 13, 订单号: ORD17615356539070015, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:27:47 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615356539070015
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=13, orderNo=ORD17615356539070015, userId (truncated)...]
2025-10-27 11:27:47 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 11:27:58 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:27:58 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/.well-known/appspecific/com.chrome.devtools.json", parameters={}
2025-10-27 11:27:58 [http-nio-8080-exec-5] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:27:58 [http-nio-8080-exec-5] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:27:58 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:27:58 [http-nio-8080-exec-5] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:27:58 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:27:58 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:27:58 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.]
2025-10-27 11:27:58 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:28:02 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 11:28:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:28:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:28:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:28:02 [http-nio-8080-exec-6] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:28:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 11:28:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:28:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 11:28:02 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 10(Integer), 20(Integer), 下单锁定库存(String), 2025-10-27T11:28:04.563225200(LocalDateTime)
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:28:04 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:28:04 [http-nio-8080-exec-7] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615356845643649(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:28:06.965504300(LocalDateTime), 2025-10-27T11:28:06.965504300(LocalDateTime)
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615356845643649
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 14(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 14
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 14(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:28:06.970487600(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:28:06.970487600(LocalDateTime)
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 11
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 14, 订单号: ORD17615356845643649, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:28:06 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615356845643649
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=14, orderNo=ORD17615356845643649, userId (truncated)...]
2025-10-27 11:28:06 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/14/pay", parameters={}
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 11:28:10 [http-nio-8080-exec-8] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:14_pay
2025-10-27 11:28:10 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 14, 支付方式: ALIPAY
2025-10-27 11:28:10 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 14, 支付方式: ALIPAY
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 14(Long)
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 11:28:10 [http-nio-8080-exec-8] ERROR c.jiaoyi.controller.OrderController - 支付处理失败
java.lang.RuntimeException: 支付金额不匹配
	at com.jiaoyi.service.PaymentService.processPayment(PaymentService.java:48)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.PaymentService$$SpringCGLIB$$0.processPayment(<generated>)
	at com.jiaoyi.controller.OrderController.payOrder(OrderController.java:163)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.payOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=支付处理失败: 支付金额不匹配, data=null)]
2025-10-27 11:28:10 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 20(Integer), 30(Integer), 下单锁定库存(String), 2025-10-27T11:28:23.192699700(LocalDateTime)
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:28:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:28:23 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615357031946133(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:28:26.004144900(LocalDateTime), 2025-10-27T11:28:26.004144900(LocalDateTime)
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615357031946133
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 15(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 15
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 15(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:28:26.006138700(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:28:26.006138700(LocalDateTime)
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 12
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 15, 订单号: ORD17615357031946133, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:28:26 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615357031946133
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=15, orderNo=ORD17615357031946133, userId (truncated)...]
2025-10-27 11:28:26 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:28:31 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/.well-known/appspecific/com.chrome.devtools.json", parameters={}
2025-10-27 11:28:31 [http-nio-8080-exec-10] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:28:31 [http-nio-8080-exec-10] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:28:31 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:28:31 [http-nio-8080-exec-10] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:28:31 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:28:31 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:28:31 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.]
2025-10-27 11:28:31 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 11:31:05 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:31:05 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/.well-known/appspecific/com.chrome.devtools.json", parameters={}
2025-10-27 11:31:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:31:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:31:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:31:05 [http-nio-8080-exec-2] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:31:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:31:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:31:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource .well-known/appspecific/com.chrome.devtools.json.]
2025-10-27 11:31:05 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:31:07 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 11:31:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:31:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:31:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:31:07 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:31:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 11:31:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:31:07 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 11:31:07 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 30(Integer), 40(Integer), 下单锁定库存(String), 2025-10-27T11:31:08.462844400(LocalDateTime)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615358684640817(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:31:08.466831700(LocalDateTime), 2025-10-27T11:31:08.466831700(LocalDateTime)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615358684640817
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 16(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 16
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 16(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:31:08.471815(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:31:08.471815(LocalDateTime)
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 13
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 16, 订单号: ORD17615358684640817, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:31:08 [http-nio-8080-exec-4] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615358684640817
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=16, orderNo=ORD17615358684640817, userId (truncated)...]
2025-10-27 11:31:08 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/16/pay", parameters={}
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 11:31:20 [http-nio-8080-exec-5] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:16_pay
2025-10-27 11:31:20 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 16, 支付方式: ALIPAY
2025-10-27 11:31:20 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 16, 支付方式: ALIPAY
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 16(Long)
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 11:31:20 [http-nio-8080-exec-5] ERROR c.jiaoyi.controller.OrderController - 支付处理失败
java.lang.RuntimeException: 支付金额不匹配
	at com.jiaoyi.service.PaymentService.processPayment(PaymentService.java:48)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.PaymentService$$SpringCGLIB$$0.processPayment(<generated>)
	at com.jiaoyi.controller.OrderController.payOrder(OrderController.java:163)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.payOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=支付处理失败: 支付金额不匹配, data=null)]
2025-10-27 11:31:20 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 40(Integer), 50(Integer), 下单锁定库存(String), 2025-10-27T11:31:29.071311100(LocalDateTime)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615358890724564(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:31:29.074302500(LocalDateTime), 2025-10-27T11:31:29.074302500(LocalDateTime)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615358890724564
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 17(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 17
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 17(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:31:29.077292300(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:31:29.077292300(LocalDateTime)
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 14
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 17, 订单号: ORD17615358890724564, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:31:29 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615358890724564
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=17, orderNo=ORD17615358890724564, userId (truncated)...]
2025-10-27 11:31:29 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 11:34:40 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:34:40 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 11:34:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:34:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:34:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:34:40 [http-nio-8080-exec-9] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:34:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 11:34:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:34:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 11:34:40 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 50(Integer), 60(Integer), 下单锁定库存(String), 2025-10-27T11:34:41.889148700(LocalDateTime)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615360818904407(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T11:34:41.892137400(LocalDateTime), 2025-10-27T11:34:41.892137400(LocalDateTime)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615360818904407
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 18(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 18
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 18(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T11:34:41.894130800(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T11:34:41.894130800(LocalDateTime)
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 15
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 18, 订单号: ORD17615360818904407, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 11:34:41 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615360818904407
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=18, orderNo=ORD17615360818904407, userId (truncated)...]
2025-10-27 11:34:41 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:34:43 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/18/pay", parameters={}
2025-10-27 11:34:43 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 11:34:43 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 11:34:43 [http-nio-8080-exec-1] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:18_pay
2025-10-27 11:34:43 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 18, 支付方式: ALIPAY
2025-10-27 11:34:43 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 18, 支付方式: ALIPAY
2025-10-27 11:34:43 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 11:34:43 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 18(Long)
2025-10-27 11:34:43 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 11:34:43 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.PaymentService - 调用第三方支付平台，订单ID: 18, 支付方式: ALIPAY
2025-10-27 11:34:43 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.PaymentService - 调用支付宝支付，订单ID: 18
2025-10-27 11:34:43 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 创建真实支付宝支付订单，订单号: ORD17615360818904407, 金额: 5500
2025-10-27 11:34:43 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 调用支付宝预下单API，订单号: ORD17615360818904407, 金额: 5500, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 11:34:44 [http-nio-8080-exec-1] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.precreate&sign=pKw7E23BBN1EVyJHB8L1ODRq8Xfk/blLwgK/6x8Y5aZVg9shAGKXUmQXWaRUUjReDjEWyCvpB2TWMedvBASC0hyDuEINW6j2aVTFE6AdbM/BNbM61MaIK2CNE8ge21ENbXytwGI+omKjkQAvAgJM8d44vkTxoVmQSDtNTm76o3EyBUAIqWc0V5nEffoGzAMAi9wgWoX4giqyGJb9G5E++Eo1FP8kis/MkxnaEDlJTFrZ4JWo92Z4k1fEaIsKKVmU72WfesNhMHz4dy3Oqjhdh/Y2EFEuRmv3FDX8EEMHs79eTi8r6YimYJ3KgVHUCAVlvkfEQN+BEYemYvHKPcX9cw==&return_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return&notify_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 11:34:43^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"body":"商品购买","out_trade_no":"ORD17615360818904407","subject":"订单支付：ORD17615360818904407","timeout_express":"30m","total_amount":"5500"}^_^84ms,1380ms,21ms^_^trace_id:060389ba176153608438863771954925
2025-10-27 11:34:44 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝API响应 - 成功: true, 错误码: 10000, 错误信息: Success, 二维码: https://qr.alipay.com/bax06495rymy0p9wllln00f5
2025-10-27 11:34:44 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝预下单成功，订单号: ORD17615360818904407, 二维码: https://qr.alipay.com/bax06495rymy0p9wllln00f5
2025-10-27 11:34:44 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:34:44 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=支付处理成功, data=PaymentResponse(paymentNo=PAY1761536083023D2B2C262, statu (truncated)...]
2025-10-27 11:34:44 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:34:49 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615360818904407", parameters={}
2025-10-27 11:34:49 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 11:34:49 [http-nio-8080-exec-2] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615360818904407
2025-10-27 11:34:49 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615360818904407
2025-10-27 11:34:49 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615360818904407, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 11:34:49 [http-nio-8080-exec-2] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 11:34:49^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=O2K6Jp/08fOpukq1wrYGhgX2g7nPX0pV6oAuFMNV89BJ0++JSDeVjeziB9y8vHrY877cWo9nDicP5MNILzFWiYSu8r5Sy9wZciOARz1xSsUX9DpcEIZ1jptzkedLSRt2KA/eZHfbW+n47xC0ExJxW/+xVC5QZcooj8PznEZe1q75sE+6J7f+mrYHmAYu1BxKqHrfLF5F0jrh27VvMPU54YIgtc0Mt4fmgh7QPbjvGyFnxK8klapbd2+HHC2Kirab4Lr8AnEdiF9WmYspSSmsLIMpfr3neyInwoPEepqVABV8wM7xMG8nbvcx/66avescituncBKNFY4D01oGnyO/eg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 11:34:49^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=060389ba176153609060764171954925&biz_content={"out_trade_no":"ORD17615360818904407"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615360818904407","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"YLxgcHEY/1lDzAuj0uUlRsgRW997+r7YfPvKYFbRBPh32dxq6eBXfk0ffjnatgDuAiknpBRgIAQYERDNe/phI+y6wEUBYkILmdcnm0gk8YQgh+g6kDPfUwrqomyPt6kwbhaaV/B3N0wZqsZIEzjmpQC+p1xcWsQnjsptJ6qTRKU7lp+6dvVX6Eej+oF3gfFKdYqo2pLqWdSRtKjQ6I6RkDwtRkTt1I/y24U4CC+EplSF38jODyoNdTUsD0vkZELn4t1g7GLg8SuO4DT1lY25L0Rw5ozR9YCia3g4WJoctbLhkQ4BRXzmfQFtPRxibmdTz4G2Kmvfg1mdbm0vjO26Wg=="}^_^15ms,373ms,26ms^_^trace_id:060389ba176153609060764171954925
2025-10-27 11:34:49 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 11:34:49 [http-nio-8080-exec-2] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 11:34:49 [http-nio-8080-exec-2] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:34:49 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:34:49 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 11:34:49 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:34:54 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615360818904407", parameters={}
2025-10-27 11:34:54 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 11:34:54 [http-nio-8080-exec-3] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615360818904407
2025-10-27 11:34:54 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615360818904407
2025-10-27 11:34:54 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615360818904407, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 11:34:54 [http-nio-8080-exec-3] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 11:34:54^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=Zt4cxdTb8UAMh/JZWzs5IOXw9XaPvF2tmVAJTGEe7tnMYvyCEXP3TOodIvybxV1L21GyQoSEpITl4N3uCPh0p5LN/ka3UShsxJPN5nDAHUFjzGHyOJkBjpxKrD7m6RcaTVvng1koo0Z1p16FoVP4E4Bwy/JtMLQvdWkMy3kppG3enii70gei+ompLeKin+JA3nM9yhu2+KUwmOklojqhsLi5m5B8uK4s1OW9tHVUszhLytzmHoCzTn9HIz/4r+XwrpfIoP7CCWljh5YQdGBiWgJFhjVzfw87ialJbbMHCnKaT3Q6nEvOCZSocIzmMt9Epa4hYj6MNAT6tGHlYf7SSA==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 11:34:54^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601d6c717615360954825790919487&biz_content={"out_trade_no":"ORD17615360818904407"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615360818904407","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"YLxgcHEY/1lDzAuj0uUlRsgRW997+r7YfPvKYFbRBPh32dxq6eBXfk0ffjnatgDuAiknpBRgIAQYERDNe/phI+y6wEUBYkILmdcnm0gk8YQgh+g6kDPfUwrqomyPt6kwbhaaV/B3N0wZqsZIEzjmpQC+p1xcWsQnjsptJ6qTRKU7lp+6dvVX6Eej+oF3gfFKdYqo2pLqWdSRtKjQ6I6RkDwtRkTt1I/y24U4CC+EplSF38jODyoNdTUsD0vkZELn4t1g7GLg8SuO4DT1lY25L0Rw5ozR9YCia3g4WJoctbLhkQ4BRXzmfQFtPRxibmdTz4G2Kmvfg1mdbm0vjO26Wg=="}^_^15ms,428ms,15ms^_^trace_id:0601d6c717615360954825790919487
2025-10-27 11:34:54 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 11:34:54 [http-nio-8080-exec-3] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 11:34:54 [http-nio-8080-exec-3] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:34:54 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:34:54 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 11:34:54 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:34:59 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615360818904407", parameters={}
2025-10-27 11:34:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 11:34:59 [http-nio-8080-exec-4] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615360818904407
2025-10-27 11:34:59 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615360818904407
2025-10-27 11:34:59 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615360818904407, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 11:34:59 [http-nio-8080-exec-4] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 11:34:59^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=TFcMl9CQLq6cZOxpDvicP31E82UrambPTvAogyo7Do43Xl6BxMEa464QUt8cSuKIAWbeImvbTq0Tgb+s0U7TTya95nY8NvTMPD0PJ4CETekdxJaWirds0bS2yMiQ9Dz7WwdCHAa3YHqyhp26zMr2ioe8SSnIgfTDk5ddsFZylv0CmU/ADkg6023yDlmPqCgWGomockDnVULjvPXj/sd975kY4V9nGvMeHJb/cRDlo6ZqUAXwjFhHB5Cq15acWNG9jikN3g7joeGg8n8bdVF7L9sfJRffnGhNGXLS/jdUTigW38oGuizWNDWfc+rNRFUjqcPdWfdPbEbRd1WAY4KWvA==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 11:34:59^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=060389ba176153610047764831954925&biz_content={"out_trade_no":"ORD17615360818904407"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615360818904407","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"YLxgcHEY/1lDzAuj0uUlRsgRW997+r7YfPvKYFbRBPh32dxq6eBXfk0ffjnatgDuAiknpBRgIAQYERDNe/phI+y6wEUBYkILmdcnm0gk8YQgh+g6kDPfUwrqomyPt6kwbhaaV/B3N0wZqsZIEzjmpQC+p1xcWsQnjsptJ6qTRKU7lp+6dvVX6Eej+oF3gfFKdYqo2pLqWdSRtKjQ6I6RkDwtRkTt1I/y24U4CC+EplSF38jODyoNdTUsD0vkZELn4t1g7GLg8SuO4DT1lY25L0Rw5ozR9YCia3g4WJoctbLhkQ4BRXzmfQFtPRxibmdTz4G2Kmvfg1mdbm0vjO26Wg=="}^_^14ms,166ms,16ms^_^trace_id:060389ba176153610047764831954925
2025-10-27 11:34:59 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 11:34:59 [http-nio-8080-exec-4] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 11:34:59 [http-nio-8080-exec-4] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:34:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:34:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 11:34:59 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:35:05 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615360818904407", parameters={}
2025-10-27 11:35:05 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 11:35:05 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615360818904407
2025-10-27 11:35:05 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615360818904407
2025-10-27 11:35:05 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615360818904407, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 11:35:05 [http-nio-8080-exec-5] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 11:35:05^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=I71OqC8XUYMr3wo7j9gJotA9JRc1ebeeipwxDFaOWwLBKX3gy/POIEDgHcqMei5XI4QgnBUKLh7LD2hJAxOaxS4EK1bkgnd8DmHbi15taqT40YztlkTnZck1X/unWmlDrUWEnH6tYAHFOoxbZQfrwiZxKRITEqhMFUx+ZIKYG0AKi4gUGj7maP1BIwK/HiNWapJOdcbmznLHs0/fiXbRBv1VXNwylaTnIeKbXyCeZoP4SQ58YJepxuRyFP5ilZofWtk3OEqn9+14uoYnG99T4rxdZCrSRpQbwtBT/Si5HqvOIiBaC8IiAd8GTM7iaQ9rVWDo++1pm8lsUEsnAJonuQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 11:35:05^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601d58b176153610650520281407451&biz_content={"out_trade_no":"ORD17615360818904407"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615360818904407","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"YLxgcHEY/1lDzAuj0uUlRsgRW997+r7YfPvKYFbRBPh32dxq6eBXfk0ffjnatgDuAiknpBRgIAQYERDNe/phI+y6wEUBYkILmdcnm0gk8YQgh+g6kDPfUwrqomyPt6kwbhaaV/B3N0wZqsZIEzjmpQC+p1xcWsQnjsptJ6qTRKU7lp+6dvVX6Eej+oF3gfFKdYqo2pLqWdSRtKjQ6I6RkDwtRkTt1I/y24U4CC+EplSF38jODyoNdTUsD0vkZELn4t1g7GLg8SuO4DT1lY25L0Rw5ozR9YCia3g4WJoctbLhkQ4BRXzmfQFtPRxibmdTz4G2Kmvfg1mdbm0vjO26Wg=="}^_^11ms,321ms,12ms^_^trace_id:0601d58b176153610650520281407451
2025-10-27 11:35:05 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 11:35:05 [http-nio-8080-exec-5] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 11:35:05 [http-nio-8080-exec-5] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:35:05 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:35:05 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 11:35:05 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:35:10 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615360818904407", parameters={}
2025-10-27 11:35:10 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 11:35:10 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615360818904407
2025-10-27 11:35:10 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615360818904407
2025-10-27 11:35:10 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615360818904407, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 11:35:10 [http-nio-8080-exec-6] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 11:35:10^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=JfSA99AjSeqyNEymgMS0sNuZZxD4aGG0+NVQ/3VrJHP5YDvjrQ/2O/MdnI6TVT2EP2K3fQgCW2mk48DmTxaNx+GgkaQZ4O02CmCfjNWcbOT81cWBboHoFG553/qqj6reAfbRTGdTyK4zDUiWO85dLzm08JDien4sZXdZF7HeNfoEdJsiVWr0gIkM83OTTwvezD2kQYCSiov+2FglryMiAXmMBcKK1pzW8iyuH6hpPsaZp90toOvu+CJaKzqyfobvMKLRhcUunLPXBuG7026M5Wk8jsRtFYy1Ky1FH1N2wyC6lJXIduN36E+zwpEqi1sKBq9+OoXsli23kDGrbC53lw==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 11:35:10^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=060389ba176153611145065541954925&biz_content={"out_trade_no":"ORD17615360818904407"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615360818904407","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"YLxgcHEY/1lDzAuj0uUlRsgRW997+r7YfPvKYFbRBPh32dxq6eBXfk0ffjnatgDuAiknpBRgIAQYERDNe/phI+y6wEUBYkILmdcnm0gk8YQgh+g6kDPfUwrqomyPt6kwbhaaV/B3N0wZqsZIEzjmpQC+p1xcWsQnjsptJ6qTRKU7lp+6dvVX6Eej+oF3gfFKdYqo2pLqWdSRtKjQ6I6RkDwtRkTt1I/y24U4CC+EplSF38jODyoNdTUsD0vkZELn4t1g7GLg8SuO4DT1lY25L0Rw5ozR9YCia3g4WJoctbLhkQ4BRXzmfQFtPRxibmdTz4G2Kmvfg1mdbm0vjO26Wg=="}^_^9ms,194ms,9ms^_^trace_id:060389ba176153611145065541954925
2025-10-27 11:35:10 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 11:35:10 [http-nio-8080-exec-6] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 11:35:10 [http-nio-8080-exec-6] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:35:10 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:35:10 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 11:35:10 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:35:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615360818904407", parameters={}
2025-10-27 11:35:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 11:35:15 [http-nio-8080-exec-7] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615360818904407
2025-10-27 11:35:15 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615360818904407
2025-10-27 11:35:15 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615360818904407, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 11:35:15 [http-nio-8080-exec-7] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 11:35:15^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=TOkqzLjL+acnB14Wt+hm2jhKJmVekyUi0YgFSTECUHDP+2/KXUDvpfk5axligIXqzqN1KNOP3jYIm60YEOdQH4ZCjDH5i88QOtPdYIDh/QngdLXXctWy0qaGrUto7rXixnX58njDR9Kq2drJ5anLmadlalSgqf3MsMAjs5w5v3FCNrRvSdtBZcEy/dj1NaLIObuo4RPuIkwUSvzf8u9KWS4N92ZR9adwItQ9q/6cPlp7bgAf0bZWRJF67R3tl/vMEaRb+t+S6Den2te12GQy0AdERlb0lHHcf94EyVpZXqFA8M8I0K8rRMnF37iDvmeNMWraO6RCcC8Mj4U3fbkZPQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 11:35:15^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601d58b176153611646221001407451&biz_content={"out_trade_no":"ORD17615360818904407"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615360818904407","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"YLxgcHEY/1lDzAuj0uUlRsgRW997+r7YfPvKYFbRBPh32dxq6eBXfk0ffjnatgDuAiknpBRgIAQYERDNe/phI+y6wEUBYkILmdcnm0gk8YQgh+g6kDPfUwrqomyPt6kwbhaaV/B3N0wZqsZIEzjmpQC+p1xcWsQnjsptJ6qTRKU7lp+6dvVX6Eej+oF3gfFKdYqo2pLqWdSRtKjQ6I6RkDwtRkTt1I/y24U4CC+EplSF38jODyoNdTUsD0vkZELn4t1g7GLg8SuO4DT1lY25L0Rw5ozR9YCia3g4WJoctbLhkQ4BRXzmfQFtPRxibmdTz4G2Kmvfg1mdbm0vjO26Wg=="}^_^14ms,179ms,10ms^_^trace_id:0601d58b176153611646221001407451
2025-10-27 11:35:15 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 11:35:15 [http-nio-8080-exec-7] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 11:35:15 [http-nio-8080-exec-7] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:35:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:35:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 11:35:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:38:52 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615360818904407", parameters={}
2025-10-27 11:38:52 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 11:38:52 [http-nio-8080-exec-9] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615360818904407
2025-10-27 11:38:52 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615360818904407
2025-10-27 11:38:52 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615360818904407, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 11:38:53 [http-nio-8080-exec-9] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=DmXlnjtLBRztpjkXmmGZsEJNKTLYQKgF4lBGxQ/HHdatGx5MdBCzaPPn85/Yny6hxik80ilbulSMXS7KEwKpCudKL8gXxxTyk1dgu0LhQ9m4SwSfTejx2W+GqiiAgFQE2h2NqilAa3FzUrGH4yeHel3tydUI9crwChYLyDbSh24dwQ8Jpyap3rlu5+rsxD41Z6jmxZ57iq2x8gXjoFj1vcrZXN9y07r9OGmw+1m47OhlTfrhj2reGnljVvrjyqQFh1uKZA1FGYajmLXFSSglSuAocsj1BKxfwmtfotH6MOHtUG1RnZIaqyWGLpFRtC3nAL7mG8HiWyUXoUh9htEfRQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 11:38:52^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615360818904407"}^_^14ms,359ms,20ms^_^trace_id:0601d6c717615363340417306919487
2025-10-27 11:38:53 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 11:38:53 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615360818904407, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507339682
2025-10-27 11:38:53 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 11:38:53 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615360818904407, status=SUCC (truncated)...]
2025-10-27 11:38:53 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 304
2025-10-27 11:38:54 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 11:38:54 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 11:38:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 11:38:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 11:38:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 11:38:54 [http-nio-8080-exec-1] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 11:38:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 11:38:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 11:38:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 11:38:54 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 304
2025-10-27 13:36:34 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 13:36:34 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:36:34 [http-nio-8080-exec-5] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:36:34 [http-nio-8080-exec-5] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:36:34 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:36:34 [http-nio-8080-exec-5] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:36:34 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:36:34 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:36:34 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:36:34 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 60(Integer), 70(Integer), 下单锁定库存(String), 2025-10-27T13:36:36.576441(LocalDateTime)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615433965905620(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T13:36:36.626880600(LocalDateTime), 2025-10-27T13:36:36.626880600(LocalDateTime)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615433965905620
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 19(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 19
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 19(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T13:36:36.641827200(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T13:36:36.642824100(LocalDateTime)
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 16
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 19, 订单号: ORD17615433965905620, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 13:36:36 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615433965905620
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=19, orderNo=ORD17615433965905620, userId (truncated)...]
2025-10-27 13:36:36 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:36:38 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/19/pay", parameters={}
2025-10-27 13:36:38 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 13:36:38 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 13:36:38 [http-nio-8080-exec-7] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:19_pay
2025-10-27 13:36:38 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 19, 支付方式: ALIPAY
2025-10-27 13:36:38 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 19, 支付方式: ALIPAY
2025-10-27 13:36:38 [http-nio-8080-exec-7] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 13:36:38 [http-nio-8080-exec-7] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 19(Long)
2025-10-27 13:36:38 [http-nio-8080-exec-7] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 13:36:38 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.PaymentService - 调用第三方支付平台，订单ID: 19, 支付方式: ALIPAY
2025-10-27 13:36:38 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.PaymentService - 调用支付宝支付，订单ID: 19
2025-10-27 13:36:38 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 创建真实支付宝支付订单，订单号: ORD17615433965905620, 金额: 5500
2025-10-27 13:36:38 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 调用支付宝预下单API，订单号: ORD17615433965905620, 金额: 5500, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:36:39 [http-nio-8080-exec-7] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.precreate&sign=K0m2Nb9DuWVDTih0O0LZIfoO1vTKHzK9zD/oWUTrSQLi7if5CnGNMNnSBSSwSaaDvGj6IzHLJomK/uf0nx3eY+VF2I8bnCZqcuvvVIq0/KPc4GVlO8fk8n+eh25PHgwL3F+c8XygOljKX1OCUYhkRzZ0PwCSxb/pIBYiRQW7OltLnmG5a7g6QC2JZFJuVzaKfENBtXW5cycBnq+DD9BPqysEh2cdzs1jLnEjgSwA7IlQD1MzA3KnaiPkkwyBcCwZ4YH0oZnHHYbusBnE4osUbZtZ29SJZG+WEWn23V7OxT7dBCxB+v1sIMYkspga+88pKXiodvQ0hD+S/JZAe2dr0g==&return_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return&notify_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:36:38^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"body":"商品购买","out_trade_no":"ORD17615433965905620","subject":"订单支付：ORD17615433965905620","timeout_express":"30m","total_amount":"5500"}^_^37ms,1101ms,21ms^_^trace_id:0601ac3e176154339944971774904
2025-10-27 13:36:39 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝API响应 - 成功: true, 错误码: 10000, 错误信息: Success, 二维码: https://qr.alipay.com/bax02391dhwwpos1c1i400c6
2025-10-27 13:36:39 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝预下单成功，订单号: ORD17615433965905620, 二维码: https://qr.alipay.com/bax02391dhwwpos1c1i400c6
2025-10-27 13:36:39 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:36:39 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=支付处理成功, data=PaymentResponse(paymentNo=PAY17615433982622DFDE42F, statu (truncated)...]
2025-10-27 13:36:39 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:36:44 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615433965905620", parameters={}
2025-10-27 13:36:44 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:36:44 [http-nio-8080-exec-8] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615433965905620
2025-10-27 13:36:44 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615433965905620
2025-10-27 13:36:44 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615433965905620, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:36:44 [http-nio-8080-exec-8] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 13:36:44^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=ms5u2ujFUFpx2MRrsIOfKjfPCZeR0gbXmCLCAR+4NPkEvSDjpNZmoEJQ7j6N18v4TEjv1aBFsrzK9Yk8lOF87ZiJ55UUDRXKdXMCpCOTLNX7eePVf+9cSN6gkFZG1EnEEdf7u7oUvQupUtsuqIUkc1T/gQq3i2XGcQt/84wiWWLPhSoqdLr1qxS7WTSUix76PBxtqGHqukjym26m8AY/HSu0gLo3ZuC+EDGdDK07WEQoCEooXQa6LIbi/Ns7h8GGtO9MlAveMaI9C5K/w5y4PJZaisztD7SykExbj0Hrrl3yz6Of7ABHUCRb5H+sPgg7hGxU8H/sPyuupN5ItLExzg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:36:44^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=06013ec2176154340556154491436129&biz_content={"out_trade_no":"ORD17615433965905620"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615433965905620","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"jl0u5k4XtF/mNvznSLv79cJxOF2NBkdtsG1wHUFD2JFVt0OSO8/9MFVw8UEPVUrZ0SBrsmPFGGYZnE0/h+Yj04DdgYQr6VEwc4jGX7Skfvsh2vHk0gpwrk3zlZ5LHXKn/OkslmxOCOI7OzdNzmGjb7C6dwpUgKNHUtqZn8UKRLcRuJND/tHTgTF98B5Iv5rq1Gkh83Xwliif7KHZE/1sqWNs4QzN2s1yXgzENkLeH0CjRxFpnv3iPdMtjFKDjSkQZ4H23DFJmYl6u5SawWSbosTY1pIWEG+g8r9kDTuLw/V4PCG6XpTi0zIO2KNrGRzdGKRRVzYCHog1+gmmXEGdDg=="}^_^16ms,424ms,19ms^_^trace_id:06013ec2176154340556154491436129
2025-10-27 13:36:44 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 13:36:44 [http-nio-8080-exec-8] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 13:36:44 [http-nio-8080-exec-8] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:36:44 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:36:44 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 13:36:44 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:36:49 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615433965905620", parameters={}
2025-10-27 13:36:49 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:36:49 [http-nio-8080-exec-9] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615433965905620
2025-10-27 13:36:49 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615433965905620
2025-10-27 13:36:49 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615433965905620, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:36:49 [http-nio-8080-exec-9] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 13:36:49^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=oIDT1NIK1gYWAz6BSmxqtNVnuXUlLkZFtcR0pKJQ2Ez47KQckBmhLY3R5f7L9KkifCz1F40/+jwfBtkPHSYgdJ9JsiqVU7gfHSsj0hDZogMgtS06DDVXsBFwGgZFQkmkJAPbhmr2tMGBfqPUEJEj2prWszvL9f4Lhfy9oaNhk/cKJiQ63jUdufrsrhl+LVJ2FeGj3JAHlasiSJ71LtckYVpoa/jTSqrABblASRgiPiV6GIrAbjeK2NezjGjtyzT3mQxcrT/6dfw2jeQUSmGlpfuACJVcGREpyKCTWskkz/j1neY/jv0orubC/SFzLk9H9lLU8ZRO2wYOqFpFwozGcA==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:36:49^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601d58b176154341049210611407451&biz_content={"out_trade_no":"ORD17615433965905620"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615433965905620","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"jl0u5k4XtF/mNvznSLv79cJxOF2NBkdtsG1wHUFD2JFVt0OSO8/9MFVw8UEPVUrZ0SBrsmPFGGYZnE0/h+Yj04DdgYQr6VEwc4jGX7Skfvsh2vHk0gpwrk3zlZ5LHXKn/OkslmxOCOI7OzdNzmGjb7C6dwpUgKNHUtqZn8UKRLcRuJND/tHTgTF98B5Iv5rq1Gkh83Xwliif7KHZE/1sqWNs4QzN2s1yXgzENkLeH0CjRxFpnv3iPdMtjFKDjSkQZ4H23DFJmYl6u5SawWSbosTY1pIWEG+g8r9kDTuLw/V4PCG6XpTi0zIO2KNrGRzdGKRRVzYCHog1+gmmXEGdDg=="}^_^15ms,331ms,17ms^_^trace_id:0601d58b176154341049210611407451
2025-10-27 13:36:49 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 13:36:49 [http-nio-8080-exec-9] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 13:36:49 [http-nio-8080-exec-9] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:36:49 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:36:49 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 13:36:49 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:36:54 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615433965905620", parameters={}
2025-10-27 13:36:54 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:36:54 [http-nio-8080-exec-10] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615433965905620
2025-10-27 13:36:54 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615433965905620
2025-10-27 13:36:54 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615433965905620, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:36:54 [http-nio-8080-exec-10] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 13:36:54^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=R7zba8VKAhDeblGC+HTDotwcU3PYudRcjUc7tjSzjaLcihYRsd8yPRSlWO5bmfppQrdxAwf1Hl/LWdBgjZYE7AzlOFi1uVzK77s58imrPoMAgscXEz7Cnlr+iOy9gv0/QxKJB3dbFdDV0u+E3NXg5+wCHox95YGOJeNMPf5GO3+1tqXoLdvsqarFpkiXvGXlkgblMZya0oX5McL/SkovSN1h2rIjhnPKozLdfiuOnptDVVWGSCAWr9+6kfn5RVTHdRWORlmUPyjDsrPZs1udNhH4yPi/CGi+Pf3vRKGQ8HxwBlie9Qhj3VjCYLDSsHxv7+5lft+Yjyu6IIIPuqrCKw==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:36:54^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601d58b176154341549511011407451&biz_content={"out_trade_no":"ORD17615433965905620"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615433965905620","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"jl0u5k4XtF/mNvznSLv79cJxOF2NBkdtsG1wHUFD2JFVt0OSO8/9MFVw8UEPVUrZ0SBrsmPFGGYZnE0/h+Yj04DdgYQr6VEwc4jGX7Skfvsh2vHk0gpwrk3zlZ5LHXKn/OkslmxOCOI7OzdNzmGjb7C6dwpUgKNHUtqZn8UKRLcRuJND/tHTgTF98B5Iv5rq1Gkh83Xwliif7KHZE/1sqWNs4QzN2s1yXgzENkLeH0CjRxFpnv3iPdMtjFKDjSkQZ4H23DFJmYl6u5SawWSbosTY1pIWEG+g8r9kDTuLw/V4PCG6XpTi0zIO2KNrGRzdGKRRVzYCHog1+gmmXEGdDg=="}^_^17ms,194ms,18ms^_^trace_id:0601d58b176154341549511011407451
2025-10-27 13:36:54 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 13:36:54 [http-nio-8080-exec-10] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 13:36:54 [http-nio-8080-exec-10] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:36:54 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:36:54 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 13:36:54 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:36:59 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615433965905620", parameters={}
2025-10-27 13:36:59 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:36:59 [http-nio-8080-exec-1] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615433965905620
2025-10-27 13:36:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615433965905620
2025-10-27 13:36:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615433965905620, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:36:59 [http-nio-8080-exec-1] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=HkLylBCmwvJyAp9QlUIkXeodUfHTf3AkT1bcbRv6IN+8Ha1wNvhZ/3inF59kgrCR4hd3z5o5vxRDDdJQD3cX8AQGxLK2SuFqpLmX1dYK67HJPuN09+9zeruVuD9CoG4R8w00XMPr17xfStpkJns5xu1LGLyycOACfbfQR17f3lfJD+MuVbxZ4hD+EYxxXQ6ZyZbRFJFOpJh0VJMgv51VGMNfX5QVz5+h2bONavRKhkotNeTOCKdkbf850AVlOczDEtxGqCtBbnccVf5labjK3F0EtD7eEVAS67nqvb9r5TTcwhF1uVUDZDlrzRhL9EsjjQzmyh+FFAbVyOv0OX/d5w==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:36:59^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615433965905620"}^_^18ms,333ms,19ms^_^trace_id:0601ac3e176154342051972964904
2025-10-27 13:36:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 13:36:59 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615433965905620, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507339683
2025-10-27 13:36:59 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:36:59 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615433965905620, status=PEND (truncated)...]
2025-10-27 13:36:59 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:37:04 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615433965905620", parameters={}
2025-10-27 13:37:04 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:37:04 [http-nio-8080-exec-2] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615433965905620
2025-10-27 13:37:04 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615433965905620
2025-10-27 13:37:04 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615433965905620, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:37:04 [http-nio-8080-exec-2] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=kyo8Y2FLnuzd3v40cbjHr+/y7fQYZiyVRFWillRrXImPqvuAfMqW3U/xW088rFF6Axxulyy0IIySzq4I7GAJVIlAnuMgKWxbacWJr2jw483iWGNEcwr2kHKsi7a2th48RURJ1BzN/OaWgXegWdddd90IE0LXGZ7NKwQfC57/9UtmuO6QHW60I/UwlYYLhoxDFNIjFIS98z09lwNwvhINCFCKGwZsPgOYAHoAO5DRohHQlADWB0a/bhT3PVSZwieZti7dqsmJGd7hr/eo9cH/aeTeS9dyiGkwuUEu0af+XzIQ8Ok6rVgIRK6LQC4LZgpOtA0sWTPPfHlbkewqh8XTew==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:37:04^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615433965905620"}^_^23ms,295ms,19ms^_^trace_id:06013ec2176154342552155771436129
2025-10-27 13:37:04 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 13:37:04 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615433965905620, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507339683
2025-10-27 13:37:04 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:37:04 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615433965905620, status=SUCC (truncated)...]
2025-10-27 13:37:04 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 304
2025-10-27 13:37:13 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 13:37:13 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:37:13 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:37:13 [http-nio-8080-exec-4] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:37:13 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:37:13 [http-nio-8080-exec-4] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:37:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:37:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:37:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:37:14 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:45:58 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 30452 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 13:45:58 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 13:45:58 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 13:46:00 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 13:46:00 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 13:46:00 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 31 ms. Found 0 Redis repository interfaces.
2025-10-27 13:46:02 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 13:46:02 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 13:46:02 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 13:46:02 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 13:46:02 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3678 ms
2025-10-27 13:46:02 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 13:46:03 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 13:46:03 [redisson-netty-2-6] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 13:46:03 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 13:46:05 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 13:46:05 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 28 mappings in 'requestMappingHandlerMapping'
2025-10-27 13:46:05 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 13:46:05 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 13:46:05 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 13:46:07 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 13:46:07 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 13:46:07 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 9.473 seconds (process running for 11.633)
2025-10-27 13:47:22 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 13:47:22 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@43da3ea8
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@6e8bea60
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 13:47:22 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:47:22 [http-nio-8080-exec-1] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:47:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:47:23 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 13:47:23 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@54f85cb1
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 80(Integer), 80(Integer), 70(Integer), 80(Integer), 下单锁定库存(String), 2025-10-27T13:47:24.719967100(LocalDateTime)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615440447369204(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T13:47:24.746531700(LocalDateTime), 2025-10-27T13:47:24.746531700(LocalDateTime)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615440447369204
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 20(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 20
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 20(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T13:47:24.782414(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T13:47:24.782414(LocalDateTime)
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 17
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 20, 订单号: ORD17615440447369204, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 13:47:24 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615440447369204
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=20, orderNo=ORD17615440447369204, userId (truncated)...]
2025-10-27 13:47:24 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:47:25 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/20/pay", parameters={}
2025-10-27 13:47:25 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 13:47:25 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 13:47:25 [http-nio-8080-exec-10] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:20_pay
2025-10-27 13:47:25 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 20, 支付方式: ALIPAY
2025-10-27 13:47:25 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 20, 支付方式: ALIPAY
2025-10-27 13:47:25 [http-nio-8080-exec-10] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 13:47:25 [http-nio-8080-exec-10] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 20(Long)
2025-10-27 13:47:25 [http-nio-8080-exec-10] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 13:47:25 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.PaymentService - 调用第三方支付平台，订单ID: 20, 支付方式: ALIPAY
2025-10-27 13:47:25 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.PaymentService - 调用支付宝支付，订单ID: 20
2025-10-27 13:47:25 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 创建真实支付宝支付订单，订单号: ORD17615440447369204, 金额: 5500
2025-10-27 13:47:25 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 调用支付宝预下单API，订单号: ORD17615440447369204, 金额: 5500, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:47:27 [http-nio-8080-exec-10] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.precreate&sign=Juhd9DZgab8W3IY3eJ+m6g2NOHJ1muY0nm44XfvlwqJa0f/BIuGh03A5nePK0HnREBUIKFgrt9tEBdBwTIpYXUPJDFBdX5Qu1d6RyguCYl45VjBcby4rprxV0SWGHj5UZcrRsow/LLZjlevbP4Hr6v3fR47l4R/FYkfiXfwmbOzzmc3S/2DPMwgq3E/gZ7us1zKtTIeQ6m5xh9xUPsYgzZjmA7tsBxCAXxnLgAHXpKNS7fZE2w/zkAlMEsJa5zoIAqvCb+Tg8C4da9tTPOrdvi3PS3Ln7lsS1ck53TsXJsjNjbIFlDJFVbZdwzG99DiXzwGtduBF12oY85s27kIRug==&return_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return&notify_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:47:26^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"body":"商品购买","out_trade_no":"ORD17615440447369204","subject":"订单支付：ORD17615440447369204","timeout_express":"30m","total_amount":"5500"}^_^38ms,1455ms,35ms^_^trace_id:060389ba176154404763814011954925
2025-10-27 13:47:27 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 支付宝API响应 - 成功: true, 错误码: 10000, 错误信息: Success, 二维码: https://qr.alipay.com/bax01128qe8ujcstmpeq0004
2025-10-27 13:47:27 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 支付宝预下单成功，订单号: ORD17615440447369204, 二维码: https://qr.alipay.com/bax01128qe8ujcstmpeq0004
2025-10-27 13:47:27 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:47:27 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=支付处理成功, data=PaymentResponse(paymentNo=PAY1761544045970042F4CC8, statu (truncated)...]
2025-10-27 13:47:27 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:47:32 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615440447369204", parameters={}
2025-10-27 13:47:32 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:47:32 [http-nio-8080-exec-3] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615440447369204
2025-10-27 13:47:32 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615440447369204
2025-10-27 13:47:32 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615440447369204, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:47:32 [http-nio-8080-exec-3] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 13:47:32^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=OB9NGolgEu1jUg+hunrLtyZRkKnAv30elaUdJLDLQJpuM8zptVbcevVR67dSrjvGe2pLaWPIZPli5wpvaWfao3Rw9PoOwtD+B1guqaHo+r9YBiKJjNMZOSykYGgrdobCNntkoMXzYcJNILLTwYQdIvSxXYKXzt2wtLX/QHuC3Tps10cNqX36/qhEGSwvPNVOHJ8T2N8shw/6bljBVHGoiXvHxQPZQriL8TRtRsUukLVpGyQEDd+k5TIssEFPrrbCLJYowDV1lFkdTfEj8BFKMNtdm66InsBK1ymlR3zMF0NPf4vF25XM6ijC1ROAfdZGXpKfbE5Ng5Wzeogvai6AWg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:47:32^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601d58b176154405367851171407451&biz_content={"out_trade_no":"ORD17615440447369204"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615440447369204","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"LsXLIG+73Krg24EpGorLXShPuOkexbBf2ldez5MHcER4I+lJWGz716PmCTh2xZ2h+SU7bdjvr3Ol7NqJlpcKN5ChtfA6o6mwKe/0Bt5EcRNjJlxJzCOWdGwVNVFyEP4hzeEflGI+APUqfutH5R+rfjQuBDiUwbXGvKfgBTZCPpgaeFyBG2B9sfK4LHSiWmm9WjUoUvfNTjjzZeZK9KIPdcDGNxAVb97bzmH9w5Bkl8pW/tZiT1+zCSJM2TC6bEJApRmcxV52QHgjm6sUm4eyYepmO/ivUdGidT3GOanD22gyW+8c/sx35O2NneIcqkHoNO6nPTRh7fD3Fzg+5vWw7A=="}^_^14ms,311ms,20ms^_^trace_id:0601d58b176154405367851171407451
2025-10-27 13:47:32 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 13:47:32 [http-nio-8080-exec-3] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 13:47:32 [http-nio-8080-exec-3] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:47:32 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:47:32 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 13:47:32 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:47:37 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615440447369204", parameters={}
2025-10-27 13:47:37 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:47:37 [http-nio-8080-exec-9] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615440447369204
2025-10-27 13:47:37 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615440447369204
2025-10-27 13:47:37 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615440447369204, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:47:37 [http-nio-8080-exec-9] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=XYb+vC4DuHgYgbcD6Lgyl4VC9QVNuhZYUoZNDhiXaVE8aGwQPkVFEdH8doPGK9A/LbnO5EAG7KdDyULKJrGjTmYcqYWTR4ZdVVacqI1JhQ8JcF0iFhCi/j0ulWShK0c7seWJiqCCJ/BFyjYCbs+SPosn62Ikc/eFyTWovJ2iSU5iCoE6JQB5U3xDPtLc5DCkQ8PA4kWLus1yMojAxMUafaCIUTcj8XX+aXyvCoAGsylSo+vQu5Fk4GmKpl0SvUPcBy1NeqOLB7IDetzT809ofuQdy+Yc8Mc2ntNXbMIHF0vve+9EutG1s8ywAXQALMn/m6D7lhmx1EhYwGAsjO+kAw==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:47:37^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615440447369204"}^_^12ms,214ms,17ms^_^trace_id:060389ba176154405860114631954925
2025-10-27 13:47:37 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 13:47:37 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615440447369204, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507342969
2025-10-27 13:47:37 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:47:37 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615440447369204, status=PEND (truncated)...]
2025-10-27 13:47:37 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:47:42 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615440447369204", parameters={}
2025-10-27 13:47:42 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:47:42 [http-nio-8080-exec-8] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615440447369204
2025-10-27 13:47:42 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615440447369204
2025-10-27 13:47:42 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615440447369204, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:47:42 [http-nio-8080-exec-8] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=BukNoyfFoGz3T9nwumntzApF2zV+INY26qLrASBXl+O8l2i3hfB88tI/H2kjaB1EfD5+WL8gTqPv18DIHZLXFvEcbfKIvQmMMv1Op9NaQ0KKpJUW7M/xThcRRkgvadz+ULJkQRggVIN9RIS0KONrIcDu1gV7NA6cXCEh5sXrmWNm30qZurCRA0QylG/DF09ZXDVhMqE0+DtIbV5h8q+5ydBH07CBNmo0UaOOiobTMF4eqsIkvo2qcxwmj2c2fBAQ23jJYlaipVQW0eWcU7UBDkNh6hw4kJqI5zImPCVpBUtTlYFiDyIn2HZhmWpypvTyfFbiXrxMwaCMS/4K/2ejjQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:47:42^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615440447369204"}^_^7ms,243ms,9ms^_^trace_id:0601ac3e176154406359833354904
2025-10-27 13:47:42 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 13:47:42 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615440447369204, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507342969
2025-10-27 13:47:42 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:47:42 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615440447369204, status=PEND (truncated)...]
2025-10-27 13:47:42 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:47:47 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615440447369204", parameters={}
2025-10-27 13:47:47 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:47:47 [http-nio-8080-exec-7] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615440447369204
2025-10-27 13:47:47 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615440447369204
2025-10-27 13:47:47 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615440447369204, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:47:47 [http-nio-8080-exec-7] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=S+l6KjNZCYT3FtnG4ZgJwAs50bcV8Rwh5zYKHhHwo8i56mlOmUnSVOvGC89l13IkPRKRQbb4HGLBwgOn98ltwikncTXWwVu2VYsD7eKmLucC7O2zoGKYFAdpt369DfFiXt90hEXEbZzmuEVEg4N3a2yODfk7oKWgM3XYlxnYqk5d8/otWmUbxMqSeX5IS0naaxx02wnPCIEeKvVcYb6y2A88cOfc0+9wQr/zRR87lF92y5hsxnSDs3e69Z7GItmevymD6K2PAnipD6K1qDLSDxqAyksH1+pTneDXHRJNHberwstKTBQZ/hwqeHTlpU+89mOy6zw9Fo49JTcFD21YJQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:47:47^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615440447369204"}^_^14ms,246ms,21ms^_^trace_id:0601d58b176154406860152191407451
2025-10-27 13:47:47 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 13:47:47 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615440447369204, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507342969
2025-10-27 13:47:47 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:47:47 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615440447369204, status=SUCC (truncated)...]
2025-10-27 13:47:47 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 13:47:49 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:47:49 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:47:49 [http-nio-8080-exec-6] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:47:49 [http-nio-8080-exec-6] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:47:49 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:47:49 [http-nio-8080-exec-6] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:47:49 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:47:49 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:47:49 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:47:49 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@43da3ea8
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@6e8bea60
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 13:53:13 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:53:13 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:53:13 [http-nio-8080-exec-2] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:53:13 [http-nio-8080-exec-2] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:53:13 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:53:13 [http-nio-8080-exec-2] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:53:13 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:53:13 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:53:13 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:53:13 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 13:53:15 [http-nio-8080-exec-10] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 13:53:15 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 13:53:15 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 13:53:15 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 13:53:15 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 13:53:15 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 13:53:15 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 13:53:15 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 13:53:15 [http-nio-8080-exec-10] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
com.jiaoyi.exception.InsufficientStockException: 商品[iPhone 15 Pro 512GB 钛原色]库存不足，请求数量：10，可用库存：0
	at com.jiaoyi.service.InventoryService.checkAndLockStock(InventoryService.java:49)
	at com.jiaoyi.service.InventoryService.checkAndLockStockBatch(InventoryService.java:161)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.InventoryService$$SpringCGLIB$$0.checkAndLockStockBatch(<generated>)
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:79)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:46)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: 商品[iPhone 15 Pro 512GB 钛原色]库存不足，请求数量：10，可用库存：0, data=null)]
2025-10-27 13:53:15 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999999(Integer), 999999999(Integer), 80(Integer), 90(Integer), 下单锁定库存(String), 2025-10-27T13:54:40.190740400(LocalDateTime)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615444801932626(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T13:54:40.200705900(LocalDateTime), 2025-10-27T13:54:40.200705900(LocalDateTime)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615444801932626
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 21(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 21
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 21(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T13:54:40.208679400(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T13:54:40.208679400(LocalDateTime)
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 18
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 21, 订单号: ORD17615444801932626, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 13:54:40 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615444801932626
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=21, orderNo=ORD17615444801932626, userId (truncated)...]
2025-10-27 13:54:40 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:54:43 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/21/pay", parameters={}
2025-10-27 13:54:43 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 13:54:43 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 13:54:43 [http-nio-8080-exec-8] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:21_pay
2025-10-27 13:54:43 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 21, 支付方式: ALIPAY
2025-10-27 13:54:43 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 21, 支付方式: ALIPAY
2025-10-27 13:54:43 [http-nio-8080-exec-8] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 13:54:43 [http-nio-8080-exec-8] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 21(Long)
2025-10-27 13:54:43 [http-nio-8080-exec-8] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 13:54:43 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.PaymentService - 调用第三方支付平台，订单ID: 21, 支付方式: ALIPAY
2025-10-27 13:54:43 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.PaymentService - 调用支付宝支付，订单ID: 21
2025-10-27 13:54:43 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 创建真实支付宝支付订单，订单号: ORD17615444801932626, 金额: 5500
2025-10-27 13:54:43 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 调用支付宝预下单API，订单号: ORD17615444801932626, 金额: 5500, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:54:44 [http-nio-8080-exec-8] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.precreate&sign=gXNRFel+g+RnkZLAgYWhkSs8NOmzd2TRBC/7SLLbAwiSI4BKyoWd6yD9Yiu3bh6RBtcte5r0OWQ94abLG1i2lhT2HstWzlCSHjvevnJfU+Dbq1RM367GVroLXC6AeL90snhinGHBnlzfq2h06f7w7XxZfAFYLH1V3Bul+TWIO9F8uXbXCildrpmSN8MYYz6ElpzVBPYBpSgi6vBGxcOilW+8Ykog0vmizJ9PtoaPcCPPKrU9KWPbNy4XosT+1Zti9h9rpdragUHUyNC2e/aoGqs0lf7Pk1pfJK1D90CFjxAIrQw5L9yHcruoA48H+Znp3vnfmTk6wqN3LbDcPWF8lw==&return_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return&notify_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:54:43^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"body":"商品购买","out_trade_no":"ORD17615444801932626","subject":"订单支付：ORD17615444801932626","timeout_express":"30m","total_amount":"5500"}^_^27ms,824ms,28ms^_^trace_id:06013ec2176154448455342091436129
2025-10-27 13:54:44 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 支付宝API响应 - 成功: true, 错误码: 10000, 错误信息: Success, 二维码: https://qr.alipay.com/bax05315viw1uj99oskv0080
2025-10-27 13:54:44 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 支付宝预下单成功，订单号: ORD17615444801932626, 二维码: https://qr.alipay.com/bax05315viw1uj99oskv0080
2025-10-27 13:54:44 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:54:44 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=支付处理成功, data=PaymentResponse(paymentNo=PAY1761544483284934609BD, statu (truncated)...]
2025-10-27 13:54:44 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:54:49 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615444801932626", parameters={}
2025-10-27 13:54:49 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:54:49 [http-nio-8080-exec-7] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615444801932626
2025-10-27 13:54:49 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615444801932626
2025-10-27 13:54:49 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615444801932626, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:54:49 [http-nio-8080-exec-7] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 13:54:49^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=jXhOT2f4E8ngstpCOr01LanwPohT0DGC5sz3Ks88QXSzDnjiNMMXwP7IEybPeTsJX6EG0nJSMLCWnzPCP4+0UPyQNxKxOvo830q2TedY+UH94L7oA8B3cRlprjcBvJGf6Rxo2GgW8pWDOHRt7M4Z4OHHkCrNCSfK36SmEtRoY2jUYb6lMVoHQzXO/dl361hdM6pwBLrPgZMIka3ZkGpNAaZF+S4LZLL3K+3BBvKx5yvg7lbQxErkuCkcDMrk9q+jLOmSC0zvo5n5xRmLNoLPJ2zrDM4DmNP+lQRoGi3q371RCNSbKqiVQcqoFsDlLbK38qcAb7BR08oPo/vWuCdlLA==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:54:49^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601ac3e176154449032560614904&biz_content={"out_trade_no":"ORD17615444801932626"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615444801932626","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"U1M/bTVw8ozCvGgMOUapuuSIYy7hKxdG6ifEPcH5Qagafu8iHYBbUQx3Hh9pzE9sY4wDcU453+IAXgaB4il7LXr6FPs3hrNOAXfDH4ODzwqh5p+2BlPVgZvsvgxlYyeSPUWoiK+E3Qecq6CfRYF47PEDnUpmerm8uDqjKKeMaN/qdGO5CI/SO6bEY53LPUe5cRaQNl7yOwl13u3btyqFaP5c8glsNz/L55qNAVpLqOiSyB/7w3PVoDzwPqw58K+ynPpD1+E75lv0UvbXOZO7vT69BarO3pM68FOBzbQpU3tQn7uBpnYzr0Nhkw0ZWTOPoQpjHw3pnd9uuQgnTd5REg=="}^_^15ms,466ms,23ms^_^trace_id:0601ac3e176154449032560614904
2025-10-27 13:54:49 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 13:54:49 [http-nio-8080-exec-7] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 13:54:49 [http-nio-8080-exec-7] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:54:49 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:54:49 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 13:54:49 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:54:54 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615444801932626", parameters={}
2025-10-27 13:54:54 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:54:54 [http-nio-8080-exec-4] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615444801932626
2025-10-27 13:54:54 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615444801932626
2025-10-27 13:54:54 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615444801932626, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:54:54 [http-nio-8080-exec-4] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 13:54:54^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=fzUjfYdE+jOUi/GAPd2zxSVaRXi9nSmXQP7f3lY62uZwWiUEUzA4dcHO72DauRshfgXp8iWXxuLqNVrwK8qd6zf8tUvYZw60f9WSJqFdCxSPnwMA/yMa8lRp+pwlgM0SZFGTQgazt8YE/hgzNQ1hPMSQCRsHrNty+hcoceURuSuI4YaQAt0gC8C0IP4bx4sQkUJRpJdGpA2Oa1E0FfuGEG6Itps0mWLBTBkzDsxu1RF/zOflmjtRd1CXIGRC32gfl4U7eFoB0o6/oRuZVGoEgghVUGEbs4s/ej1s2nr6ee6vhAsb6nVE6bTCVlychMz3kspaqEung0It+j7RlyU7vg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:54:54^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601ac3e176154449526360894904&biz_content={"out_trade_no":"ORD17615444801932626"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615444801932626","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"U1M/bTVw8ozCvGgMOUapuuSIYy7hKxdG6ifEPcH5Qagafu8iHYBbUQx3Hh9pzE9sY4wDcU453+IAXgaB4il7LXr6FPs3hrNOAXfDH4ODzwqh5p+2BlPVgZvsvgxlYyeSPUWoiK+E3Qecq6CfRYF47PEDnUpmerm8uDqjKKeMaN/qdGO5CI/SO6bEY53LPUe5cRaQNl7yOwl13u3btyqFaP5c8glsNz/L55qNAVpLqOiSyB/7w3PVoDzwPqw58K+ynPpD1+E75lv0UvbXOZO7vT69BarO3pM68FOBzbQpU3tQn7uBpnYzr0Nhkw0ZWTOPoQpjHw3pnd9uuQgnTd5REg=="}^_^14ms,203ms,15ms^_^trace_id:0601ac3e176154449526360894904
2025-10-27 13:54:54 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 13:54:54 [http-nio-8080-exec-4] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 13:54:54 [http-nio-8080-exec-4] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:54:54 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:54:54 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 13:54:54 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:54:59 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615444801932626", parameters={}
2025-10-27 13:54:59 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:54:59 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615444801932626
2025-10-27 13:54:59 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615444801932626
2025-10-27 13:54:59 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615444801932626, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:54:59 [http-nio-8080-exec-6] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=IP6yzQkaQBcFZ60vcp8Ruexz/eWP6Hp+Z+Bt7tjyWKnlUuHzB/p3qin2Dn5kCdg+YX9mVANcOWjRFFnZW5QNAGUAylVxDOHZb3nUFNYKR8+CX05JLc2rt8z+LvwQe/eizM06KWlLOLwak7OjQMTOHkmoqR5sdXy505+m9/51i6u6nsgnfhQLx9OuQAXwyVMr7kYndNPi/OJZXSJNN5NRoZ/uEKQbJpc7HlB3NHelXW25OJLEgXnyL3/wJxQPuf92pW2OhxxEJcOOFgpfmQTin7TQY0pFNRnlS2geCPC72FTEj5ZEhI3wBontfanj6p6Xkj2Do/hzxehLNYfTbr2VZg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:54:59^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615444801932626"}^_^16ms,339ms,18ms^_^trace_id:0601d6c717615445002673716919487
2025-10-27 13:54:59 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 13:54:59 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615444801932626, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507342970
2025-10-27 13:54:59 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:54:59 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615444801932626, status=PEND (truncated)...]
2025-10-27 13:54:59 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:55:04 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615444801932626", parameters={}
2025-10-27 13:55:04 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:55:04 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615444801932626
2025-10-27 13:55:04 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615444801932626
2025-10-27 13:55:04 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615444801932626, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:55:04 [http-nio-8080-exec-5] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=cZwB0xvZTkbcC4v7XlbAt/mdf4KQ6GxsNU08FPhnISEaWcUKyzvcdy98XAFHe+fH8yd6yF8EEvR2WSxo0FpKWUKxMaQElrrvN+mYnB5U+eHA6DK/qWBP42W5uid8idChhyC2oTbPzERUhjPEnjyD8tC8Y4/veiW7Ng93tfdIjMqdOZlkFtgtJqb2TfjTQONoe3tLioTRez0DsEs0iSgH+qX/Dt9FCZ0hoQTh4Yk5/ErdZEZhirgh9y8vJKoyCfPpaW+Mm7oNrfd4CoHY4xZL05VVKUPUXkC7/2YAPcToqQPc1BNuPiuC9gL5PrwoGDF7BQT2Z9mxzL5Grj0xq2fCbQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:55:04^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615444801932626"}^_^15ms,200ms,16ms^_^trace_id:0601ac3e176154450526661524904
2025-10-27 13:55:04 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 13:55:04 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615444801932626, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507342970
2025-10-27 13:55:04 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:55:04 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615444801932626, status=PEND (truncated)...]
2025-10-27 13:55:04 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:55:09 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615444801932626", parameters={}
2025-10-27 13:55:09 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:55:09 [http-nio-8080-exec-1] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615444801932626
2025-10-27 13:55:09 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615444801932626
2025-10-27 13:55:09 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615444801932626, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:55:09 [http-nio-8080-exec-1] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=j2MY6grKU2MSA5Bjr5OG9MApNBDOSSpAgW1DR2rfPIXFp/4gB298ejtBwKhoVI2suuNbI1Ko9EUsJtibId3IINz5yrfqImHO3eCa1wKJgmpvbqMc/EdB+5WwNwEOQSj13WYsinS9270pmHVP9taQwD9DKuDNDFb3qDlT217WRvbgsROa3bjByBzJAmOYPw+8f1OThXYdtW6O5STMB/TFgNLxiUcS4/t7JT8Z/SNJ06b+GdMHsczeQgIGFPs7yZgEyVqDbU9/RlwZGjoCxEb7Bt6gVHfmnJVBU5OlX+8wMIl4CH3NCIuwC0eSzCePxmqk/HPAGAL0cxnI2Oy0j9AquA==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:55:09^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615444801932626"}^_^15ms,400ms,16ms^_^trace_id:0601d58b176154451065280181407451
2025-10-27 13:55:09 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 13:55:09 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615444801932626, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507342970
2025-10-27 13:55:09 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:55:09 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615444801932626, status=PEND (truncated)...]
2025-10-27 13:55:09 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:55:14 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615444801932626", parameters={}
2025-10-27 13:55:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:55:14 [http-nio-8080-exec-2] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615444801932626
2025-10-27 13:55:14 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615444801932626
2025-10-27 13:55:14 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615444801932626, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:55:14 [http-nio-8080-exec-2] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=XciwRArcjxDJ7U1RkhzP50SGJUaQdfFdV/uN2fKNRbUFMdL75Q+TjAc8y/6ilZNErNoekN7WJYjU9T4BARJRliURmzkt5kL4YXcMMt82bUnaIVxqXMpW3ero06Z+QR4DV8mOeN/bsWZlngrM+7Id8QAWhDEWZOZzZdNmfQo0lQneFTgzqFW7//05huBaqUAEG3Cwj1cEFjmN1tiYRzZvKAT3FDxGOgNi5rW9oruGww+XT2oe9qyCOMaOvxxKV8hzexHLPN/0FYH4Z2UiNJR/yqgnXhAJQ2qxJi5DiLPJ/UE+lq17OG4ldaaslVuj/JZd6DKq2SVngmtt4m1qax099A==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:55:14^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615444801932626"}^_^15ms,225ms,13ms^_^trace_id:0601ac3e176154451558662144904
2025-10-27 13:55:14 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 13:55:14 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615444801932626, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507342970
2025-10-27 13:55:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:55:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615444801932626, status=SUCC (truncated)...]
2025-10-27 13:55:14 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:55:22 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/order-detail.html?orderId=21", parameters={masked}
2025-10-27 13:55:22 [http-nio-8080-exec-10] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:55:22 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/21", parameters={}
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrderById(Long)
2025-10-27 13:55:22 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 查询订单，订单ID: 21
2025-10-27 13:55:22 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 查询订单，订单ID: 21
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 21(Long)
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=OrderResponse(id=21, orderNo=ORD17615444801932626, userId=9 (truncated)...]
2025-10-27 13:55:22 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:55:22 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:55:22 [http-nio-8080-exec-9] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:55:22 [http-nio-8080-exec-9] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:55:22 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:55:22 [http-nio-8080-exec-9] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:55:22 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:55:22 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:55:22 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:55:22 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:55:40 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:55:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:55:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:55:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:55:40 [http-nio-8080-exec-8] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:55:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:55:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:55:40 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:55:40 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:55:45 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615444801932626", parameters={}
2025-10-27 13:55:45 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:55:45 [http-nio-8080-exec-7] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615444801932626
2025-10-27 13:55:45 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615444801932626
2025-10-27 13:55:45 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615444801932626, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:55:45 [http-nio-8080-exec-7] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=al8ieV9b47Ii5kRjnPeojivO8r/Emwa/8jDpATthFF9EL0DCDrnw+cRAh/wPCGOzZV4ECFUkWlwnoZRQsJxyXzeklgYFgcDBzYZEOsln/Yetsgg34s6DV8DAlJ+nQj687m9hycQv2i1u6uh9kLL+lk/U+cY2JJ+oVfBY1MNuSVcL1GzTzbpXvwv3oNULxf+UxYZZM89zDR0idABJT9/ahgLqTilLYGTPRTvLQm8QDK6BImv6qKMBKjxnc/sVZXOSQmQfeUgUB76nwpd/OR7YIbOMcD9F/L9qT8/MOPIOoOo/NhXoIEYDwhWsdaPEEC52+kSzUOjt1csJx+tQTkeWfg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:55:45^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615444801932626"}^_^15ms,305ms,17ms^_^trace_id:0601d6c717615445464744033919487
2025-10-27 13:55:45 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 13:55:45 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615444801932626, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507342970
2025-10-27 13:55:45 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:55:45 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615444801932626, status=SUCC (truncated)...]
2025-10-27 13:55:45 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:55:50 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/my-orders.html?userId=94", parameters={masked}
2025-10-27 13:55:50 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:55:50 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 13:55:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:55:50 [http-nio-8080-exec-5] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:55:50 [http-nio-8080-exec-5] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:55:50 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:55:50 [http-nio-8080-exec-5] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:55:50 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:55:50 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:55:50 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:55:50 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 9
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=21, orderNo=ORD17615444801932626, userId= (truncated)...]
2025-10-27 13:55:50 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:56:01 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:56:01 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:56:01 [http-nio-8080-exec-1] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:56:01 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:56:01 [http-nio-8080-exec-1] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:56:01 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:56:01 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:56:01 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:56:01 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 13:56:12 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:56:12 [http-nio-8080-exec-10] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:56:12 [http-nio-8080-exec-10] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:56:12 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:56:12 [http-nio-8080-exec-10] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:56:12 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:56:12 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:56:12 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:56:12 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 9
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=21, orderNo=ORD17615444801932626, userId= (truncated)...]
2025-10-27 13:56:12 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:56:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:56:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:56:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:56:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:56:15 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:56:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:56:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:56:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:56:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:56:53 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:56:53 [http-nio-8080-exec-9] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:56:53 [http-nio-8080-exec-9] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:56:53 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:56:53 [http-nio-8080-exec-9] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:56:53 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:56:53 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:56:53 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:56:53 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:56:55 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:56:55 [http-nio-8080-exec-8] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:56:55 [http-nio-8080-exec-8] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:56:55 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:56:55 [http-nio-8080-exec-8] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:56:55 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:56:55 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:56:55 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:56:55 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment", parameters={}
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.TestController#testPayment()
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [/test-payment.html]
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/test-payment.html", parameters={}
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 304
2025-10-27 13:56:59 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 13:56:59 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 13:56:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 13:56:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 13:56:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 13:56:59 [http-nio-8080-exec-4] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:56:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 13:56:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 13:56:59 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 13:56:59 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999999(Integer), 999999999(Integer), 90(Integer), 100(Integer), 下单锁定库存(String), 2025-10-27T13:59:50.441930200(LocalDateTime)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615447904443022(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T13:59:50.449841100(LocalDateTime), 2025-10-27T13:59:50.449841100(LocalDateTime)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615447904443022
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 22(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 22
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 22(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T13:59:50.455822600(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T13:59:50.455822600(LocalDateTime)
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 19
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 22, 订单号: ORD17615447904443022, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 13:59:50 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615447904443022
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=22, orderNo=ORD17615447904443022, userId (truncated)...]
2025-10-27 13:59:50 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:59:52 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/22/pay", parameters={}
2025-10-27 13:59:52 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 13:59:52 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 13:59:52 [http-nio-8080-exec-1] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:22_pay
2025-10-27 13:59:52 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 22, 支付方式: ALIPAY
2025-10-27 13:59:52 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 22, 支付方式: ALIPAY
2025-10-27 13:59:52 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 13:59:52 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 22(Long)
2025-10-27 13:59:52 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 13:59:52 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.PaymentService - 调用第三方支付平台，订单ID: 22, 支付方式: ALIPAY
2025-10-27 13:59:52 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.PaymentService - 调用支付宝支付，订单ID: 22
2025-10-27 13:59:52 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 创建真实支付宝支付订单，订单号: ORD17615447904443022, 金额: 5500
2025-10-27 13:59:52 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 调用支付宝预下单API，订单号: ORD17615447904443022, 金额: 5500, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:59:53 [http-nio-8080-exec-1] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.precreate&sign=JsaiDWods4qP6jax23QZulLO9bS07xaGub7ecCKenpgMTmIh7v9TwV7X7wdl4ncloV4rxByXyEvBMazIcblegmWkg81seZCIc182XxeqTUaT45fsQAUkTacv9QBjwtRRGvcp7eChD/FNw6XVO6izxmxHpOqZfjkkQH5YNPbCGSjY+XQrLnIpZAuIYPTf3rZ/TPEyzXNlRHe5XMiOsKAwmiaY3DXp/PYAa+fYvxdt17Rg27xujk2xuc0J595STHsx6HiaZjG7O0OVDQT7e6PC4iBsPkeRb9CPJEaBwkSytxnofkUhUycm7aoG2Bg/7IaXyLe4ZEgSWLkcYS5tKNjzeA==&return_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return&notify_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:59:52^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"body":"商品购买","out_trade_no":"ORD17615447904443022","subject":"订单支付：ORD17615447904443022","timeout_express":"30m","total_amount":"5500"}^_^15ms,648ms,17ms^_^trace_id:0601ac3e176154479415879534904
2025-10-27 13:59:53 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝API响应 - 成功: true, 错误码: 10000, 错误信息: Success, 二维码: https://qr.alipay.com/bax09045odt1bsevop4p0090
2025-10-27 13:59:53 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝预下单成功，订单号: ORD17615447904443022, 二维码: https://qr.alipay.com/bax09045odt1bsevop4p0090
2025-10-27 13:59:53 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:59:53 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=支付处理成功, data=PaymentResponse(paymentNo=PAY17615447929935F0C3068, statu (truncated)...]
2025-10-27 13:59:53 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 13:59:59 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615447904443022", parameters={}
2025-10-27 13:59:59 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 13:59:59 [http-nio-8080-exec-10] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615447904443022
2025-10-27 13:59:59 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615447904443022
2025-10-27 13:59:59 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615447904443022, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 13:59:59 [http-nio-8080-exec-10] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 13:59:59^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=Y9IqHJW/fa0fzhvln9BIpt7aLftguEx323zvUrdcrowcE1bvgXE6MhKrMtySRKeT4ncuipkmxM6WjhNxaKp0/qZsjTeZ6Iu46QlhhI/aKzjID8m/a70N7lNWLZiKEM/8K9tGC7ECXKaoZZ0LxC9AVIApGL88B3Je9LlbVZYgE10QbopeaokLtZk0wwvtGe02sP2zxJ7C9xQos90JhgE9XnvW6jPHjKWI//UipP+PNpe5eDvoC0bNQLXMcGZZ/Zu8JdTlkmjsf6SBsDgkEY3wuk8WeeqASYCeksJli/7K09Q/ioC0EfoYjB74x2hHKW4+0XdFmBM+OS6Vs7cSKEeJUg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 13:59:59^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=060389ba176154480066061341954925&biz_content={"out_trade_no":"ORD17615447904443022"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615447904443022","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"mfo2r0Lhq/RAbixvQ5zFYr2demZvqoeNYliz2NBq0vgH4PpMCJaE85sr6t4jFgEIXbmX6IuR6LgngzrFsaLBftzTvGKdrQ1gOSCzNaLOgyhd+UZI+xmumL6c7Gtiw3JHfpDt6l8Goc0y6u4X/9F3AvgB+jxDE5Y7AgfHDqtgY03q+ATp1oFIgwqc2Obj/q9F9R/22eLqJwpJLU5angE3GR0Zb6LmqdVOTLJRbLkgOyDE3Xrv4kFcmvnlHn+0CA0aakYZuW85dchmuFCWloWleJJgLE/QJw+XYXtXu11F84vJ6HoN4LO6OjwiUNabjGzD2wL6bHf6DBxnyf00gbkqPQ=="}^_^7ms,286ms,8ms^_^trace_id:060389ba176154480066061341954925
2025-10-27 13:59:59 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 13:59:59 [http-nio-8080-exec-10] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 13:59:59 [http-nio-8080-exec-10] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 13:59:59 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 13:59:59 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 13:59:59 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:00:04 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615447904443022", parameters={}
2025-10-27 14:00:04 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:00:04 [http-nio-8080-exec-2] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615447904443022
2025-10-27 14:00:04 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615447904443022
2025-10-27 14:00:04 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615447904443022, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:00:04 [http-nio-8080-exec-2] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 14:00:04^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=IZ952ZH+KCy0nTToWVo46/D8s0dUXYg0yVTtQfZV2FVVDZL1y8py/OCEmtOYk00HBBA1hugcviEbn/UzgNKUpIWVBmhcUJDFcFhEjp5Uatibs6yPCWbF0FZqzN9icDLpldnShr9k/RD2HPTlQwy8av75721J9Yfhij/PS8AavorTuUEr/bXtQf3scYtBi28KqdL874oSi4tAFqgKH5XrSMZQqPUKCXbrC7hyzNLYP4NQonfPRcBtryP6WoNbMERLBkli5G17OTysh9gJfqAxT3QnfrDi0SKgiO83+075KmGvglUGnzjFmRLfcV22U3jXiDVpOdXjyVd1g04llQO5pg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:00:04^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=060389ba176154480558361931954925&biz_content={"out_trade_no":"ORD17615447904443022"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615447904443022","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"mfo2r0Lhq/RAbixvQ5zFYr2demZvqoeNYliz2NBq0vgH4PpMCJaE85sr6t4jFgEIXbmX6IuR6LgngzrFsaLBftzTvGKdrQ1gOSCzNaLOgyhd+UZI+xmumL6c7Gtiw3JHfpDt6l8Goc0y6u4X/9F3AvgB+jxDE5Y7AgfHDqtgY03q+ATp1oFIgwqc2Obj/q9F9R/22eLqJwpJLU5angE3GR0Zb6LmqdVOTLJRbLkgOyDE3Xrv4kFcmvnlHn+0CA0aakYZuW85dchmuFCWloWleJJgLE/QJw+XYXtXu11F84vJ6HoN4LO6OjwiUNabjGzD2wL6bHf6DBxnyf00gbkqPQ=="}^_^8ms,206ms,15ms^_^trace_id:060389ba176154480558361931954925
2025-10-27 14:00:04 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 14:00:04 [http-nio-8080-exec-2] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 14:00:04 [http-nio-8080-exec-2] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:00:04 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:00:04 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 14:00:04 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:00:09 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615447904443022", parameters={}
2025-10-27 14:00:09 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:00:09 [http-nio-8080-exec-3] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615447904443022
2025-10-27 14:00:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615447904443022
2025-10-27 14:00:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615447904443022, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:00:09 [http-nio-8080-exec-3] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 14:00:09^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=Degckeys9TX8b8XgZLp9Vpx1sLcwv3MbQbhycuSQLlkRUTCQyVd9Yl4G6xkxi1Fla8Q0zDTGbfuO7U10wj02smPp7kztaezR016zpRnAocLkzIEcO8M0JLz8SNHVmM3a8RNI3hT3G4m2Ty13gJkLuKliaI6JXp9G9VuB8b6pfPTC+P57QFUCF3D1T1Ch8vdy0EUl5n9YV5glOFeih65g8M3xbphuD0lOcQh6NKLi4r4is+ysUBckxCkzm0oA8/83aTLLxrJMWKA2WhEayM3wECt0gcXS1vQ1XztATlDxssgxqChkld5TKzOec3eD4VbGXDTo90liCRop5MF8Fc3flQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:00:09^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=060389ba176154481058462321954925&biz_content={"out_trade_no":"ORD17615447904443022"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615447904443022","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"mfo2r0Lhq/RAbixvQ5zFYr2demZvqoeNYliz2NBq0vgH4PpMCJaE85sr6t4jFgEIXbmX6IuR6LgngzrFsaLBftzTvGKdrQ1gOSCzNaLOgyhd+UZI+xmumL6c7Gtiw3JHfpDt6l8Goc0y6u4X/9F3AvgB+jxDE5Y7AgfHDqtgY03q+ATp1oFIgwqc2Obj/q9F9R/22eLqJwpJLU5angE3GR0Zb6LmqdVOTLJRbLkgOyDE3Xrv4kFcmvnlHn+0CA0aakYZuW85dchmuFCWloWleJJgLE/QJw+XYXtXu11F84vJ6HoN4LO6OjwiUNabjGzD2wL6bHf6DBxnyf00gbkqPQ=="}^_^8ms,204ms,10ms^_^trace_id:060389ba176154481058462321954925
2025-10-27 14:00:09 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 14:00:09 [http-nio-8080-exec-3] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 14:00:09 [http-nio-8080-exec-3] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:00:09 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:00:09 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 14:00:09 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:00:13 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615447904443022", parameters={}
2025-10-27 14:00:13 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:00:13 [http-nio-8080-exec-9] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615447904443022
2025-10-27 14:00:13 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615447904443022
2025-10-27 14:00:13 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615447904443022, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:00:13 [http-nio-8080-exec-9] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 14:00:13^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=J0cF/xedK/MGXpQLaAwaB9HtnahK/Xmo4byQ3Qfu4qvOejyMfpUgygXnKdTfBxi5qo2jiJVob7d9ftF2qjwf9uBisPKpIJ3TB4rtWIHEIfDDJrx0dM/fz0czwYqfbH8ceT36PqHHUkyzFl2xjd3G+ENrrhm7sDOxBYb4M3g7vY6m3tHD+ei5fwBM/VS2HdnMaUkc975PF+7WCgavwWgs8/YDFiETHg/Hf1+880ce05FNZIWzp1B47GBlApxVaNCJQo83gxVdlAQ+InsqR6TwOpZR32Rc1CVbzW2P+GzGxkMYDda05aj+LdpzpLpzv2o5YSYpPO9MRdk+pIRDNeSufQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:00:13^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=060389ba176154481477262781954925&biz_content={"out_trade_no":"ORD17615447904443022"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615447904443022","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"mfo2r0Lhq/RAbixvQ5zFYr2demZvqoeNYliz2NBq0vgH4PpMCJaE85sr6t4jFgEIXbmX6IuR6LgngzrFsaLBftzTvGKdrQ1gOSCzNaLOgyhd+UZI+xmumL6c7Gtiw3JHfpDt6l8Goc0y6u4X/9F3AvgB+jxDE5Y7AgfHDqtgY03q+ATp1oFIgwqc2Obj/q9F9R/22eLqJwpJLU5angE3GR0Zb6LmqdVOTLJRbLkgOyDE3Xrv4kFcmvnlHn+0CA0aakYZuW85dchmuFCWloWleJJgLE/QJw+XYXtXu11F84vJ6HoN4LO6OjwiUNabjGzD2wL6bHf6DBxnyf00gbkqPQ=="}^_^14ms,195ms,15ms^_^trace_id:060389ba176154481477262781954925
2025-10-27 14:00:13 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 14:00:13 [http-nio-8080-exec-9] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 14:00:13 [http-nio-8080-exec-9] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:00:13 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:00:13 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 14:00:13 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:00:18 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615447904443022", parameters={}
2025-10-27 14:00:18 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:00:18 [http-nio-8080-exec-8] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615447904443022
2025-10-27 14:00:18 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615447904443022
2025-10-27 14:00:18 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615447904443022, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:00:18 [http-nio-8080-exec-8] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=Iq9muiYQidCnedcThO+Keg2q8K5Rv8p60XPk+5WVP8frKs3BlpggOp3vugGLvEC4oBooSZSt0Om2z6NAZbvnRCGjRIc++1sj6dKluDuCyuZerhlpqXhZ/oeOw5gyev0Kk1sCuD5on5GY0CuebvWxvNC1csNBUR6kwnFHhDMYgNc1950l0kasY244PFYq5rQAk3HTbLvIfaivpojNeM6qfudpBPhUckkG6I6ZOFMSyGfUMHDyphQrU4z91K/Mwh0Tsd+sRbamAXR28iVOOQBKXxpw+ldIC7Jc27ZNaetPAWHdMrJCDYV+GYP8Bz+Va6me1Z+nGjo5VWxIR8xV6JLKLA==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:00:18^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615447904443022"}^_^14ms,253ms,15ms^_^trace_id:0601d6c717615448197705821919487
2025-10-27 14:00:18 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 14:00:18 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615447904443022, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507342971
2025-10-27 14:00:18 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:00:18 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615447904443022, status=PEND (truncated)...]
2025-10-27 14:00:18 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:00:23 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615447904443022", parameters={}
2025-10-27 14:00:23 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:00:23 [http-nio-8080-exec-7] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615447904443022
2025-10-27 14:00:23 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615447904443022
2025-10-27 14:00:23 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615447904443022, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:00:23 [http-nio-8080-exec-7] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=BuBrkpZ59dBa+ht6HoxKG8jZIn1lVmpgPYo0vrhtFF3flVbGHHyXXMsjv6PIPyoRiJoB8CUCVvQQLPyKefcVdqd97uMwRyVd9sdMre0tB0LC/0zW9L6hHJrhMzXR4b5pAO1DC9UP8noBv41RETdsGzDlzvDuXUUf1Nl4Fmv5lksowpgRmyd6wZjbYjhbh/tKkG8wuDzxSUNYYffidwigtUKOhUDadJohAuhnufdhcNgiM7ph+dy2w+vRrV6kz6M0wWLpg3XUEE4W4MMBdG4D95bK8W14nA3Wr9WjHSOBNXaEGNABRFWkpJsIEINvzmbrBRMOIgSqTzHwbnG2zLE5wg==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:00:23^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615447904443022"}^_^14ms,254ms,15ms^_^trace_id:06013ec2176154482477964551436129
2025-10-27 14:00:23 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 14:00:23 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615447904443022, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507342971
2025-10-27 14:00:23 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:00:23 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615447904443022, status=PEND (truncated)...]
2025-10-27 14:00:23 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:12 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/", parameters={}
2025-10-27 14:05:12 [http-nio-8080-exec-5] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 14:05:12 [http-nio-8080-exec-5] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 14:05:12 [http-nio-8080-exec-5] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [index.html]
2025-10-27 14:05:12 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/index.html", parameters={}
2025-10-27 14:05:12 [http-nio-8080-exec-5] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:05:12 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 200
2025-10-27 14:05:12 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders", parameters={}
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getAllOrders()
2025-10-27 14:05:12 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 获取所有订单
2025-10-27 14:05:12 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 获取所有订单
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.mapper.OrderMapper.selectAll - ==>  Preparing: SELECT * FROM orders ORDER BY create_time DESC
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.mapper.OrderMapper.selectAll - ==> Parameters: 
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.mapper.OrderMapper.selectAll - <==      Total: 22
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 3(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 2(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 5(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 4(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 9(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 8(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 7(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 3
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 11(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 10(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 12(Long)
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=获取订单列表成功, data=[OrderResponse(id=22, orderNo=ORD17615447904443022, use (truncated)...]
2025-10-27 14:05:12 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:12 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 14:05:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:05:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 14:05:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 14:05:12 [http-nio-8080-exec-1] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:05:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 14:05:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 14:05:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 14:05:12 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:05:18 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment.html", parameters={}
2025-10-27 14:05:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:05:18 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:19 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 14:05:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:05:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 14:05:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 14:05:19 [http-nio-8080-exec-2] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:05:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 14:05:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 14:05:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 14:05:19 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999999(Integer), 999999999(Integer), 100(Integer), 110(Integer), 下单锁定库存(String), 2025-10-27T14:05:21.430679200(LocalDateTime)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615451214325134(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T14:05:21.436683(LocalDateTime), 2025-10-27T14:05:21.436683(LocalDateTime)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615451214325134
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 23(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 23
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 23(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T14:05:21.441666400(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T14:05:21.442662100(LocalDateTime)
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 20
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 23, 订单号: ORD17615451214325134, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 14:05:21 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615451214325134
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=23, orderNo=ORD17615451214325134, userId (truncated)...]
2025-10-27 14:05:21 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:22 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/23/pay", parameters={}
2025-10-27 14:05:22 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 14:05:22 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 14:05:22 [http-nio-8080-exec-9] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:23_pay
2025-10-27 14:05:22 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 23, 支付方式: ALIPAY
2025-10-27 14:05:22 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 23, 支付方式: ALIPAY
2025-10-27 14:05:22 [http-nio-8080-exec-9] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 14:05:22 [http-nio-8080-exec-9] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 23(Long)
2025-10-27 14:05:22 [http-nio-8080-exec-9] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 14:05:22 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.PaymentService - 调用第三方支付平台，订单ID: 23, 支付方式: ALIPAY
2025-10-27 14:05:22 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.PaymentService - 调用支付宝支付，订单ID: 23
2025-10-27 14:05:22 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 创建真实支付宝支付订单，订单号: ORD17615451214325134, 金额: 5500
2025-10-27 14:05:22 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 调用支付宝预下单API，订单号: ORD17615451214325134, 金额: 5500, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:05:23 [http-nio-8080-exec-9] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.precreate&sign=cpqis5aO3fUwDOHXlg1iJ5ff07muVjotiLLpF1eKGYpa7CPcKQWS6vFFp+Cqj0ZIN59agI8wO2HyFS9vN/zGmIxQ36gw18jRg/dJm5n/xh5Of7ShtIryEA1/No3QyQYQFJpPxL0DPwjXnhA3CDZkiHhirtPZyLXzYtMHUTt/S60W+H+b5+yRNbIVMzwMgvfkP4xQK3FdWL+dblz2LoZ7PONNyubub4av+4lV7WSpKOObDJT+LCV4wp3jZm/5pjs4Rp1G/Y37KxjRbQOsM9P2RLuNcrVlW9kZuFJVkzJyKGIKxAAsfZX1Z/6nQEjNqFfSbJV5wsJoAq0KPIU7dDdoIw==&return_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return&notify_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:05:22^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"body":"商品购买","out_trade_no":"ORD17615451214325134","subject":"订单支付：ORD17615451214325134","timeout_express":"30m","total_amount":"5500"}^_^15ms,572ms,22ms^_^trace_id:0601d6c717615451238007950919487
2025-10-27 14:05:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝API响应 - 成功: true, 错误码: 10000, 错误信息: Success, 二维码: https://qr.alipay.com/bax06601kjtczfowipvd0052
2025-10-27 14:05:23 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝预下单成功，订单号: ORD17615451214325134, 二维码: https://qr.alipay.com/bax06601kjtczfowipvd0052
2025-10-27 14:05:23 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:05:23 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=支付处理成功, data=PaymentResponse(paymentNo=PAY17615451226226D9B324D, statu (truncated)...]
2025-10-27 14:05:23 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:28 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615451214325134", parameters={}
2025-10-27 14:05:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:05:28 [http-nio-8080-exec-8] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615451214325134
2025-10-27 14:05:28 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615451214325134
2025-10-27 14:05:28 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615451214325134, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:05:28 [http-nio-8080-exec-8] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 14:05:28^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=EMGyul/GEGPWB1p1lU/VmBQeLb+vN2nyzVIiIWURNOZJwtLqlD0vprdBe9EIq14c26ZRMQTecVET7EfP96Jz09EfN3YqRho8Ho7yZ1rXwACM8zqE9iq1a4fRc0y0mUmYczWrzroFXjKEynGdC9eL92aGQsodt398OGrdtEThcZ3x6A1Ynm7bLR+VYpmGccw2+cfcrnXHRnXzjSf6YbiG1ASJ32En868WMedA9Og+nmz/DXbjv1gznFbvWGfP78TU81csAS5ylNMvrpvUDE9ci1w37m49JsB8Yk/VQE6b4R0DPT2JT3WHiXEu0Cy8yiwKRIWVNd9bOKgLfZeDYZL4Hw==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:05:28^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601ac3e176154512950623664904&biz_content={"out_trade_no":"ORD17615451214325134"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615451214325134","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"CBUK2nocHq4z7QqrXKvYj09DBlaGRe9xDaiFcnLxKVsh68KJ+VaLUtDKtLjzYm3vLiVIJNgxjvjDPpO05g7xSMi9Uz7ycrpHNqqo+HI40humIu9j2ylEknkZGwq1pKmUOvlEUzivojJaefA8BH0SNdRr1eoFEL3qdp/U+wDXPH9BsmNkZJdnR6iFuqn0pwj01i0EVmilGDhVY2rudFfHxsbEMk0Vgly5juNKRUcIdsMJG6oJgWP6s6WxQmhdUF1migvKzuofzgmRmD4+NkdEeKXcOXagdzQVmpApPPYPM7R0ZTVuvAU8JLnfaC1K7ZFeDnVnbDYX4FyzjQfLPlpmig=="}^_^13ms,294ms,16ms^_^trace_id:0601ac3e176154512950623664904
2025-10-27 14:05:28 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 14:05:28 [http-nio-8080-exec-8] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 14:05:28 [http-nio-8080-exec-8] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:134)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:05:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:05:28 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 14:05:28 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:33 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615451214325134", parameters={}
2025-10-27 14:05:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:05:33 [http-nio-8080-exec-7] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615451214325134
2025-10-27 14:05:33 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615451214325134
2025-10-27 14:05:33 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615451214325134, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:05:33 [http-nio-8080-exec-7] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=cajkWOuqEWMJlkr7rP0unp3SnVSH6SNi3Qe/kt9LSWmM8nHW3SQyH9yrw+qtRRWHvko7h8IAREIc6EV/DI+pRwKzKlCwszU5aZDWMP7IUVyKafdM13+/tZo44euykMTDOKr2hWw1J/82/Qabx2/+RIAcBktPvVfF4gXwX16N2TqiKN+J0BAlZtljzllDGzHoBKUEE7+Q/Zy+8/ccXTJ+40p3v4HJqLpbNOkNMpK0qB/bHvo3Un8YivFuKkrYWOJFEVfevOwkq1bZGQsQU8FcIgznOT2ULPRKO1VatCZsCGx1oc6guh8hiHamEcznW6GHu2igMc3C4Zcmr9rtovCk1g==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:05:33^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615451214325134"}^_^15ms,252ms,15ms^_^trace_id:06013ec2176154513443986361436129
2025-10-27 14:05:33 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 14:05:33 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615451214325134, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507346002
2025-10-27 14:05:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:05:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615451214325134, status=PEND (truncated)...]
2025-10-27 14:05:33 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:38 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615451214325134", parameters={}
2025-10-27 14:05:38 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:05:38 [http-nio-8080-exec-4] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615451214325134
2025-10-27 14:05:38 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615451214325134
2025-10-27 14:05:38 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615451214325134, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:05:38 [http-nio-8080-exec-4] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=U9tGzhj5I3LukV6yMXsP0OQHCE4tyGs01KAQo6sBrtvW7bRN6rcgvKod/k/2sIcCDUDG39YcfkO44hBJX/3Qcr/KjT3KwRzkrMg4VyBOclBaICRA3QsmIje62UqNQAWVjMt/IBWTaDHHu5R5WTJnZZxTb2vTwC/qiCE9cVjKv8N8iOvy+wKJIbZhnBAtbL7QASXGeIzcqtzPW6Z3Sl02/498JF4acjZm86Eqo/bVhcOc4VKG2/YmCeCBVjFtwbXPTM16u8I+/tZqW8/uu0BCpEeIFeeZ6WsGf7hvYNIjp0KmkcnmocHcGcBCsbUujEw8nll47rweIAyd4N7Y+z1yxw==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:05:38^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615451214325134"}^_^13ms,422ms,18ms^_^trace_id:0601d58b176154513945342001407451
2025-10-27 14:05:38 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 14:05:38 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615451214325134, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507346002
2025-10-27 14:05:38 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:05:38 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615451214325134, status=PEND (truncated)...]
2025-10-27 14:05:38 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:40 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/payment/alipay/notify", parameters={masked}
2025-10-27 14:05:40 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#alipayNotify(HttpServletRequest)
2025-10-27 14:05:45 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615451214325134", parameters={}
2025-10-27 14:05:45 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 14:05:45 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615451214325134, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 收到支付宝支付回调通知
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: gmt_create = 2025-10-27 14:05:33
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: charset = UTF-8
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: seller_email = gvmmnq2968@sandbox.com
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: subject = 订单支付：ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: sign = XKuJrc/bTddEO7XvOWnYTC9LKoyG+hiSBH0P3aaQOrBvlQxH/j2bqk7EDitWCCHj6ejB1hnqlnp5vGTuhwSlgYPz/GXl7tjNeqxDsYop19T0C8JjG8A3M342YdrTvdFc73jisJDQa1mjnkdegqcoLEeJgHUPNpCrzfQjBlOmJuHrmSr4XEqQua/t9SiYXoVEVFn2WpYaePNOJZ5YS4DNesedoeLcZ59ralAZB7MkDzmr8rFRtlNgZ3lnOGXGi2KJxYZoIWFHTzSofZ0k20CFgcs9OPPb97cv8ZCBcMz7Ulqir/niD5zDrQuF4jYU3o4aHGn14TRRxTTwvgaQey3FnQ==
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: buyer_id = 2088722085542274
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: body = 商品购买
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: invoice_amount = 5500.00
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: notify_id = 2025102701222140540042270507220731
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: fund_bill_list = [{"amount":"5500.00","fundChannel":"ALIPAYACCOUNT"}]
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: notify_type = trade_status_sync
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: trade_status = TRADE_SUCCESS
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: receipt_amount = 5500.00
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: buyer_pay_amount = 5500.00
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: app_id = 9021000157614744
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: sign_type = RSA2
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: seller_id = 2088721085542262
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: gmt_payment = 2025-10-27 14:05:39
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: notify_time = 2025-10-27 14:05:41
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: version = 1.0
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: out_trade_no = ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: total_amount = 5500.00
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: trade_no = 2025102722001442270507346002
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: auth_app_id = 9021000157614744
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: buyer_logon_id = bwugqj4497@sandbox.com
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 回调参数: point_amount = 0.00
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 支付回调处理 - 订单号: ORD17615451214325134, 状态: TRADE_SUCCESS, 金额: 5500.00, 支付宝交易号: 2025102722001442270507346002
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 开始处理支付成功回调，支付流水号: ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.O.updateStatusByPaymentNo - ==>  Preparing: UPDATE orders SET status = ?, update_time = NOW() WHERE order_no = ?
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.O.updateStatusByPaymentNo - ==> Parameters: PAID(String), ORD17615451214325134(String)
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.O.updateStatusByPaymentNo - <==    Updates: 1
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 订单状态更新为已支付，订单号: ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 开始扣减库存，订单号: ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 根据订单号扣减库存，订单号: ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderNo - ==>  Preparing: SELECT oi.* FROM order_items oi INNER JOIN orders o ON oi.order_id = o.id WHERE o.order_no = ?
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderNo - ==> Parameters: ORD17615451214325134(String)
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderNo - <==      Total: 1
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 扣减库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.deductStock - ==>  Preparing: UPDATE inventory SET current_stock = current_stock - ?, locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.deductStock - ==> Parameters: 10(Integer), 10(Integer), 2002(Long), 10(Integer)
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.InventoryMapper.deductStock - <==    Updates: 1
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, OUT(String), 10(Integer), 1000000009(Integer), 999999999(Integer), 110(Integer), 100(Integer), 支付成功扣减库存(String), 2025-10-27T14:05:45.223753500(LocalDateTime)
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存扣减成功，商品ID: 2002, 扣减数量: 10
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 商品库存扣减成功，商品ID: 2002, 数量: 10
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 订单库存扣减完成，订单号: ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 支付成功处理完成，订单号: ORD17615451214325134
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'text/plain', given [*/*] and supported [text/plain, */*, application/json, application/*+json]
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing ["success"]
2025-10-27 14:05:45 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:45 [http-nio-8080-exec-6] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=X/UKER96v98JQbz4ZR/Gu3tLoMaE5mSIjrAZJFERlOheki/Ee6lq0mLjzcjndS4qIux/hVBT61jx/hUmrQAYselKd3SjkI/CaCqfZd8TrV2k5WQHR/WWbV4TlSakGsR9jTjjiz2/BwN0Evpod0QG/zGEoTMZa0rxAaiO2xTUE5kzJtjRnMDWru886lsSZrfWxQmvoHOFmTvn72XjlFnHIP1gcByi9IJ9ZZTkijFdl1wOeDpUAC2LUwgFqlwpXixDlda54sA+ArILvZNt+5AmqQTNt7DFYX1FcYXLOg6VaBUAvTDJ2jdeDEFdWVu3TvJDvfqW1VHok+h1zzosDHfY2Q==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 14:05:45^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615451214325134"}^_^8ms,294ms,8ms^_^trace_id:0601d58b176154514634842511407451
2025-10-27 14:05:45 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 14:05:45 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615451214325134, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507346002
2025-10-27 14:05:45 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:05:45 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615451214325134, status=SUCC (truncated)...]
2025-10-27 14:05:45 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:55 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/order-detail.html?orderId=23", parameters={masked}
2025-10-27 14:05:55 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:05:55 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/23", parameters={}
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrderById(Long)
2025-10-27 14:05:55 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 查询订单，订单ID: 23
2025-10-27 14:05:55 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 查询订单，订单ID: 23
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 23(Long)
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=OrderResponse(id=23, orderNo=ORD17615451214325134, userId=9 (truncated)...]
2025-10-27 14:05:55 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:05:55 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 14:05:55 [http-nio-8080-exec-2] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:05:55 [http-nio-8080-exec-2] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 14:05:55 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 14:05:55 [http-nio-8080-exec-2] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:05:55 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 14:05:55 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 14:05:55 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 14:05:55 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:10:32 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 14:10:32 [http-nio-8080-exec-8] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:10:32 [http-nio-8080-exec-8] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 14:10:32 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 14:10:32 [http-nio-8080-exec-8] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:10:32 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 14:10:32 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 14:10:32 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 14:10:32 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:10:33 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 14:10:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:10:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 14:10:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 14:10:33 [http-nio-8080-exec-7] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:10:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 14:10:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 14:10:33 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 14:10:33 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:10:35 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment.html", parameters={}
2025-10-27 14:10:35 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:10:35 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 14:10:35 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 14:10:35 [http-nio-8080-exec-5] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 14:10:35 [http-nio-8080-exec-5] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 14:10:35 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 14:10:35 [http-nio-8080-exec-5] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:10:35 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 14:10:35 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 14:10:35 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 14:10:35 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999989(Integer), 999999989(Integer), 100(Integer), 110(Integer), 下单锁定库存(String), 2025-10-27T14:10:37.297784900(LocalDateTime)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615454373000005(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T14:10:37.304387400(LocalDateTime), 2025-10-27T14:10:37.304387400(LocalDateTime)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615454373000005
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 24(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 24
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 24(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T14:10:37.309370800(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T14:10:37.309370800(LocalDateTime)
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 21
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 24, 订单号: ORD17615454373000005, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 14:10:37 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615454373000005
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=24, orderNo=ORD17615454373000005, userId (truncated)...]
2025-10-27 14:10:37 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 14:10:37 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 14:10:37 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 14:10:37 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 14:10:37 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 14:10:37 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 14:10:37 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 14:10:37 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 14:10:37 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 14:10:37 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 14:10:37 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 14:10:37 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 14:10:37 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 14:10:38 [http-nio-8080-exec-1] WARN  c.j.a.PreventDuplicateSubmissionAspect - 检测到重复提交，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 14:10:38 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
2025-10-27 14:10:38 [http-nio-8080-exec-1] ERROR c.j.exception.GlobalExceptionHandler - 运行时异常
java.lang.RuntimeException: 请勿重复提交相同订单
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:51)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:10:38 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:10:38 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误: 请勿重复提交相同订单, data=null)]
2025-10-27 14:10:38 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.RuntimeException: 请勿重复提交相同订单]
2025-10-27 14:10:38 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:10:38 [http-nio-8080-exec-10] WARN  c.j.a.PreventDuplicateSubmissionAspect - 检测到重复提交，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 14:10:38 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
2025-10-27 14:10:38 [http-nio-8080-exec-10] ERROR c.j.exception.GlobalExceptionHandler - 运行时异常
java.lang.RuntimeException: 请勿重复提交相同订单
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:51)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:10:38 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:10:38 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误: 请勿重复提交相同订单, data=null)]
2025-10-27 14:10:38 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.RuntimeException: 请勿重复提交相同订单]
2025-10-27 14:10:38 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:10:38 [http-nio-8080-exec-2] WARN  c.j.a.PreventDuplicateSubmissionAspect - 检测到重复提交，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 14:10:38 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
2025-10-27 14:10:38 [http-nio-8080-exec-2] ERROR c.j.exception.GlobalExceptionHandler - 运行时异常
java.lang.RuntimeException: 请勿重复提交相同订单
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:51)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:10:38 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:10:38 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误: 请勿重复提交相同订单, data=null)]
2025-10-27 14:10:38 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.RuntimeException: 请勿重复提交相同订单]
2025-10-27 14:10:38 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:10:38 [http-nio-8080-exec-3] WARN  c.j.a.PreventDuplicateSubmissionAspect - 检测到重复提交，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 14:10:38 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
2025-10-27 14:10:38 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 运行时异常
java.lang.RuntimeException: 请勿重复提交相同订单
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:51)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 14:10:38 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 14:10:38 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误: 请勿重复提交相同订单, data=null)]
2025-10-27 14:10:38 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.RuntimeException: 请勿重复提交相同订单]
2025-10-27 14:10:38 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 14:50:29 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-27 14:50:29 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-27 15:00:25 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 40836 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 15:00:25 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 15:00:25 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 15:00:26 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 15:00:26 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 15:00:26 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 29 ms. Found 0 Redis repository interfaces.
2025-10-27 15:00:28 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 15:00:28 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 15:00:28 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 15:00:28 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 15:00:28 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3505 ms
2025-10-27 15:00:29 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 15:00:29 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 15:00:29 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:00:29 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:00:30 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'orderController' defined in file [D:\软件\ideaproject\jiaoyi\target\classes\com\jiaoyi\controller\OrderController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'orderService' defined in file [D:\软件\ideaproject\jiaoyi\target\classes\com\jiaoyi\service\OrderService.class]: Unsatisfied dependency expressed through constructor parameter 5: Error creating bean with name 'orderTimeoutMessageService': Unsatisfied dependency expressed through field 'rocketMQTemplate': No qualifying bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}
2025-10-27 15:00:30 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-10-27 15:00:30 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 15:00:30 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Field rocketMQTemplate in com.jiaoyi.service.OrderTimeoutMessageService required a bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' that could not be found.


Action:

Consider defining a bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' in your configuration.

2025-10-27 15:01:13 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 41404 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 15:01:13 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 15:01:13 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 15:01:13 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 15:01:13 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 15:01:13 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-27 15:01:14 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 15:01:14 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 15:01:14 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 15:01:14 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 15:01:14 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1358 ms
2025-10-27 15:01:14 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 15:01:14 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 15:01:14 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:01:14 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:01:15 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'orderController' defined in file [D:\软件\ideaproject\jiaoyi\target\classes\com\jiaoyi\controller\OrderController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'orderService' defined in file [D:\软件\ideaproject\jiaoyi\target\classes\com\jiaoyi\service\OrderService.class]: Unsatisfied dependency expressed through constructor parameter 5: Error creating bean with name 'orderTimeoutMessageService': Unsatisfied dependency expressed through field 'rocketMQTemplate': No qualifying bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}
2025-10-27 15:01:15 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-10-27 15:01:15 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 15:01:15 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Field rocketMQTemplate in com.jiaoyi.service.OrderTimeoutMessageService required a bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' that could not be found.


Action:

Consider defining a bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' in your configuration.

2025-10-27 15:15:17 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 17840 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 15:15:17 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 15:15:17 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 15:15:18 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 15:15:18 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 15:15:18 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-27 15:15:18 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 15:15:18 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 15:15:18 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 15:15:18 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 15:15:18 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1251 ms
2025-10-27 15:15:19 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 15:15:19 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 15:15:19 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:15:19 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:15:19 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 15:15:20 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 15:15:20 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 15:15:20 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 15:15:20 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 15:15:20 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 15:15:20 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 15:15:20 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 3.446 seconds (process running for 3.691)
2025-10-27 15:29:52 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 37416 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 15:29:52 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 15:29:52 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 15:29:53 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 15:29:53 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 15:29:53 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-10-27 15:29:53 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 15:29:53 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 15:29:53 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 15:29:53 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 15:29:53 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1439 ms
2025-10-27 15:29:53 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 15:29:54 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 15:29:54 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:29:54 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:29:54 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'orderController': Lookup method resolution failed
2025-10-27 15:29:54 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-10-27 15:29:54 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 15:29:54 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'orderController': Lookup method resolution failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.checkLookupMethods(AutowiredAnnotationBeanPostProcessor.java:482)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1295)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1190)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:563)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:973)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:946)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.jiaoyi.JiaoyiApplication.main(JiaoyiApplication.java:15)
Caused by: java.lang.IllegalStateException: Failed to introspect Class [com.jiaoyi.controller.OrderController] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@36baf30c]
	at org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:483)
	at org.springframework.util.ReflectionUtils.doWithLocalMethods(ReflectionUtils.java:320)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.checkLookupMethods(AutowiredAnnotationBeanPostProcessor.java:460)
	... 19 common frames omitted
Caused by: java.lang.NoClassDefFoundError: OrderStatus
	at java.base/java.lang.Class.getDeclaredMethods0(Native Method)
	at java.base/java.lang.Class.privateGetDeclaredMethods(Class.java:3578)
	at java.base/java.lang.Class.getDeclaredMethods(Class.java:2676)
	at org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:465)
	... 21 common frames omitted
Caused by: java.lang.ClassNotFoundException: OrderStatus
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)
	at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:526)
	... 25 common frames omitted
2025-10-27 15:30:35 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 28652 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 15:30:35 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 15:30:35 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 15:30:36 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 15:30:36 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 15:30:36 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-27 15:30:37 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 15:30:37 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 15:30:37 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 15:30:37 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 15:30:37 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1336 ms
2025-10-27 15:30:37 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 15:30:37 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 15:30:37 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:30:37 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:30:38 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 15:30:38 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 15:30:38 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 15:30:38 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 15:30:38 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 15:30:38 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 15:30:38 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2025-10-27 15:30:38 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 15:30:38 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2025-10-27 15:30:58 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 11260 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 15:30:58 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 15:30:58 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 15:30:59 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 15:30:59 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 15:30:59 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-27 15:31:00 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 15:31:00 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 15:31:00 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 15:31:00 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 15:31:00 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1301 ms
2025-10-27 15:31:00 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 15:31:00 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 15:31:00 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:31:00 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:31:00 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 15:31:01 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 15:31:01 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 15:31:01 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 15:31:01 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 15:31:01 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 15:31:01 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2025-10-27 15:31:01 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 15:31:01 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2025-10-27 15:31:16 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 38456 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 15:31:16 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 15:31:16 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 15:31:16 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 15:31:16 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 15:31:16 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-10-27 15:31:17 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 15:31:17 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 15:31:17 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 15:31:17 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 15:31:17 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1376 ms
2025-10-27 15:31:17 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 15:31:17 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 15:31:17 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:31:17 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:31:18 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 15:31:18 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 15:31:18 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 15:31:18 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 15:31:18 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 15:31:19 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 15:31:19 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 15:31:19 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 3.293 seconds (process running for 3.885)
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 15:31:19 [RMI TCP Connection(3)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@7808f8c0
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@7e82de99
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 15:31:19 [RMI TCP Connection(4)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-10-27 15:31:19 [RMI TCP Connection(3)-192.168.0.120] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@66ba2171
2025-10-27 15:31:19 [RMI TCP Connection(3)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 15:32:08 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-27 15:32:08 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-27 15:37:22 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 17492 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 15:37:22 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 15:37:22 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 15:37:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 15:37:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 15:37:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-10-27 15:37:23 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 15:37:23 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 15:37:23 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 15:37:23 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 15:37:23 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1386 ms
2025-10-27 15:37:24 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 15:37:24 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 15:37:24 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:37:24 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 15:37:24 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 15:37:24 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 15:37:24 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 15:37:24 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 15:37:24 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 15:37:25 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 15:37:25 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 15:37:25 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 3.172 seconds (process running for 3.43)
2025-10-27 16:15:53 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 40748 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 16:15:53 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 16:15:53 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 16:15:53 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 16:15:53 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 16:15:53 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 12 ms. Found 0 Redis repository interfaces.
2025-10-27 16:15:54 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 16:15:54 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 16:15:54 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 16:15:54 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 16:15:54 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1437 ms
2025-10-27 16:15:54 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 16:15:54 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 16:15:55 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:15:55 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:15:55 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 16:15:55 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 16:15:55 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 16:15:55 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 16:15:55 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 16:15:56 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 16:15:56 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2025-10-27 16:15:56 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 16:15:56 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2025-10-27 16:18:19 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 28700 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 16:18:19 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 16:18:19 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 16:18:21 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 16:18:21 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 16:18:21 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 28 ms. Found 0 Redis repository interfaces.
2025-10-27 16:18:23 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 16:18:23 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 16:18:23 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 16:18:23 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 16:18:23 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3090 ms
2025-10-27 16:18:23 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 16:18:23 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 16:18:24 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:18:24 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:18:25 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 16:18:25 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 16:18:25 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 16:18:25 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 16:18:25 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 16:18:26 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 16:18:26 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 16:18:26 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 7.322 seconds (process running for 9.051)
2025-10-27 16:19:10 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 16:19:10 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@78517c66
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@590cfccf
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 16:19:10 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment.html", parameters={}
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:19:10 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 16:19:10 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:19:10 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:19:10 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:19:10 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:19:10 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:19:10 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:19:10 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:19:10 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:19:10 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:19:11 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 16:19:11 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 16:19:12 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 16:19:12 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 16:19:12 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 16:19:12 [http-nio-8080-exec-6] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 16:19:12 [http-nio-8080-exec-6] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@124199ed
2025-10-27 16:19:12 [http-nio-8080-exec-6] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 16:19:13 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 16:19:13 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 16:19:13 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 16:19:13 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 16:19:13 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 16:19:13 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 16:19:13 [http-nio-8080-exec-6] ERROR c.jiaoyi.controller.OrderController - 创建订单失败
java.lang.IllegalArgumentException: Result Maps collection does not contain value for com.jiaoyi.mapper.OrderMapper.BaseResultMap
	at org.apache.ibatis.session.Configuration$StrictMap.get(Configuration.java:1097)
	at org.apache.ibatis.session.Configuration.getResultMap(Configuration.java:794)
	at org.apache.ibatis.builder.MapperBuilderAssistant.getStatementResultMaps(MapperBuilderAssistant.java:321)
	at org.apache.ibatis.builder.MapperBuilderAssistant.addMappedStatement(MapperBuilderAssistant.java:214)
	at org.apache.ibatis.builder.xml.XMLStatementBuilder.parseStatementNode(XMLStatementBuilder.java:120)
	at org.apache.ibatis.session.Configuration.lambda$buildAllStatements$2(Configuration.java:935)
	at java.base/java.util.Collection.removeIf(Collection.java:583)
	at org.apache.ibatis.session.Configuration.buildAllStatements(Configuration.java:934)
	at org.apache.ibatis.session.Configuration.hasStatement(Configuration.java:912)
	at org.apache.ibatis.session.Configuration.hasStatement(Configuration.java:907)
	at org.apache.ibatis.binding.MapperMethod$SqlCommand.resolveMappedStatement(MapperMethod.java:253)
	at org.apache.ibatis.binding.MapperMethod$SqlCommand.<init>(MapperMethod.java:225)
	at org.apache.ibatis.binding.MapperMethod.<init>(MapperMethod.java:53)
	at org.apache.ibatis.binding.MapperProxy.lambda$cachedInvoker$0(MapperProxy.java:96)
	at java.base/java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1708)
	at org.apache.ibatis.util.MapUtil.computeIfAbsent(MapUtil.java:36)
	at org.apache.ibatis.binding.MapperProxy.cachedInvoker(MapperProxy.java:94)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86)
	at jdk.proxy2/jdk.proxy2.$Proxy106.selectByProductId(Unknown Source)
	at com.jiaoyi.service.InventoryService.checkAndLockStock(InventoryService.java:37)
	at com.jiaoyi.service.InventoryService.checkAndLockStockBatch(InventoryService.java:161)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.InventoryService$$SpringCGLIB$$0.checkAndLockStockBatch(<generated>)
	at com.jiaoyi.service.OrderService.createOrder(OrderService.java:70)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.jiaoyi.controller.OrderController.createOrder(OrderController.java:46)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.createOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:19:13 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:19:13 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=创建订单失败: Result Maps collection does not contain value for com.jiaoyi.m (truncated)...]
2025-10-27 16:19:13 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=??, receiverPhone=13800138000, receiverAddress=??????xxx? (truncated)...]
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:98rz763gKjDDwJqBO4Ff9g==
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999989(Integer), 999999989(Integer), 110(Integer), 120(Integer), 下单锁定库存(String), 2025-10-27T16:21:50.582060300(LocalDateTime)
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615533106128443(String), 94(Long), PENDING(String), 600.00(BigDecimal), null, null, 0(BigDecimal), 600.00(BigDecimal), ??(String), 13800138000(String), ??????xxx??(String), ????(String), 2025-10-27T16:21:50.616292800(LocalDateTime), 2025-10-27T16:21:50.616292800(LocalDateTime)
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615533106128443
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 25(Long), 2002(Long), ??2(String), null, 60.00(BigDecimal), 10(Integer), 600.00(BigDecimal)
2025-10-27 16:21:50 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 16:21:50 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 25, 订单号: ORD17615533106128443, 总金额: 600.00, 优惠金额: 0, 实际支付: 600.00
2025-10-27 16:22:08 [http-nio-8080-exec-5] WARN  c.j.s.OrderTimeoutMessageService - RocketMQ不可用，跳过发送延迟消息，订单ID: 25, 订单号: ORD17615533106128443
2025-10-27 16:22:09 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单超时延迟消息已发送，订单将在30分钟后自动取消（如果未支付），订单ID: 25, 订单号: ORD17615533106128443
2025-10-27 16:22:09 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 16:22:09 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615533106128443
2025-10-27 16:22:09 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:22:09 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=25, orderNo=ORD17615533106128443, userId (truncated)...]
2025-10-27 16:22:09 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:22:16 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-27 16:22:16 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-27 16:22:25 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 27488 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 16:22:25 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 16:22:25 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 16:22:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 16:22:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 16:22:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 28 ms. Found 0 Redis repository interfaces.
2025-10-27 16:22:28 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 16:22:28 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 16:22:28 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 16:22:29 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 16:22:29 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3628 ms
2025-10-27 16:22:29 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 16:22:29 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 16:22:30 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:22:30 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:22:31 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'orderController' defined in file [D:\软件\ideaproject\jiaoyi\target\classes\com\jiaoyi\controller\OrderController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'orderService' defined in file [D:\软件\ideaproject\jiaoyi\target\classes\com\jiaoyi\service\OrderService.class]: Unsatisfied dependency expressed through constructor parameter 5: Error creating bean with name 'orderTimeoutMessageService': Unsatisfied dependency expressed through field 'rocketMQTemplate': No qualifying bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}
2025-10-27 16:22:31 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-10-27 16:22:31 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 16:22:31 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Field rocketMQTemplate in com.jiaoyi.service.OrderTimeoutMessageService required a bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' that could not be found.


Action:

Consider defining a bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' in your configuration.

2025-10-27 16:22:31 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 29888 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 16:22:31 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 16:22:31 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 16:22:32 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 16:22:32 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 16:22:32 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-27 16:22:33 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 16:22:33 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 16:22:33 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 16:22:33 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 16:22:33 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1352 ms
2025-10-27 16:22:33 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 16:22:33 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 16:22:33 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:22:33 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:22:34 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'orderController' defined in file [D:\软件\ideaproject\jiaoyi\target\classes\com\jiaoyi\controller\OrderController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'orderService' defined in file [D:\软件\ideaproject\jiaoyi\target\classes\com\jiaoyi\service\OrderService.class]: Unsatisfied dependency expressed through constructor parameter 5: Error creating bean with name 'orderTimeoutMessageService': Unsatisfied dependency expressed through field 'rocketMQTemplate': No qualifying bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}
2025-10-27 16:22:34 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-10-27 16:22:34 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 16:22:34 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Field rocketMQTemplate in com.jiaoyi.service.OrderTimeoutMessageService required a bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' that could not be found.


Action:

Consider defining a bean of type 'org.apache.rocketmq.spring.core.RocketMQTemplate' in your configuration.

2025-10-27 16:34:48 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 34604 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 16:34:48 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 16:34:48 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 16:34:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 16:34:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 16:34:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-10-27 16:34:49 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:34:49 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:34:49 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:34:49 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:34:49 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketMQMessageListenerContainerRegistrar' of type [org.apache.rocketmq.spring.support.RocketMQMessageListenerContainerRegistrar] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:34:49 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 16:34:49 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 16:34:49 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 16:34:49 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 16:34:49 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1279 ms
2025-10-27 16:34:49 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 16:34:49 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 16:34:49 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:34:49 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:34:50 [main] INFO  o.a.r.s.a.RocketMQAutoConfiguration - a producer (order-timeout-producer-group) init on namesrv localhost:9876
2025-10-27 16:34:50 [main] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 16:34:50 [main] INFO  o.a.r.s.s.RocketMQMessageListenerContainerRegistrar - Register the listener to container, listenerBeanName:orderTimeoutMessageService, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-10-27 16:34:50 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 16:34:50 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 16:34:50 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 16:34:50 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 16:34:50 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 16:34:51 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 16:34:51 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 16:34:51 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 3.456 seconds (process running for 3.979)
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 16:34:51 [RMI TCP Connection(1)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@765565b7
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@4e0f732f
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 16:34:51 [RMI TCP Connection(4)-192.168.0.120] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-10-27 16:34:51 [RMI TCP Connection(1)-192.168.0.120] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@128f094c
2025-10-27 16:34:51 [RMI TCP Connection(1)-192.168.0.120] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 16:35:03 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment.html", parameters={}
2025-10-27 16:35:03 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:35:03 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 16:35:04 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:35:04 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:35:04 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:35:04 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:35:04 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:35:04 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:35:04 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:35:04 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:35:04 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999989(Integer), 999999989(Integer), 120(Integer), 130(Integer), 下单锁定库存(String), 2025-10-27T16:35:05.337272500(LocalDateTime)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615541053437680(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T16:35:05.352342500(LocalDateTime), 2025-10-27T16:35:05.352342500(LocalDateTime)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615541053437680
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 26(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 26
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 26(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T16:35:05.367034900(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T16:35:05.367034900(LocalDateTime)
2025-10-27 16:35:05 [http-nio-8080-exec-2] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 22
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 16:35:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 26, 订单号: ORD17615541053437680, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 16:35:17 [http-nio-8080-exec-2] INFO  c.j.s.OrderTimeoutMessageService - 发送订单超时延迟消息，订单ID: 26, 订单号: ORD17615541053437680, 延迟: 1分钟
2025-10-27 16:35:24 [http-nio-8080-exec-2] INFO  c.j.s.OrderTimeoutMessageService - 订单超时延迟消息发送成功，订单ID: 26, 延迟级别: 1
2025-10-27 16:35:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 订单超时延迟消息已发送，订单将在30分钟后自动取消（如果未支付），订单ID: 26, 订单号: ORD17615541053437680
2025-10-27 16:35:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 16:35:24 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615541053437680
2025-10-27 16:35:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:35:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=26, orderNo=ORD17615541053437680, userId (truncated)...]
2025-10-27 16:35:24 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:35:46 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 接收到订单超时消息，订单ID: 26, 订单号: ORD17615541053437680
2025-10-27 16:36:09 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=45s97ms989µs500ns).
2025-10-27 16:36:09 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/my-orders.html", parameters={}
2025-10-27 16:36:09 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/26/pay", parameters={}
2025-10-27 16:36:09 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 16:36:09 [http-nio-8080-exec-6] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:36:09 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:36:09 [http-nio-8080-exec-7] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:36:10 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:36:10 [http-nio-8080-exec-7] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:36:10 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:36:10 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders", parameters={}
2025-10-27 16:36:10 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 16:36:10 [http-nio-8080-exec-7] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:36:10 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 26(Long)
2025-10-27 16:36:10 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getAllOrders()
2025-10-27 16:36:10 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:36:10 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 16:36:10 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:36:10 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 获取所有订单
2025-10-27 16:36:10 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 获取所有订单
2025-10-27 16:36:10 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:36:10 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:36:10 [http-nio-8080-exec-5] DEBUG c.j.mapper.OrderMapper.selectAll - ==>  Preparing: SELECT * FROM orders ORDER BY create_time DESC
2025-10-27 16:36:10 [http-nio-8080-exec-5] DEBUG c.j.mapper.OrderMapper.selectAll - ==> Parameters: 
2025-10-27 16:36:10 [http-nio-8080-exec-4] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:26_pay
2025-10-27 16:36:10 [http-nio-8080-exec-4] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 26, 支付方式: ALIPAY
2025-10-27 16:36:10 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 26, 支付方式: ALIPAY
2025-10-27 16:36:10 [http-nio-8080-exec-4] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 16:36:10 [http-nio-8080-exec-4] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 26(Long)
2025-10-27 16:36:10 [http-nio-8080-exec-4] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 16:36:10 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.PaymentService - 调用第三方支付平台，订单ID: 26, 支付方式: ALIPAY
2025-10-27 16:36:10 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.PaymentService - 调用支付宝支付，订单ID: 26
2025-10-27 16:36:10 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 创建真实支付宝支付订单，订单号: ORD17615541053437680, 金额: 5500
2025-10-27 16:36:10 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 16:36:11 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 16:36:11 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:36:11 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:36:11 [http-nio-8080-exec-9] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:36:11 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 16:36:11 [http-nio-8080-exec-9] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:36:11 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 16:36:11 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:36:11 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:36:11 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 16:36:11 [http-nio-8080-exec-5] DEBUG c.j.mapper.OrderMapper.selectAll - <==      Total: 26
2025-10-27 16:36:11 [http-nio-8080-exec-9] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:36:11 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:36:11 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:36:12 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 16:36:12 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:36:12 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:36:12 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:12 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:12 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:36:12 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 开始处理超时订单，订单ID: 26, 订单号: ORD17615541053437680
2025-10-27 16:36:12 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 16:36:13 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:13 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:13 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:13 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:13 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 16:36:13 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:36:16 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:36:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:36:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:16 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 调用支付宝预下单API，订单号: ORD17615541053437680, 金额: 5500, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 16:36:16 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.updateStatus - ==>  Preparing: UPDATE orders SET status = ?, update_time = NOW() WHERE id = ?
2025-10-27 16:36:16 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:16 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.updateStatus - ==> Parameters: CANCELLED(String), 26(Long)
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:36:16 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.updateStatus - <==    Updates: 1
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:16 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  com.jiaoyi.service.CouponService - 退款优惠券，订单ID: 26
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - ==>  Preparing: SELECT id, coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time FROM coupon_usage WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 3(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 2(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==>  Preparing: UPDATE coupon_usage SET status = ? WHERE id = ?
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==> Parameters: REFUNDED(String), 22(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 5(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 4(Long)
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - <==    Updates: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 9(Long)
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 8(Long)
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: -1(Integer), 4(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 7(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 3
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 11(Long)
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  com.jiaoyi.service.CouponService - 优惠券退款成功，使用记录ID: 22
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 超时订单优惠券退还成功，订单ID: 26, 优惠券ID: 4
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 订单超时取消成功，订单ID: 26, 订单号: ORD17615541053437680
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 10(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 12(Long)
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=获取订单列表成功, data=[OrderResponse(id=26, orderNo=ORD17615541053437680, use (truncated)...]
2025-10-27 16:36:18 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:36:19 [http-nio-8080-exec-4] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.precreate&sign=dFNveaqIDR/0Ovv90p5OpOxaxld3E/AT6ZDJ3DGbFy9WZ6XrwztBzsLI/kHbPa77WRrQMVthIw1nE8UFeFDIVMs1nMFpMY/3DFcN/ZSrX12hwOg0IOjhX6F7xjtsmfk6p5Fu0BHOrzT4Rn8B4m1qOtSv9e88njBZ+PIt/pOOEuq+roYIGWL26gzlOt6chF+n5Hr9cFf0BzmD9wvkILV+02AdjPuBXgoq1184+QG24oivWN5OMpv1lARCMWAaEDWMF8uB+xR4ZmvTydKZOzCSKOjJVL6kGFH8Bh8P8jvJkrhE1GwVRBGKFAMm6Ujfi4TmYyh0AcXbZg+NeiAKObn2pQ==&return_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return&notify_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 16:36:18^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"body":"商品购买","out_trade_no":"ORD17615541053437680","subject":"订单支付：ORD17615541053437680","timeout_express":"30m","total_amount":"5500"}^_^1902ms,1194ms,39ms^_^trace_id:06013ec2176155417958145551436129
2025-10-27 16:36:19 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 支付宝API响应 - 成功: true, 错误码: 10000, 错误信息: Success, 二维码: https://qr.alipay.com/bax05686hfgzn7zd1jrm00a9
2025-10-27 16:36:19 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 支付宝预下单成功，订单号: ORD17615541053437680, 二维码: https://qr.alipay.com/bax05686hfgzn7zd1jrm00a9
2025-10-27 16:36:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:36:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=支付处理成功, data=PaymentResponse(paymentNo=PAY176155417094050F49277, statu (truncated)...]
2025-10-27 16:36:19 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:36:23 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/my-orders.html", parameters={}
2025-10-27 16:36:23 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:36:23 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:36:23 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 16:36:23 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 16:36:23 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:36:23 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:36:23 [http-nio-8080-exec-2] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:36:23 [http-nio-8080-exec-2] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:36:23 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:36:23 [http-nio-8080-exec-2] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:36:23 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:36:23 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:36:23 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:36:23 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:36:24 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/my-orders.html", parameters={}
2025-10-27 16:36:24 [http-nio-8080-exec-6] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:36:24 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:36:24 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 16:36:24 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 16:36:24 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:36:24 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:36:24 [http-nio-8080-exec-9] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:36:24 [http-nio-8080-exec-9] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:36:24 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:36:24 [http-nio-8080-exec-9] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:36:24 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:36:24 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:36:24 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:36:24 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:36:30 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 16:36:30 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 16:36:30 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:36:33 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:36:33 [http-nio-8080-exec-5] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:36:33 [http-nio-8080-exec-5] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:36:33 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:36:33 [http-nio-8080-exec-5] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:36:33 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:36:33 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:36:33 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:36:33 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:37:05 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:37:05 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:37:05 [http-nio-8080-exec-4] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:37:05 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:37:05 [http-nio-8080-exec-4] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:37:05 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:37:05 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:37:05 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:37:05 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:37:11 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/", parameters={}
2025-10-27 16:37:11 [http-nio-8080-exec-10] DEBUG o.s.w.s.v.ContentNegotiatingViewResolver - Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2025-10-27 16:37:11 [http-nio-8080-exec-10] DEBUG o.s.w.s.view.InternalResourceView - View name 'forward:', model {}
2025-10-27 16:37:11 [http-nio-8080-exec-10] DEBUG o.s.w.s.view.InternalResourceView - Forwarding to [index.html]
2025-10-27 16:37:11 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - "FORWARD" dispatch for GET "/index.html", parameters={}
2025-10-27 16:37:11 [http-nio-8080-exec-10] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:37:11 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Exiting from "FORWARD" dispatch, status 304
2025-10-27 16:37:11 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders", parameters={}
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getAllOrders()
2025-10-27 16:37:11 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 获取所有订单
2025-10-27 16:37:11 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 获取所有订单
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectAll - ==>  Preparing: SELECT * FROM orders ORDER BY create_time DESC
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectAll - ==> Parameters: 
2025-10-27 16:37:11 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:37:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:37:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:37:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:37:11 [http-nio-8080-exec-3] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:37:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:37:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:37:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:37:11 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectAll - <==      Total: 26
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 3(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 2(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 5(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 4(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 9(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 8(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 7(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 3
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 11(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 10(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 12(Long)
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=获取订单列表成功, data=[OrderResponse(id=26, orderNo=ORD17615541053437680, use (truncated)...]
2025-10-27 16:37:11 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:37:12 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:37:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:37:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:37:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:37:12 [http-nio-8080-exec-2] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:37:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:37:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:37:12 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:37:12 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999989(Integer), 999999989(Integer), 130(Integer), 140(Integer), 下单锁定库存(String), 2025-10-27T16:37:14.420120100(LocalDateTime)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615542344219905(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T16:37:14.425102600(LocalDateTime), 2025-10-27T16:37:14.425102600(LocalDateTime)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615542344219905
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 27(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 27
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 27(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T16:37:14.429539600(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T16:37:14.429539600(LocalDateTime)
2025-10-27 16:37:14 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 23
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 16:37:14 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 27, 订单号: ORD17615542344219905, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 16:37:19 [http-nio-8080-exec-6] INFO  c.j.s.OrderTimeoutMessageService - 发送订单超时延迟消息，订单ID: 27, 订单号: ORD17615542344219905, 延迟: 1分钟
2025-10-27 16:37:19 [http-nio-8080-exec-6] INFO  c.j.s.OrderTimeoutMessageService - 订单超时延迟消息发送成功，订单ID: 27, 延迟级别: 1
2025-10-27 16:37:19 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单超时延迟消息已发送，订单将在30分钟后自动取消（如果未支付），订单ID: 27, 订单号: ORD17615542344219905
2025-10-27 16:37:19 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 16:37:19 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615542344219905
2025-10-27 16:37:19 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:37:19 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=27, orderNo=ORD17615542344219905, userId (truncated)...]
2025-10-27 16:37:19 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:37:20 [ConsumeMessageThread_order-timeout-consumer-group_2] INFO  c.j.s.OrderTimeoutMessageService - 接收到订单超时消息，订单ID: 27, 订单号: ORD17615542344219905
2025-10-27 16:37:30 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 16:37:30 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 27(Long)
2025-10-27 16:37:30 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 16:37:31 [ConsumeMessageThread_order-timeout-consumer-group_2] INFO  c.j.s.OrderTimeoutMessageService - 开始处理超时订单，订单ID: 27, 订单号: ORD17615542344219905
2025-10-27 16:37:33 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.updateStatus - ==>  Preparing: UPDATE orders SET status = ?, update_time = NOW() WHERE id = ?
2025-10-27 16:37:33 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.updateStatus - ==> Parameters: CANCELLED(String), 27(Long)
2025-10-27 16:37:33 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.updateStatus - <==    Updates: 1
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] INFO  com.jiaoyi.service.CouponService - 退款优惠券，订单ID: 27
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.C.selectByOrderId - ==>  Preparing: SELECT id, coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time FROM coupon_usage WHERE order_id = ?
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.C.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.C.selectByOrderId - <==      Total: 1
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==>  Preparing: UPDATE coupon_usage SET status = ? WHERE id = ?
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==> Parameters: REFUNDED(String), 23(Long)
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.CouponUsageMapper.updateStatus - <==    Updates: 1
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: -1(Integer), 4(Long)
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 16:37:37 [ConsumeMessageThread_order-timeout-consumer-group_2] INFO  com.jiaoyi.service.CouponService - 优惠券退款成功，使用记录ID: 23
2025-10-27 16:37:38 [ConsumeMessageThread_order-timeout-consumer-group_2] INFO  c.j.s.OrderTimeoutMessageService - 超时订单优惠券退还成功，订单ID: 27, 优惠券ID: 4
2025-10-27 16:37:40 [ConsumeMessageThread_order-timeout-consumer-group_2] INFO  c.j.s.OrderTimeoutMessageService - 订单超时取消成功，订单ID: 27, 订单号: ORD17615542344219905
2025-10-27 16:37:47 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/my-orders.html", parameters={}
2025-10-27 16:37:47 [http-nio-8080-exec-7] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:37:47 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:37:47 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 16:37:47 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 16:37:47 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:37:47 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:37:47 [http-nio-8080-exec-8] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:37:47 [http-nio-8080-exec-8] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:37:47 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:37:47 [http-nio-8080-exec-8] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:37:47 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:37:47 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:37:47 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:37:47 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:38:08 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 15
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=27, orderNo=ORD17615542344219905, userId= (truncated)...]
2025-10-27 16:38:08 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:38:23 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment.html", parameters={}
2025-10-27 16:38:23 [http-nio-8080-exec-4] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:38:23 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 16:38:23 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:38:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:38:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:38:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:38:23 [http-nio-8080-exec-10] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:38:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:38:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:38:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:38:23 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999989(Integer), 999999989(Integer), 140(Integer), 150(Integer), 下单锁定库存(String), 2025-10-27T16:38:26.067697500(LocalDateTime)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615543060686657(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T16:38:26.071683600(LocalDateTime), 2025-10-27T16:38:26.071683600(LocalDateTime)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615543060686657
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 28(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 28
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 28(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T16:38:26.074674500(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T16:38:26.074674500(LocalDateTime)
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 24
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 28, 订单号: ORD17615543060686657, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  c.j.s.OrderTimeoutMessageService - 发送订单超时延迟消息，订单ID: 28, 订单号: ORD17615543060686657, 延迟: 1分钟
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  c.j.s.OrderTimeoutMessageService - 订单超时延迟消息发送成功，订单ID: 28, 延迟级别: 1
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 订单超时延迟消息已发送，订单将在30分钟后自动取消（如果未支付），订单ID: 28, 订单号: ORD17615543060686657
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 16:38:26 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615543060686657
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=28, orderNo=ORD17615543060686657, userId (truncated)...]
2025-10-27 16:38:26 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] INFO  c.j.s.OrderTimeoutMessageService - 接收到订单超时消息，订单ID: 28, 订单号: ORD17615543060686657
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 28(Long)
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] INFO  c.j.s.OrderTimeoutMessageService - 开始处理超时订单，订单ID: 28, 订单号: ORD17615543060686657
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.mapper.OrderMapper.updateStatus - ==>  Preparing: UPDATE orders SET status = ?, update_time = NOW() WHERE id = ?
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.mapper.OrderMapper.updateStatus - ==> Parameters: CANCELLED(String), 28(Long)
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.mapper.OrderMapper.updateStatus - <==    Updates: 1
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] INFO  com.jiaoyi.service.CouponService - 退款优惠券，订单ID: 28
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.C.selectByOrderId - ==>  Preparing: SELECT id, coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time FROM coupon_usage WHERE order_id = ?
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.C.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.C.selectByOrderId - <==      Total: 1
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==>  Preparing: UPDATE coupon_usage SET status = ? WHERE id = ?
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==> Parameters: REFUNDED(String), 24(Long)
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.CouponUsageMapper.updateStatus - <==    Updates: 1
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: -1(Integer), 4(Long)
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] INFO  com.jiaoyi.service.CouponService - 优惠券退款成功，使用记录ID: 24
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] INFO  c.j.s.OrderTimeoutMessageService - 超时订单优惠券退还成功，订单ID: 28, 优惠券ID: 4
2025-10-27 16:38:27 [ConsumeMessageThread_order-timeout-consumer-group_3] INFO  c.j.s.OrderTimeoutMessageService - 订单超时取消成功，订单ID: 28, 订单号: ORD17615543060686657
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/28/pay", parameters={}
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 16:38:27 [http-nio-8080-exec-1] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:28_pay
2025-10-27 16:38:27 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 28, 支付方式: ALIPAY
2025-10-27 16:38:27 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 28, 支付方式: ALIPAY
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 28(Long)
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 16:38:27 [http-nio-8080-exec-1] ERROR c.jiaoyi.controller.OrderController - 支付处理失败
java.lang.RuntimeException: 订单状态不正确，无法支付
	at com.jiaoyi.service.PaymentService.processPayment(PaymentService.java:43)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.service.PaymentService$$SpringCGLIB$$0.processPayment(<generated>)
	at com.jiaoyi.controller.OrderController.payOrder(OrderController.java:183)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.jiaoyi.aspect.PreventDuplicateSubmissionAspect.around(PreventDuplicateSubmissionAspect.java:57)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.jiaoyi.controller.OrderController$$SpringCGLIB$$0.payOrder(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=500, message=支付处理失败: 订单状态不正确，无法支付, data=null)]
2025-10-27 16:38:27 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:38:33 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 16
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=28, orderNo=ORD17615543060686657, userId= (truncated)...]
2025-10-27 16:38:33 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:38:36 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 16
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=28, orderNo=ORD17615543060686657, userId= (truncated)...]
2025-10-27 16:38:36 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:45:20 [SpringApplicationShutdownHook] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 16:45:20 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-27 16:45:20 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-27 16:45:54 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 41496 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 16:45:54 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 16:45:54 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 16:45:56 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 16:45:56 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 16:45:56 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 29 ms. Found 0 Redis repository interfaces.
2025-10-27 16:45:57 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:45:57 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:45:57 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:45:57 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:45:57 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketMQMessageListenerContainerRegistrar' of type [org.apache.rocketmq.spring.support.RocketMQMessageListenerContainerRegistrar] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:45:58 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 16:45:58 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 16:45:58 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 16:45:58 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 16:45:58 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3833 ms
2025-10-27 16:45:58 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 16:45:58 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 16:45:59 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:45:59 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:46:00 [main] INFO  o.a.r.s.a.RocketMQAutoConfiguration - a producer (order-timeout-producer-group) init on namesrv localhost:9876
2025-10-27 16:46:00 [main] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 16:46:00 [main] INFO  o.a.r.s.s.RocketMQMessageListenerContainerRegistrar - Register the listener to container, listenerBeanName:orderTimeoutMessageService, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-10-27 16:46:00 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 16:46:00 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 16:46:01 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 16:46:01 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 16:46:01 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 16:46:02 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 16:46:02 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 16:46:02 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 8.812 seconds (process running for 10.592)
2025-10-27 16:46:07 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 16:46:07 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@4763d86d
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@727f9833
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 16:46:07 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:46:07 [http-nio-8080-exec-1] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:46:07 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:47:06 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment.html", parameters={}
2025-10-27 16:47:06 [http-nio-8080-exec-5] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:47:06 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 16:47:06 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 16:47:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 16:47:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 16:47:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 16:47:06 [http-nio-8080-exec-8] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 16:47:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 16:47:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 16:47:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 16:47:06 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 16:47:07 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 16:47:07 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@765bfaf1
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999989(Integer), 999999989(Integer), 150(Integer), 160(Integer), 下单锁定库存(String), 2025-10-27T16:47:08.635575200(LocalDateTime)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615548286498168(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T16:47:08.659225400(LocalDateTime), 2025-10-27T16:47:08.659225400(LocalDateTime)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615548286498168
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 29(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 29
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 29(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T16:47:08.692293200(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T16:47:08.692293200(LocalDateTime)
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 25
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 29, 订单号: ORD17615548286498168, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  c.j.s.OrderTimeoutMessageService - 发送订单超时延迟消息，订单ID: 29, 订单号: ORD17615548286498168, 延迟: 4分钟
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  c.j.s.OrderTimeoutMessageService - 订单超时延迟消息发送成功，订单ID: 29, 延迟级别: 8
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 订单超时延迟消息已发送，订单将在30分钟后自动取消（如果未支付），订单ID: 29, 订单号: ORD17615548286498168
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 16:47:08 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615548286498168
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=29, orderNo=ORD17615548286498168, userId (truncated)...]
2025-10-27 16:47:08 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:19 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:47:19 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:22 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:47:22 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:23 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:47:23 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:47:24 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:25 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:47:25 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:25 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:47:25 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:48:22 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:48:22 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:48:23 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:48:23 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:48:24 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:48:24 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:49:25 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:49:25 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:40 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:50:40 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:41 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:50:41 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:41 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:50:41 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:42 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:50:42 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:46 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:50:46 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:46 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:50:46 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:46 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:50:46 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 接收到订单超时消息，订单ID: 29, 订单号: ORD17615548286498168
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 29(Long)
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 开始处理超时订单，订单ID: 29, 订单号: ORD17615548286498168
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.updateStatus - ==>  Preparing: UPDATE orders SET status = ?, update_time = NOW() WHERE id = ?
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.updateStatus - ==> Parameters: CANCELLED(String), 29(Long)
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.updateStatus - <==    Updates: 1
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  com.jiaoyi.service.CouponService - 退款优惠券，订单ID: 29
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - ==>  Preparing: SELECT id, coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time FROM coupon_usage WHERE order_id = ?
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - <==      Total: 1
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==>  Preparing: UPDATE coupon_usage SET status = ? WHERE id = ?
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==> Parameters: REFUNDED(String), 25(Long)
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - <==    Updates: 1
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: -1(Integer), 4(Long)
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  com.jiaoyi.service.CouponService - 优惠券退款成功，使用记录ID: 25
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 超时订单优惠券退还成功，订单ID: 29, 优惠券ID: 4
2025-10-27 16:51:08 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 订单超时取消成功，订单ID: 29, 订单号: ORD17615548286498168
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 16:51:54 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 17
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=29, orderNo=ORD17615548286498168, userId= (truncated)...]
2025-10-27 16:51:54 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 16:59:04 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 1356 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 16:59:04 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 16:59:04 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 16:59:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 16:59:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 16:59:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 15 ms. Found 0 Redis repository interfaces.
2025-10-27 16:59:06 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:59:06 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:59:06 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:59:06 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:59:06 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketMQMessageListenerContainerRegistrar' of type [org.apache.rocketmq.spring.support.RocketMQMessageListenerContainerRegistrar] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 16:59:06 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 16:59:06 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 16:59:06 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 16:59:06 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 16:59:06 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1719 ms
2025-10-27 16:59:06 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 16:59:06 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 16:59:06 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:59:07 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 16:59:07 [main] INFO  o.a.r.s.a.RocketMQAutoConfiguration - a producer (order-timeout-producer-group) init on namesrv localhost:9876
2025-10-27 16:59:07 [main] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 16:59:07 [main] INFO  o.a.r.s.s.RocketMQMessageListenerContainerRegistrar - Register the listener to container, listenerBeanName:orderTimeoutMessageService, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-10-27 16:59:07 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 16:59:07 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 16:59:08 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 16:59:08 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 16:59:08 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 16:59:08 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 16:59:15 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2025-10-27 16:59:15 [main] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 16:59:15 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 16:59:15 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2025-10-27 17:00:35 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 6200 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 17:00:35 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 17:00:35 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 17:00:36 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 17:00:36 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 17:00:36 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-10-27 17:00:36 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:00:36 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:00:36 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:00:36 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:00:36 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketMQMessageListenerContainerRegistrar' of type [org.apache.rocketmq.spring.support.RocketMQMessageListenerContainerRegistrar] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:00:37 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 17:00:37 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 17:00:37 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 17:00:37 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 17:00:37 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1431 ms
2025-10-27 17:00:37 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 17:00:37 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 17:00:37 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 17:00:37 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 17:00:37 [main] INFO  o.a.r.s.a.RocketMQAutoConfiguration - a producer (order-timeout-producer-group) init on namesrv localhost:9876
2025-10-27 17:00:38 [main] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 17:00:38 [main] INFO  o.a.r.s.s.RocketMQMessageListenerContainerRegistrar - Register the listener to container, listenerBeanName:orderTimeoutMessageService, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-10-27 17:00:38 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 17:00:38 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 17:00:38 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 17:00:38 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 17:00:38 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 17:00:38 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 17:00:38 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 17:00:39 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 3.643 seconds (process running for 3.898)
2025-10-27 17:02:57 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 38404 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 17:02:57 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 17:02:57 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 17:02:58 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 17:02:58 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 17:02:58 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 35 ms. Found 0 Redis repository interfaces.
2025-10-27 17:03:00 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:00 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:00 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:00 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:00 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketMQMessageListenerContainerRegistrar' of type [org.apache.rocketmq.spring.support.RocketMQMessageListenerContainerRegistrar] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:00 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 17:03:00 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 17:03:00 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 17:03:01 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 17:03:01 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3530 ms
2025-10-27 17:03:01 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 17:03:01 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 17:03:01 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 17:03:01 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 17:03:02 [main] INFO  o.a.r.s.a.RocketMQAutoConfiguration - a producer (order-timeout-producer-group) init on namesrv localhost:9876
2025-10-27 17:03:03 [main] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 17:03:03 [main] INFO  o.a.r.s.s.RocketMQMessageListenerContainerRegistrar - Register the listener to container, listenerBeanName:orderTimeoutMessageService, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-10-27 17:03:03 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 17:03:03 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 17:03:03 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 17:03:03 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 17:03:03 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 17:03:04 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 17:03:04 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2025-10-27 17:03:04 [main] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - container destroyed, DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 17:03:05 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-27 17:03:05 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that's listening on port 8080 or configure this application to listen on another port.

2025-10-27 17:03:53 [main] INFO  com.jiaoyi.JiaoyiApplication - Starting JiaoyiApplication using Java 21.0.7 with PID 37160 (D:\软件\ideaproject\jiaoyi\target\classes started by Administrator in D:\软件\ideaproject\jiaoyi)
2025-10-27 17:03:53 [main] DEBUG com.jiaoyi.JiaoyiApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-27 17:03:53 [main] INFO  com.jiaoyi.JiaoyiApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-27 17:03:55 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-27 17:03:55 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-27 17:03:55 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 29 ms. Found 0 Redis repository interfaces.
2025-10-27 17:03:56 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.ListenerContainerConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:56 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration' of type [org.apache.rocketmq.spring.autoconfigure.MessageConverterConfiguration$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:56 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'createRocketMQMessageConverter' of type [org.apache.rocketmq.spring.support.RocketMQMessageConverter] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:56 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketmq-org.apache.rocketmq.spring.autoconfigure.RocketMQProperties' of type [org.apache.rocketmq.spring.autoconfigure.RocketMQProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:56 [main] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'rocketMQMessageListenerContainerRegistrar' of type [org.apache.rocketmq.spring.support.RocketMQMessageListenerContainerRegistrar] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [org.apache.rocketmq.spring.annotation.RocketMQMessageListenerBeanPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2025-10-27 17:03:57 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-27 17:03:57 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-27 17:03:57 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-27 17:03:57 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-27 17:03:57 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3489 ms
2025-10-27 17:03:57 [main] DEBUG o.s.w.f.ServerHttpObservationFilter - Filter 'webMvcObservationFilter' configured for use
2025-10-27 17:03:57 [main] INFO  org.redisson.Version - Redisson 3.24.3
2025-10-27 17:03:57 [redisson-netty-2-5] INFO  o.r.c.p.MasterPubSubConnectionPool - 1 connections initialized for localhost/127.0.0.1:6379
2025-10-27 17:03:58 [redisson-netty-2-20] INFO  o.r.c.pool.MasterConnectionPool - 24 connections initialized for localhost/127.0.0.1:6379
2025-10-27 17:03:58 [main] INFO  o.a.r.s.a.RocketMQAutoConfiguration - a producer (order-timeout-producer-group) init on namesrv localhost:9876
2025-10-27 17:03:59 [main] INFO  o.a.r.s.s.DefaultRocketMQListenerContainer - running container: DefaultRocketMQListenerContainer{consumerGroup='order-timeout-consumer-group', namespace='', nameServer='localhost:9876', topic='order-timeout-topic', consumeMode=CONCURRENTLY, selectorType=TAG, selectorExpression='timeout', messageModel=CLUSTERING', tlsEnable=false, instanceName=DEFAULT}
2025-10-27 17:03:59 [main] INFO  o.a.r.s.s.RocketMQMessageListenerContainerRegistrar - Register the listener to container, listenerBeanName:orderTimeoutMessageService, containerBeanName:org.apache.rocketmq.spring.support.DefaultRocketMQListenerContainer_1
2025-10-27 17:03:59 [main] INFO  o.s.b.a.w.s.WelcomePageHandlerMapping - Adding welcome page: class path resource [static/index.html]
2025-10-27 17:03:59 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 30 mappings in 'requestMappingHandlerMapping'
2025-10-27 17:03:59 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**] in 'resourceHandlerMapping'
2025-10-27 17:03:59 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
2025-10-27 17:03:59 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-10-27 17:04:00 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-27 17:04:00 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-27 17:04:00 [main] INFO  com.jiaoyi.JiaoyiApplication - Started JiaoyiApplication in 8.27 seconds (process running for 9.951)
2025-10-27 17:04:57 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-27 17:04:57 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected StandardServletMultipartResolver
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected AcceptHeaderLocaleResolver
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected FixedThemeResolver
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@56e2a235
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Detected org.springframework.web.servlet.support.SessionFlashMapManager@d651d31
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2025-10-27 17:04:57 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment.html", parameters={}
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 17:04:57 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 17:04:57 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 17:04:57 [http-nio-8080-exec-10] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 17:04:57 [http-nio-8080-exec-10] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 17:04:57 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 17:04:57 [http-nio-8080-exec-10] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 17:04:57 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 17:04:57 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 17:04:57 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 17:04:57 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 17:04:59 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 17:04:59 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 17:04:59 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 17:04:59 [http-nio-8080-exec-8] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 17:04:59 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 17:04:59 [http-nio-8080-exec-8] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@cf1af13
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999989(Integer), 999999989(Integer), 160(Integer), 170(Integer), 下单锁定库存(String), 2025-10-27T17:05:00.461851(LocalDateTime)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615559004827376(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T17:05:00.500066900(LocalDateTime), 2025-10-27T17:05:00.500066900(LocalDateTime)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615559004827376
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 30(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 30
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 30(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T17:05:00.556706900(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T17:05:00.556706900(LocalDateTime)
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 26
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 30, 订单号: ORD17615559004827376, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  c.j.s.OrderTimeoutMessageService - 发送订单超时延迟消息，订单ID: 30, 订单号: ORD17615559004827376, 延迟: 1分钟
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  c.j.s.OrderTimeoutMessageService - 订单超时延迟消息发送成功，订单ID: 30, 延迟级别: 5
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 订单超时延迟消息已发送，订单将在30分钟后自动取消（如果未支付），订单ID: 30, 订单号: ORD17615559004827376
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 17:05:00 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615559004827376
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=30, orderNo=ORD17615559004827376, userId (truncated)...]
2025-10-27 17:05:00 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 17:05:05 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 18
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=30, orderNo=ORD17615559004827376, userId= (truncated)...]
2025-10-27 17:05:05 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 接收到订单超时消息，订单ID: 30, 订单号: ORD17615559004827376
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 30(Long)
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 开始处理超时订单，订单ID: 30, 订单号: ORD17615559004827376
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.O.updateStatusIfPending - ==>  Preparing: UPDATE orders SET status = ?, update_time = NOW() WHERE id = ? AND status = 'PENDING'
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.O.updateStatusIfPending - ==> Parameters: CANCELLED(String), 30(Long)
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.O.updateStatusIfPending - <==    Updates: 1
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 订单超时取消成功，订单ID: 30, 订单号: ORD17615559004827376
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  com.jiaoyi.service.CouponService - 退款优惠券，订单ID: 30
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - ==>  Preparing: SELECT id, coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time FROM coupon_usage WHERE order_id = ?
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.selectByOrderId - <==      Total: 1
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==>  Preparing: UPDATE coupon_usage SET status = ? WHERE id = ?
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - ==> Parameters: REFUNDED(String), 26(Long)
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.CouponUsageMapper.updateStatus - <==    Updates: 1
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: -1(Integer), 4(Long)
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  com.jiaoyi.service.CouponService - 优惠券退款成功，使用记录ID: 26
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 超时订单优惠券退还成功，订单ID: 30, 优惠券ID: 4
2025-10-27 17:06:00 [ConsumeMessageThread_order-timeout-consumer-group_1] INFO  c.j.s.OrderTimeoutMessageService - 订单超时取消成功，订单ID: 30, 订单号: ORD17615559004827376
2025-10-27 17:06:25 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/my-orders.html", parameters={}
2025-10-27 17:06:25 [http-nio-8080-exec-3] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 17:06:25 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:06:25 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 17:06:25 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 17:06:25 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 17:06:25 [http-nio-8080-exec-6] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 17:06:25 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:06:25 [http-nio-8080-exec-6] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 17:06:25 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 17:06:25 [http-nio-8080-exec-6] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 17:06:25 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 17:06:25 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 17:06:25 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 17:06:25 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:06:52 [http-nio-8080-exec-9] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 17:06:52 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 17:06:52 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:06:52 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 17:06:52 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 17:06:52 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/1001", parameters={}
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:06:54 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 1001
2025-10-27 17:06:54 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 1001
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 1001(Long)
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 2
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 1(Long)
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 6(Long)
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=1, orderNo=ORD202501150001, userId=1001,  (truncated)...]
2025-10-27 17:06:54 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:04 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/92", parameters={}
2025-10-27 17:07:04 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:04 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:04 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:04 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:04 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 92(Long)
2025-10-27 17:07:04 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 0
2025-10-27 17:07:04 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:04 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[])]
2025-10-27 17:07:04 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:06 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/92", parameters={}
2025-10-27 17:07:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:06 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:06 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:06 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:06 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 92(Long)
2025-10-27 17:07:06 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 0
2025-10-27 17:07:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:06 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[])]
2025-10-27 17:07:06 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:07 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/92", parameters={}
2025-10-27 17:07:07 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:07 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:07 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:07 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:07 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 92(Long)
2025-10-27 17:07:07 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 0
2025-10-27 17:07:07 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:07 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[])]
2025-10-27 17:07:07 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:08 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/92", parameters={}
2025-10-27 17:07:08 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:08 [http-nio-8080-exec-4] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:08 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:08 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:08 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 92(Long)
2025-10-27 17:07:08 [http-nio-8080-exec-4] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 0
2025-10-27 17:07:08 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:08 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[])]
2025-10-27 17:07:08 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:11 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/92", parameters={}
2025-10-27 17:07:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:11 [http-nio-8080-exec-3] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:11 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 92
2025-10-27 17:07:11 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:11 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 92(Long)
2025-10-27 17:07:11 [http-nio-8080-exec-3] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 0
2025-10-27 17:07:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:11 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[])]
2025-10-27 17:07:11 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 17:07:17 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 18
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=30, orderNo=ORD17615559004827376, userId= (truncated)...]
2025-10-27 17:07:17 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:28 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - GET "/test-payment.html", parameters={}
2025-10-27 17:07:28 [http-nio-8080-exec-6] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 17:07:28 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 304 NOT_MODIFIED
2025-10-27 17:07:28 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/favicon.ico", parameters={}
2025-10-27 17:07:28 [http-nio-8080-exec-9] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2025-10-27 17:07:28 [http-nio-8080-exec-9] DEBUG o.s.w.s.r.ResourceHttpRequestHandler - Resource not found
2025-10-27 17:07:28 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.jiaoyi.exception.GlobalExceptionHandler#handleException(Exception)
2025-10-27 17:07:28 [http-nio-8080-exec-9] ERROR c.j.exception.GlobalExceptionHandler - 未知异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 17:07:28 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json;q=0.8', given [image/avif, image/webp, image/apng, image/svg+xml, image/*, */*;q=0.8] and supported [application/json, application/*+json]
2025-10-27 17:07:28 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=系统内部错误, data=null)]
2025-10-27 17:07:28 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource favicon.ico.]
2025-10-27 17:07:28 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 500 INTERNAL_SERVER_ERROR
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders", parameters={}
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#createOrder(CreateOrderRequest)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [CreateOrderRequest(userId=94, receiverName=张三, receiverPhone=13800138000, receiverAddress=北京市朝阳区xxx街 (truncated)...]
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:EDrDKciB4hB92U17L/bIQQ==
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 接收到创建订单请求，用户ID: 94
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 开始创建订单，用户ID: 94
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 成功获取分布式锁，开始处理订单创建，用户ID: 94
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 检查并锁定库存，商品数量: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量检查并锁定库存，商品数量: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 检查并锁定库存，商品ID: 2002, 数量: 10
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==>  Preparing: UPDATE inventory SET locked_stock = locked_stock + ?, update_time = NOW() WHERE product_id = ? AND (current_stock - locked_stock) >= ?
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - ==> Parameters: 10(Integer), 2002(Long), 10(Integer)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.InventoryMapper.lockStock - <==    Updates: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, LOCK(String), 10(Integer), 999999989(Integer), 999999989(Integer), 170(Integer), 180(Integer), 下单锁定库存(String), 2025-10-27T17:07:29.840822700(LocalDateTime)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 库存锁定成功，商品ID: 2002, 锁定数量: 10
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.InventoryService - 批量库存锁定完成
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 查询优惠券，代码: DISCOUNT10
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==>  Preparing: SELECT id, coupon_code, coupon_name, type, value, min_order_amount, max_discount_amount, status, total_quantity, used_quantity, limit_per_user, applicable_type, applicable_products, start_time, end_time, create_time, update_time FROM coupons WHERE coupon_code = ?
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - ==> Parameters: DISCOUNT10(String)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.selectByCouponCode - <==      Total: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - ==>  Preparing: SELECT COUNT(*) FROM coupon_usage WHERE user_id = ? AND coupon_id = ?
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - ==> Parameters: 94(Long), 4(Long)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.countByUserIdAndCouponId - <==      Total: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 优惠券验证通过，优惠券ID: 4
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 计算优惠金额，优惠券类型: PERCENTAGE, 订单金额: 6000, 优惠金额: 500.00
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 优惠券验证通过，优惠金额: 500.00, 实际支付金额: 5500.00
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==>  Preparing: INSERT INTO orders ( order_no, user_id, status, total_amount, coupon_id, coupon_code, discount_amount, actual_amount, receiver_name, receiver_phone, receiver_address, remark, create_time, update_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - ==> Parameters: ORD17615560498429644(String), 94(Long), PENDING(String), 6000(BigDecimal), 4(Long), DISCOUNT10(String), 500.00(BigDecimal), 5500.00(BigDecimal), 张三(String), 13800138000(String), 北京市朝阳区xxx街道(String), 请尽快发货(String), 2025-10-27T17:07:29.845806(LocalDateTime), 2025-10-27T17:07:29.845806(LocalDateTime)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.jiaoyi.mapper.OrderMapper.insert - <==    Updates: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单创建成功，订单号: ORD17615560498429644
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - ==>  Preparing: INSERT INTO order_items ( order_id, product_id, product_name, product_image, unit_price, quantity, subtotal ) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - ==> Parameters: 31(Long), 2002(Long), 质朴的钢鞋子(String), https://example.com/shoe.jpg(String), 600(BigDecimal), 10(Integer), 6000(BigDecimal)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.OrderItemMapper.insertBatch - <==    Updates: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 使用优惠券，优惠券ID: 4, 用户ID: 94, 订单ID: 31
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - ==>  Preparing: UPDATE coupons SET used_quantity = used_quantity + ?, update_time = NOW() WHERE id = ?
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - ==> Parameters: 1(Integer), 4(Long)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.m.C.updateUsedQuantity - <==    Updates: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - ==>  Preparing: INSERT INTO coupon_usage ( coupon_id, user_id, order_id, coupon_code, discount_amount, used_time, order_amount, actual_amount, status, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - ==> Parameters: 4(Long), 94(Long), 31(Long), DISCOUNT10(String), 500.00(BigDecimal), 2025-10-27T17:07:29.851786200(LocalDateTime), 6000(BigDecimal), 5500.00(BigDecimal), USED(String), 订单使用优惠券(String), 2025-10-27T17:07:29.851786200(LocalDateTime)
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG c.j.mapper.CouponUsageMapper.insert - <==    Updates: 1
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.CouponService - 优惠券使用成功，使用记录ID: 27
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 优惠券使用成功，优惠券ID: 4, 优惠金额: 500.00
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单创建完成，订单ID: 31, 订单号: ORD17615560498429644, 总金额: 6000, 优惠金额: 500.00, 实际支付: 5500.00
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  c.j.s.OrderTimeoutMessageService - 发送订单超时延迟消息，订单ID: 31, 订单号: ORD17615560498429644, 延迟: 1分钟
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  c.j.s.OrderTimeoutMessageService - 订单超时延迟消息发送成功，订单ID: 31, 延迟级别: 5
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 订单超时延迟消息已发送，订单将在30分钟后自动取消（如果未支付），订单ID: 31, 订单号: ORD17615560498429644
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.OrderService - 分布式锁已释放，用户ID: 94
2025-10-27 17:07:29 [http-nio-8080-exec-5] INFO  c.jiaoyi.controller.OrderController - 订单创建成功，订单号: ORD17615560498429644
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=订单创建成功, data=OrderResponse(id=31, orderNo=ORD17615560498429644, userId (truncated)...]
2025-10-27 17:07:29 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 17:07:32 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 19
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 31(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=31, orderNo=ORD17615560498429644, userId= (truncated)...]
2025-10-27 17:07:32 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 17:07:36 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 19
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 31(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=31, orderNo=ORD17615560498429644, userId= (truncated)...]
2025-10-27 17:07:36 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 17:07:39 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 19
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 31(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=31, orderNo=ORD17615560498429644, userId= (truncated)...]
2025-10-27 17:07:39 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:42 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/orders/31/pay", parameters={}
2025-10-27 17:07:42 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#payOrder(Long, PaymentRequest)
2025-10-27 17:07:42 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [PaymentRequest(paymentMethod=ALIPAY, amount=5500, channel=WEB, clientIp=192.168.1.100, userAgent=Moz (truncated)...]
2025-10-27 17:07:42 [http-nio-8080-exec-2] INFO  c.j.a.PreventDuplicateSubmissionAspect - 成功获取锁，锁key: duplicate_submission:31_pay
2025-10-27 17:07:42 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 支付订单，订单ID: 31, 支付方式: ALIPAY
2025-10-27 17:07:42 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.PaymentService - 处理支付，订单ID: 31, 支付方式: ALIPAY
2025-10-27 17:07:42 [http-nio-8080-exec-2] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 17:07:42 [http-nio-8080-exec-2] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 31(Long)
2025-10-27 17:07:42 [http-nio-8080-exec-2] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 17:07:42 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.PaymentService - 调用第三方支付平台，订单ID: 31, 支付方式: ALIPAY
2025-10-27 17:07:42 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.PaymentService - 调用支付宝支付，订单ID: 31
2025-10-27 17:07:42 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 创建真实支付宝支付订单，订单号: ORD17615560498429644, 金额: 5500
2025-10-27 17:07:42 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 调用支付宝预下单API，订单号: ORD17615560498429644, 金额: 5500, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 17:07:43 [http-nio-8080-exec-2] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.precreate&sign=ZJJbsJ/UtZ/fkCorzH42odylavu33eeKL89TYEAfiULuK5xZptvRWc6+Z2QqWLtIzCTiDZVSvJwE42fkcPNis8CP/bB2IQnUknyoqFp6jQNvOzqGEhlkzpZImmOu3hGfGPuDUMfK2B417BwXAkM2SFaYTB3aVNGAZy/hs1umWnpInEmemQHGXfrlwOT2kKWa3RKgG39W198PPGupZhJiKZjUzeVNOYQjYhrvzbohPRXNfEklhPyLcBCL3UgS/ipsvEKpf6fc1pjqZkr4Tk9OtLg/We6VG5WJt1mgZX2ZdU47CXW3sdvUAepHqNm+e3boM/HPsRHQNu5eO7rbRYB3cg==&return_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return&notify_url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 17:07:42^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"body":"商品购买","out_trade_no":"ORD17615560498429644","subject":"订单支付：ORD17615560498429644","timeout_express":"30m","total_amount":"5500"}^_^39ms,1100ms,36ms^_^trace_id:0601ac3e176155606389226154904
2025-10-27 17:07:43 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 支付宝API响应 - 成功: true, 错误码: 10000, 错误信息: Success, 二维码: https://qr.alipay.com/bax08146yspt1ah8gaca0073
2025-10-27 17:07:43 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.AlipayService - 支付宝预下单成功，订单号: ORD17615560498429644, 二维码: https://qr.alipay.com/bax08146yspt1ah8gaca0073
2025-10-27 17:07:43 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:43 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=支付处理成功, data=PaymentResponse(paymentNo=PAY1761556062316A3F9BB9D, statu (truncated)...]
2025-10-27 17:07:43 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:48 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615560498429644", parameters={}
2025-10-27 17:07:48 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 17:07:48 [http-nio-8080-exec-4] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615560498429644
2025-10-27 17:07:48 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615560498429644
2025-10-27 17:07:48 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615560498429644, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 17:07:49 [http-nio-8080-exec-4] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 17:07:49^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=F3nAdFWJN9G8ORobB2bjGxFXCPNVx+LKWlFyKkn7eGk5KBbstQT9d8Dvsc0LV6+8OHj3i4d/fv4/sMjcu0iJ18aoV584YUFE8R9RSAsRQ/sfYKxIz34iJiBA1VPzHF1ETS7+yk2e3S066cLPC+nooR0hswlmnzEMRdOqXcYueZixVRF53M+Xq9wjcz0h1VlvUDJxmjWyOpKd4xPRSb2uBQ/pwcQvR72w0SFpVg9pQsW2SLOFqzGXPZrCP4D7Zuxd5PuXslCOlcYg5CDLj9CPMSt6Uq1MZmbx60NKtEPHoe0hb5DNHcsDFmpRmVphV64ofkK5BDA37X2hlLgI3nLoKw==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 17:07:48^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=0601d6c717615560699407923919487&biz_content={"out_trade_no":"ORD17615560498429644"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615560498429644","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"m6pXDgtqv1zB/9QgUuQDWiJqGikD1frhzdYLS6xz/f7MjHDYADokh0VMJBy0tazLFPO0y+x+XVQZQTuk3qt1ikETu/Xq5xz1hAMnbVrujwySSZ341vjI1KNpsKvWIBbda82ykrPy7u2NfmUNT8xq5YVli+beMKyOqjaDB15902c4Al/ydlvuXbxxHUJlbnGUNyODxUXRPmiNCcgh5DkAfjeqVuw5z2VKiZKtDLu53JvS8P0UuKj20zeutqrnn7Wly0CwNTZogRPdDwjHmCWjm44MJdyIDt2K5Rj8kWD7f+7ft/06bjSXgfTCqU+r2vhQnp+axGzaLBfvRsTSb3y0lQ=="}^_^12ms,472ms,31ms^_^trace_id:0601d6c717615560699407923919487
2025-10-27 17:07:49 [http-nio-8080-exec-4] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 17:07:49 [http-nio-8080-exec-4] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 17:07:49 [http-nio-8080-exec-4] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:139)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 17:07:49 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:49 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 17:07:49 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:53 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615560498429644", parameters={}
2025-10-27 17:07:53 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 17:07:53 [http-nio-8080-exec-3] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615560498429644
2025-10-27 17:07:53 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615560498429644
2025-10-27 17:07:53 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615560498429644, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 17:07:53 [http-nio-8080-exec-3] ERROR sdk.biz.err - ErrorScene^_^40004^_^ACQ.TRADE_NOT_EXIST^_^null^_^Windows 10^_^2025-10-27 17:07:53^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=lL4WzYvOSf4wYXNRacyuQ+drsdyGpVWpagh9O/pCiXgj6uBTyDdollRJWiHrMv5V3fN32fLvO8CozMTDAyXimxM8sFEbam8mYePbgn3cbk8EFHEEe9LOg5wlDVfyLtEL6sP/AZAOBaa9yacP00LHj7uAXEmLjF+ekEgAi+C23XXvw45w1AER5ZxkM+TRipq/KL1OfET3DI9pioGPd5VDJQHHmY7HdSmyNlQeNANR0XI+6ebOS9UtOHUBY5tDthmlHiGSlF01N+l92lWseWCAPvEmzld5Dbm69INfbaFoIw33exBMcQpzhd4wjmanSI43pG3m7VGDAXBs/BrPi4TtOw==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 17:07:53^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:traceId=060389ba176155607486310861954925&biz_content={"out_trade_no":"ORD17615560498429644"}^_^Body:{"alipay_trade_query_response":{"msg":"Business Failed","code":"40004","out_trade_no":"ORD17615560498429644","sub_msg":"交易不存在","sub_code":"ACQ.TRADE_NOT_EXIST","receipt_amount":"0.00","point_amount":"0.00","buyer_pay_amount":"0.00","invoice_amount":"0.00"},"sign":"m6pXDgtqv1zB/9QgUuQDWiJqGikD1frhzdYLS6xz/f7MjHDYADokh0VMJBy0tazLFPO0y+x+XVQZQTuk3qt1ikETu/Xq5xz1hAMnbVrujwySSZ341vjI1KNpsKvWIBbda82ykrPy7u2NfmUNT8xq5YVli+beMKyOqjaDB15902c4Al/ydlvuXbxxHUJlbnGUNyODxUXRPmiNCcgh5DkAfjeqVuw5z2VKiZKtDLu53JvS8P0UuKj20zeutqrnn7Wly0CwNTZogRPdDwjHmCWjm44MJdyIDt2K5Rj8kWD7f+7ft/06bjSXgfTCqU+r2vhQnp+axGzaLBfvRsTSb3y0lQ=="}^_^8ms,322ms,8ms^_^trace_id:060389ba176155607486310861954925
2025-10-27 17:07:53 [http-nio-8080-exec-3] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: false, 错误码: 40004, 错误信息: Business Failed, 交易状态: null
2025-10-27 17:07:53 [http-nio-8080-exec-3] ERROR com.jiaoyi.service.AlipayService - 支付宝支付查询失败，错误码: 40004, 错误信息: Business Failed, 子错误码: ACQ.TRADE_NOT_EXIST, 子错误信息: 交易不存在
2025-10-27 17:07:53 [http-nio-8080-exec-3] ERROR c.j.controller.PaymentController - 查询支付结果失败
java.lang.RuntimeException: 支付宝支付查询失败: Business Failed - 交易不存在
	at com.jiaoyi.service.AlipayService.queryPayment(AlipayService.java:141)
	at com.jiaoyi.controller.PaymentController.queryPayment(PaymentController.java:139)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:90)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:41002)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-27 17:07:53 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:53 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=500, message=查询失败: 支付宝支付查询失败: Business Failed - 交易不存在, data=null)]
2025-10-27 17:07:53 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:07:58 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615560498429644", parameters={}
2025-10-27 17:07:58 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 17:07:58 [http-nio-8080-exec-7] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615560498429644
2025-10-27 17:07:58 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615560498429644
2025-10-27 17:07:58 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615560498429644, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 17:07:58 [http-nio-8080-exec-7] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=TY6bz+J41bMBX1uvcx6JnZYCSCmBjXPollkFley2n2z0m+9rwkEQcfZLDGSO6oS17wQYTjrqgT9PfD2rEUi4JpHBgXnWr+B/2++OGxtKHqLHI+bJv+NSpedr6psDwBf1V3cYQzzrrpvSAK3dDSzm116fPKOBqXaQK3ylOW+fjWjB3UcbrKJKaoSWxDCy4EfqksNBJ66glWyVonRJoUqsw+EWbPd9rABqL8o0GtHzKj0P44Ao4t/6ezKjDF3sF+TH0zjDaifTTwnWUeDN8Ty4O5uvS/LT8x2KLGCLdtstBrTBy7kQNCobL8Bs8vEhG+QFcsEN4dmIzVKQxpVKdws1Mw==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 17:07:58^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615560498429644"}^_^8ms,210ms,9ms^_^trace_id:0601ac3e176155607987527194904
2025-10-27 17:07:58 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: WAIT_BUYER_PAY
2025-10-27 17:07:58 [http-nio-8080-exec-7] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615560498429644, 交易状态: WAIT_BUYER_PAY, 支付宝交易号: 2025102722001442270507352327
2025-10-27 17:07:58 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:07:58 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615560498429644, status=PEND (truncated)...]
2025-10-27 17:07:58 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/payment/alipay/notify", parameters={masked}
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#alipayNotify(HttpServletRequest)
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 收到支付宝支付回调通知
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: gmt_create = 2025-10-27 17:07:55
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: charset = UTF-8
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: seller_email = gvmmnq2968@sandbox.com
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: subject = 订单支付：ORD17615560498429644
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: sign = ELPPlY1bO+PwKgJz80mxIK3ZdwsyKEOItBpko1PLsGIO8AT1Ti5nIL1t2Wzg4SE/ykXCvRbGEI4o9JL6mzeD/tRLffoRcssTLPdp4TZZsJLXBJFEUdCx4he0Bm5lsVxBEXDoiZ3nkNLMLrOrBdEPzcor9PdVX5NMfgkY74BsxgjL9Du7NuCqAZz3U5P4ZdNa4PyEwHUraMD3sGVitF28ZI4DdxMjk/nT9SH0aTAvNIk6Ag0ClGgQQGk7TO8aQJJyEMv+XfrUGgAy77NBvUfl2meEmUk8cD4QBofdB8udbGUP7IKMlddYS/3CtiyELjl/5AbHbWG5HD2SBKog2ZMksg==
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: buyer_id = 2088722085542274
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: body = 商品购买
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: invoice_amount = 5500.00
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: notify_id = 2025102701222170802142270507219291
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: fund_bill_list = [{"amount":"5500.00","fundChannel":"ALIPAYACCOUNT"}]
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: notify_type = trade_status_sync
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: trade_status = TRADE_SUCCESS
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: receipt_amount = 5500.00
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: buyer_pay_amount = 5500.00
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: app_id = 9021000157614744
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: sign_type = RSA2
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: seller_id = 2088721085542262
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: gmt_payment = 2025-10-27 17:08:02
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: notify_time = 2025-10-27 17:08:03
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: version = 1.0
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: out_trade_no = ORD17615560498429644
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: total_amount = 5500.00
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: trade_no = 2025102722001442270507352327
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: auth_app_id = 9021000157614744
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: buyer_logon_id = bwugqj4497@sandbox.com
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 回调参数: point_amount = 0.00
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 支付回调处理 - 订单号: ORD17615560498429644, 状态: TRADE_SUCCESS, 金额: 5500.00, 支付宝交易号: 2025102722001442270507352327
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 开始处理支付成功回调，支付流水号: ORD17615560498429644
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.O.updateStatusToPaidIfPending - ==>  Preparing: UPDATE orders SET status = 'PAID', update_time = NOW() WHERE order_no = ? AND status = 'PENDING'
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.O.updateStatusToPaidIfPending - ==> Parameters: ORD17615560498429644(String)
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.O.updateStatusToPaidIfPending - <==    Updates: 1
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 订单状态更新为已支付，订单号: ORD17615560498429644
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 开始扣减库存，订单号: ORD17615560498429644
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 根据订单号扣减库存，订单号: ORD17615560498429644
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderNo - ==>  Preparing: SELECT oi.* FROM order_items oi INNER JOIN orders o ON oi.order_id = o.id WHERE o.order_no = ?
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderNo - ==> Parameters: ORD17615560498429644(String)
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.O.selectByOrderNo - <==      Total: 1
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 扣减库存，商品ID: 2002, 数量: 10, 订单ID: null
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==>  Preparing: SELECT * FROM inventory WHERE product_id = ?
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - ==> Parameters: 2002(Long)
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.I.selectByProductId - <==      Total: 1
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.InventoryMapper.deductStock - ==>  Preparing: UPDATE inventory SET current_stock = current_stock - ?, locked_stock = locked_stock - ?, update_time = NOW() WHERE product_id = ? AND locked_stock >= ?
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.InventoryMapper.deductStock - ==> Parameters: 10(Integer), 10(Integer), 2002(Long), 10(Integer)
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.InventoryMapper.deductStock - <==    Updates: 1
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==>  Preparing: INSERT INTO inventory_transactions ( product_id, order_id, transaction_type, quantity, before_stock, after_stock, before_locked, after_locked, remark, create_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - ==> Parameters: 2002(Long), null, OUT(String), 10(Integer), 999999999(Integer), 999999989(Integer), 180(Integer), 170(Integer), 支付成功扣减库存(String), 2025-10-27T17:08:02.726878700(LocalDateTime)
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG c.j.m.I.insert - <==    Updates: 1
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 库存扣减成功，商品ID: 2002, 扣减数量: 10
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 商品库存扣减成功，商品ID: 2002, 数量: 10
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  com.jiaoyi.service.InventoryService - 订单库存扣减完成，订单号: ORD17615560498429644
2025-10-27 17:08:02 [http-nio-8080-exec-6] INFO  c.j.controller.PaymentController - 支付成功处理完成，订单号: ORD17615560498429644
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'text/plain', given [*/*] and supported [text/plain, */*, application/json, application/*+json]
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing ["success"]
2025-10-27 17:08:02 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:08:03 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615560498429644", parameters={}
2025-10-27 17:08:03 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 17:08:03 [http-nio-8080-exec-9] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615560498429644
2025-10-27 17:08:03 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615560498429644
2025-10-27 17:08:03 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615560498429644, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 17:08:04 [http-nio-8080-exec-9] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=c5MNCaBzGamKUkcagkgrGKUIAgRkEGmuLvW8C845lwQrtX8WS/xrYEd6Ja+zxJ5W5xRuzFH/rILciZ94m9rsIe5ADXT6CTfkmTmY6WBDEG5I4aCFWDXBgaCvZt+FkwOeJ5qlL91ly4mc/h2B1d5ElNGp6RmOHa+8CPzgklyOGBTH2bkHiaS1lump6g/JiKqGAYVJCPrtEc1DKZb1/jaft9qSPuDGPtcOCygN8T5oX1AVdHua2xYBZZP//u/x/fCBZnS/uvOuLul0rkmdqAs0iqHrCIuYq6E7DOQWZfCxcVYeTOxdxiuwldoGlCyDRUcEMCjU16eCzhSuDjd0JWXL+w==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 17:08:03^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615560498429644"}^_^8ms,1031ms,12ms^_^trace_id:06013ec2176155608486912241436129
2025-10-27 17:08:04 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 17:08:04 [http-nio-8080-exec-9] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615560498429644, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507352327
2025-10-27 17:08:04 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:08:04 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615560498429644, status=SUCC (truncated)...]
2025-10-27 17:08:04 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:08:11 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615560498429644", parameters={}
2025-10-27 17:08:11 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 17:08:11 [http-nio-8080-exec-5] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615560498429644
2025-10-27 17:08:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615560498429644
2025-10-27 17:08:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615560498429644, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 17:08:11 [http-nio-8080-exec-5] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=bT2ddYGR8qzeGQsvx9joulfpIcHzhx3XQbWIcbfsfzYa0DyRhY8r7Sv8hQtNhiGV/0oxtSKb4Svh74HLGDn29KPPluSNErdtpuyVHrNQf/97wfjh+inBha6r0BP7TL1Dxj2DOh73qyt6tU2e7CNXN6XAREwZrq15L+m4Cal7/+X9q+2QtmvG3mTa1I7ahT2amWRsoo5+eLULr7AoQuS1bQyYyI9HvcZE3Y/uTi9t4LReCmIIWKGaWDHLDZUHjJCcmdYDBDgr+c+NzoHBnCMIeZnGDoPK2hmBp9oX9iC+O9qEq0pa/N1MEtNyaT7xM7dXuXa1HWsB6xcSTejKnpwVSQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 17:08:11^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615560498429644"}^_^8ms,291ms,9ms^_^trace_id:0601d6c717615560926708078919487
2025-10-27 17:08:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 17:08:11 [http-nio-8080-exec-5] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615560498429644, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507352327
2025-10-27 17:08:11 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:08:11 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615560498429644, status=SUCC (truncated)...]
2025-10-27 17:08:11 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:08:12 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/payment/query/ORD17615560498429644", parameters={}
2025-10-27 17:08:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.PaymentController#queryPayment(String)
2025-10-27 17:08:12 [http-nio-8080-exec-1] INFO  c.j.controller.PaymentController - 查询支付结果，支付流水号: ORD17615560498429644
2025-10-27 17:08:12 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 查询真实支付宝支付结果，订单号: ORD17615560498429644
2025-10-27 17:08:12 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 调用支付宝查询API，订单号: ORD17615560498429644, 网关: https://openapi-sandbox.dl.alipaydev.com/gateway.do
2025-10-27 17:08:12 [http-nio-8080-exec-1] INFO  sdk.biz.info - Summary^_^10000^_^null^_^ProtocalMustParams:charset=UTF-8&method=alipay.trade.query&sign=PnK9TyzXRqHLbFbxO+n2Vtwv9LC7R/SZeroRvLYcdZTBEPdBQv4o80IwlKqi8RzdKcCbt5OPfg7pcDqnoqQM794s49MoNbsgkI1P5JO19ngjD/rpuDoyOcIX+YQRiAub1OLv9IsI81AbK3AzuEEX36g7YSn2QjLesitdFLbsxUgw8FdB4EouOYxZ5O9kKSMX7idaU3/q/DgktDtBENGTYgbR9HUA8kBKGhnFskD8dlL/FVdKAr30uTZWf8s99gSTlCANp/+uW4PLwj8A+ggk4Aa2vGDIsbn3VpesRKmvHHKjzalaDWbPAKlcGbuhrBVY+z0zwGR/4E35PIRhBWl9qQ==&version=1.0&app_id=9021000157614744&sign_type=RSA2&timestamp=2025-10-27 17:08:12^_^ProtocalOptParams:alipay_sdk=alipay-sdk-java-4.38.10.ALL&format=json^_^ApplicationParams:biz_content={"out_trade_no":"ORD17615560498429644"}^_^8ms,420ms,9ms^_^trace_id:0601d58b176155609368748281407451
2025-10-27 17:08:12 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝查询响应 - 成功: true, 错误码: 10000, 错误信息: Success, 交易状态: TRADE_SUCCESS
2025-10-27 17:08:12 [http-nio-8080-exec-1] INFO  com.jiaoyi.service.AlipayService - 支付宝支付查询成功，订单号: ORD17615560498429644, 交易状态: TRADE_SUCCESS, 支付宝交易号: 2025102722001442270507352327
2025-10-27 17:08:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:08:12 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Writing [ApiResponse(code=200, message=查询成功, data=PaymentResponse(paymentNo=ORD17615560498429644, status=SUCC (truncated)...]
2025-10-27 17:08:12 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 17:08:17 [http-nio-8080-exec-10] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 19
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 31(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=31, orderNo=ORD17615560498429644, userId= (truncated)...]
2025-10-27 17:08:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 17:08:23 [http-nio-8080-exec-8] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 19
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 31(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=31, orderNo=ORD17615560498429644, userId= (truncated)...]
2025-10-27 17:08:23 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - GET "/api/orders/user/94", parameters={}
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.jiaoyi.controller.OrderController#getOrdersByUserId(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] INFO  c.jiaoyi.controller.OrderController - 查询用户订单列表，用户ID: 94
2025-10-27 17:08:24 [http-nio-8080-exec-2] INFO  com.jiaoyi.service.OrderService - 查询用户订单列表，用户ID: 94
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==>  Preparing: SELECT * FROM orders WHERE user_id = ? ORDER BY create_time DESC
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - ==> Parameters: 94(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.OrderMapper.selectByUserId - <==      Total: 19
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 31(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 30(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 29(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 28(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 27(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 26(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 25(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 24(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 23(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 22(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 21(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 20(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 19(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 18(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 17(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 16(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 15(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 14(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==>  Preparing: SELECT * FROM order_items WHERE order_id = ?
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - ==> Parameters: 13(Long)
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG c.j.m.O.selectByOrderId - <==      Total: 1
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [ApiResponse(code=200, message=操作成功, data=[OrderResponse(id=31, orderNo=ORD17615560498429644, userId= (truncated)...]
2025-10-27 17:08:24 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-10-27 17:08:29 [ConsumeMessageThread_order-timeout-consumer-group_2] INFO  c.j.s.OrderTimeoutMessageService - 接收到订单超时消息，订单ID: 31, 订单号: ORD17615560498429644
2025-10-27 17:08:34 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.selectById - ==>  Preparing: SELECT * FROM orders WHERE id = ?
2025-10-27 17:08:34 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.selectById - ==> Parameters: 31(Long)
2025-10-27 17:08:34 [ConsumeMessageThread_order-timeout-consumer-group_2] DEBUG c.j.mapper.OrderMapper.selectById - <==      Total: 1
2025-10-27 17:08:36 [ConsumeMessageThread_order-timeout-consumer-group_2] INFO  c.j.s.OrderTimeoutMessageService - 订单状态已变更，跳过超时处理，订单ID: 31, 当前状态: PAID
