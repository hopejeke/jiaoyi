# OO项目有但当前项目缺失的功能详细清单

## 📋 目录

1. [核心业务功能](#核心业务功能)
2. [用户和通知功能](#用户和通知功能)
3. [运营和分析功能](#运营和分析功能)
4. [第三方集成功能](#第三方集成功能)
5. [高级功能](#高级功能)
6. [工具和服务功能](#工具和服务功能)

---

## 🔴 核心业务功能

### 1. **购物车（Shopping Cart）** ⭐⭐⭐
- **OO项目位置**: `server/app/controllers/shoppingCart.ts`
- **功能描述**:
  - ✅ 添加/更新购物车商品
  - ✅ 按桌码（tableId）管理购物车（堂食场景）
  - ✅ 购物车过期时间管理（自动清理）
  - ✅ 购物车持久化存储（Redis + MongoDB）
  - ✅ 购物车商品数量修改
  - ✅ 购物车清空
  - ✅ 购物车合并（登录后合并临时购物车）
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🔴 **极高**（用户下单前必需功能）
- **业务影响**: 
  - 用户无法在支付前管理商品
  - 无法支持堂食场景（桌码购物车）
  - 用户体验差，需要每次重新选择商品

### 2. **钱包（Wallet）** ⭐⭐⭐
- **OO项目位置**: `server/app/controllers/wallet.ts`
- **功能描述**:
  - ✅ 保存用户信用卡信息（Stripe PaymentMethod ID）
  - ✅ 管理多张信用卡（添加/删除/设为默认）
  - ✅ 信用卡过期自动清理
  - ✅ 快速支付（使用已保存的卡，无需重复输入）
  - ✅ 钱包安全（加密存储）
- **当前状态**: ❌ **完全未实现**（前端有保存卡片逻辑，但后端无钱包服务）
- **优先级**: 🔴 **高**（提升支付体验，减少支付流失）
- **业务影响**:
  - 用户每次支付都需要重新输入卡号
  - 支付流程繁琐，容易流失
  - 无法提供"一键支付"体验

### 3. **礼品卡（Gift Card）** ⭐⭐
- **OO项目位置**: `server/app/controllers/gift-card.ts`
- **功能描述**:
  - ✅ 礼品卡库存管理（面值卡、商品卡）
  - ✅ 购买礼品卡（创建礼品卡订单）
  - ✅ 使用礼品卡支付（抵扣订单金额）
  - ✅ 礼品卡余额查询
  - ✅ 礼品卡转赠
  - ✅ 礼品卡使用记录
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（增加收入渠道，提升用户粘性）
- **业务影响**:
  - 无法通过礼品卡增加预付费收入
  - 缺少营销工具（礼品卡促销）

### 4. **促销活动系统（Promotion）** ⭐⭐⭐
- **OO项目位置**: `server/app/controllers/promotion.ts`
- **功能描述**:
  - ✅ 促销活动配置（满减、折扣、买赠等）
  - ✅ 促销策略（叠加、互斥、优先级）
  - ✅ 时间范围控制（每日时间段、每周、每月）
  - ✅ 促销活动查询和计算
  - ✅ 促销活动与优惠券联动
  - ✅ 促销活动效果统计
- **当前状态**: ⚠️ **部分实现**（只有优惠券，缺少完整的促销活动系统）
- **优先级**: 🔴 **高**（营销核心功能）
- **业务影响**:
  - 营销手段单一，只有优惠券
  - 无法做复杂的促销活动（如满减、买赠）
  - 营销效果受限

### 5. **热门商品（Popular Items）** ⭐⭐
- **OO项目位置**: `server/app/controllers/popular-item.ts`
- **功能描述**:
  - ✅ 基于订单数据统计热门商品
  - ✅ 按时间周期更新（如每周、每月）
  - ✅ Redis缓存热门商品列表
  - ✅ 支持在线订单和堂食分别统计
  - ✅ 热门商品推荐（提升转化率）
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（提升用户体验和转化率）
- **业务影响**:
  - 无法展示热门商品，用户选择困难
  - 无法利用数据驱动商品推荐

### 6. **桌码二维码（Table QR）** ⭐⭐
- **OO项目位置**: `server/app/controllers/table-qr.ts`
- **功能描述**:
  - ✅ 生成桌码二维码
  - ✅ 扫码绑定桌码和商户
  - ✅ 桌码订单管理（堂食订单）
  - ✅ 桌码购物车（按桌码管理）
  - ✅ 桌码订单状态追踪
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（支持堂食场景）
- **业务影响**:
  - 无法支持堂食扫码点餐场景
  - 缺少重要的业务场景支持

---

## 🟡 用户和通知功能

### 7. **用户管理（User）** ⭐⭐⭐
- **OO项目位置**: `server/app/controllers/user.ts`
- **功能描述**:
  - ✅ 用户注册/登录（邮箱/手机号）
  - ✅ 用户信息管理（昵称、头像、地址等）
  - ✅ 用户会话管理（Session）
  - ✅ 用户权限控制（角色管理）
  - ✅ 用户密码重置
  - ✅ 用户注销
- **当前状态**: ⚠️ **部分实现**（可能有基础用户功能，但需要确认完整性）
- **优先级**: 🔴 **高**（基础功能）
- **业务影响**: 如果用户管理不完整，会影响整个系统的用户体验

### 8. **验证码服务（Verification Code）** ⭐⭐
- **OO项目位置**: `server/app/controllers/veri-code.ts`
- **功能描述**:
  - ✅ 短信验证码发送（Twilio集成）
  - ✅ 邮箱验证码发送
  - ✅ 验证码验证（登录/注册/重置密码）
  - ✅ 验证码过期管理
  - ✅ 验证码防刷（频率限制）
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（如果用户系统需要验证码，则必须实现）
- **业务影响**: 无法支持手机号/邮箱验证码登录

### 9. **通知系统（Notification）** ⭐⭐
- **OO项目位置**: `server/app/controllers/notification.ts`
- **功能描述**:
  - ✅ 订单状态通知（创建、支付、配送、完成）
  - ✅ 促销活动通知
  - ✅ 系统公告
  - ✅ 未读消息计数
  - ✅ 消息已读标记
  - ✅ 消息分类（订单、促销、系统）
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（提升用户粘性）
- **业务影响**: 用户无法及时收到订单状态更新，体验差

### 10. **推送服务（Push）** ⭐⭐
- **OO项目位置**: `server/app/controllers/push.ts`, `server/app/services/pushServer.ts`
- **功能描述**:
  - ✅ iOS推送（APNs - Apple Push Notification Service）
  - ✅ Android推送（FCM - Firebase Cloud Messaging）
  - ✅ 推送消息模板（订单、促销、系统消息）
  - ✅ Badge计数管理（iOS角标）
  - ✅ 设备Token管理（注册/注销）
  - ✅ 推送失败重试
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（实时通知用户）
- **业务影响**: 无法实时推送订单状态，用户需要主动查询

### 11. **用户消息中心（User Message Center）** ⭐
- **OO项目位置**: `server/app/controllers/userMessageCenter.ts`
- **功能描述**:
  - ✅ 用户消息列表（分页）
  - ✅ 消息分类（公告、促销、新闻）
  - ✅ 未读消息统计
  - ✅ 消息状态管理（已读/未读/删除）
  - ✅ 消息详情查看
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（消息中心功能）
- **业务影响**: 用户无法统一管理消息

---

## 🟢 运营和分析功能

### 12. **流量追踪（Track）** ⭐
- **OO项目位置**: `server/app/controllers/track.ts`
- **功能描述**:
  - ✅ 页面访问统计（PV - Page View）
  - ✅ 用户行为追踪（点击、浏览时长）
  - ✅ 订单转化率分析
  - ✅ 二维码访问统计
  - ✅ 流量来源分析（来源渠道、UTM参数）
  - ✅ 用户路径分析
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（数据分析功能）
- **业务影响**: 无法进行数据分析和优化

### 13. **黑名单客户（Block Customer）** ⭐⭐
- **OO项目位置**: `server/app/controllers/blockCustomer.ts`
- **功能描述**:
  - ✅ 商户黑名单管理（添加/删除/查询）
  - ✅ 按手机号/邮箱封禁
  - ✅ 封禁原因记录
  - ✅ 下单时检查黑名单（风控）
  - ✅ 黑名单有效期管理
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（风控功能）
- **业务影响**: 无法防止恶意用户下单，风控能力弱

### 14. **交易记录（Transaction）** ⭐⭐
- **OO项目位置**: `server/app/controllers/transaction.ts`
- **功能描述**:
  - ✅ 支付交易记录聚合（聚合Payment记录）
  - ✅ 退款交易记录
  - ✅ 交易对账（商户对账）
  - ✅ 交易查询（按时间、商户、状态）
  - ✅ 交易统计报表
- **当前状态**: ⚠️ **部分实现**（有Payment记录，但缺少Transaction聚合）
- **优先级**: 🟡 **中**（财务对账）
- **业务影响**: 财务对账困难，需要手动聚合Payment记录

---

## 🔵 第三方集成功能

### 15. **微信集成（WeChat）** ⭐⭐
- **OO项目位置**: `server/app/controllers/wechat/wechat.ts`, `server/app/controllers/weixin.ts`
- **功能描述**:
  - ✅ 微信登录（OAuth2）
  - ✅ 微信支付（统一下单、支付回调）
  - ✅ 微信用户信息获取
  - ✅ 微信公众号集成（菜单、消息）
  - ✅ 微信小程序支持
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（取决于业务需求，中国市场必需）
- **业务影响**: 如果目标市场是中国，微信集成是必需的

### 16. **Google订单（Google Food Order）** ⭐
- **OO项目位置**: `server/app/controllers/google/googleOrderCheckout.ts`, `server/app/controllers/google/googleOrderUpload.ts`
- **功能描述**:
  - ✅ Google订单同步（从Google平台接收订单）
  - ✅ Google订单状态更新（同步订单状态到Google）
  - ✅ Google订单验证（订单真实性校验）
  - ✅ Google订单菜单同步（同步菜单到Google）
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（特定业务需求）
- **业务影响**: 如果需要在Google平台接单，则必须实现

### 17. **Riskified反欺诈** ⭐
- **OO项目位置**: `server/app/services/riskified/riskified.ts`
- **功能描述**:
  - ✅ 订单风险评估（Riskified API集成）
  - ✅ 反欺诈检测（识别可疑订单）
  - ✅ 风险评估结果处理（通过/拒绝/人工审核）
  - ✅ 风险评估记录
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（特定业务需求）
- **业务影响**: 如果业务需要反欺诈能力，则必须实现

---

## 🟣 高级功能

### 18. **分单支付（Split Order Payment）** ⭐⭐
- **OO项目位置**: `分单支付技术方案.md`
- **功能描述**:
  - ✅ 订单分单（按订单项/按比例/按价格）
  - ✅ 子订单独立支付
  - ✅ 父订单状态聚合（所有子订单支付完成后，父订单状态更新）
  - ✅ POS系统同步（分单信息同步到POS）
  - ✅ 分单撤销（未支付前可以撤销分单）
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（多人聚餐场景）
- **业务影响**: 无法支持多人聚餐AA制支付场景
- **技术复杂度**: 🔴 **高**（需要扩展订单模型、支付模型、状态管理）

### 19. **POS分单机制** ⭐
- **OO项目位置**: `POS分单机制说明.md`
- **功能描述**:
  - ✅ 订单项拆分（按数量拆分）
  - ✅ 按打印机分单（订单项发送到不同打印机）
  - ✅ 厨房显示系统（KDS）集成
  - ✅ 打印机状态管理
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（POS系统功能）
- **业务影响**: 如果POS系统需要分单功能，则必须实现

### 20. **定时任务服务（Task Service）** ⭐⭐
- **OO项目位置**: `oo2-task/`
- **功能描述**:
  - ✅ 定时任务调度（Quartz/XXL-Job）
  - ✅ 后台任务处理（异步任务）
  - ✅ 任务状态管理（运行中/成功/失败）
  - ✅ 任务重试机制
  - ✅ 任务管理界面（Dashboard）
- **当前状态**: ⚠️ **部分实现**（有Spring Scheduled，但缺少独立任务服务）
- **优先级**: 🟡 **中**（基础设施）
- **业务影响**: 复杂定时任务管理困难，缺少任务监控

---

## 🛠️ 工具和服务功能

### 21. **文件上传服务（Upload）** ⭐⭐
- **OO项目位置**: `server/app/controllers/upload.ts`
- **功能描述**:
  - ✅ 图片上传（商品图片、用户头像）
  - ✅ 文件上传（支持多种格式）
  - ✅ 图片压缩和格式转换
  - ✅ 文件存储（本地/S3/OSS）
  - ✅ 文件访问URL生成
- **当前状态**: ❌ **完全未实现**（需要确认）
- **优先级**: 🟡 **中**（如果商品/用户需要上传图片，则必需）
- **业务影响**: 无法上传商品图片、用户头像等

### 22. **PDF生成服务（PDF Service）** ⭐
- **OO项目位置**: `server/app/services/pdfService.ts`
- **功能描述**:
  - ✅ 订单PDF生成（订单详情PDF）
  - ✅ 发票PDF生成
  - ✅ 报表PDF生成
  - ✅ PDF模板管理
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（按需实现）
- **业务影响**: 无法生成订单PDF、发票等

### 23. **邮件发送服务（Email Service）** ⭐⭐
- **OO项目位置**: `server/app/services/sendEmail.ts`, `server/app/services/sendEmailAttach.ts`
- **功能描述**:
  - ✅ 订单确认邮件
  - ✅ 订单状态更新邮件
  - ✅ 促销活动邮件
  - ✅ 邮件模板管理
  - ✅ 邮件附件支持
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（提升用户体验）
- **业务影响**: 无法发送订单确认邮件、促销邮件等

### 24. **短信服务（SMS - Twilio）** ⭐⭐
- **OO项目位置**: `server/app/services/twillio.ts`
- **功能描述**:
  - ✅ 短信发送（Twilio集成）
  - ✅ 验证码短信
  - ✅ 订单通知短信
  - ✅ 短信模板管理
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟡 **中**（如果用户系统需要短信验证码，则必需）
- **业务影响**: 无法发送验证码短信、订单通知短信

### 25. **短链接服务（Bitly）** ⭐
- **OO项目位置**: `server/app/services/bitlyService.ts`
- **功能描述**:
  - ✅ 生成短链接（Bitly API集成）
  - ✅ 短链接统计（点击量、来源）
  - ✅ 短链接管理
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（营销工具）
- **业务影响**: 无法生成短链接用于营销推广

### 26. **图片压缩服务（Image Compression）** ⭐
- **OO项目位置**: `server/app/services/compressImageToZip.ts`
- **功能描述**:
  - ✅ 图片压缩（减少文件大小）
  - ✅ 图片格式转换
  - ✅ 批量图片处理
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（性能优化）
- **业务影响**: 图片文件过大，影响加载速度

### 27. **Excel导出服务（XLSX）** ⭐
- **OO项目位置**: `server/app/services/xlsx.ts`
- **功能描述**:
  - ✅ 订单数据导出Excel
  - ✅ 报表导出Excel
  - ✅ Excel模板生成
- **当前状态**: ❌ **完全未实现**
- **优先级**: 🟢 **低**（运营工具）
- **业务影响**: 无法导出订单数据、报表等

---

## 📊 功能优先级总结

### 🔴 极高优先级（必须实现，核心业务）
1. **购物车（Shopping Cart）** - 用户下单前必需功能
2. **钱包（Wallet）** - 提升支付体验，减少支付流失
3. **促销活动系统（Promotion）** - 营销核心功能
4. **用户管理（User）** - 基础功能，需要确认完整性

### 🟡 高优先级（重要功能，建议实现）
5. **礼品卡（Gift Card）** - 增加收入渠道
6. **热门商品（Popular Items）** - 提升用户体验和转化率
7. **桌码二维码（Table QR）** - 支持堂食场景
8. **通知系统（Notification）** - 提升用户粘性
9. **推送服务（Push）** - 实时通知用户
10. **黑名单客户（Block Customer）** - 风控功能
11. **交易记录（Transaction）** - 财务对账
12. **分单支付（Split Order Payment）** - 多人聚餐场景
13. **验证码服务（Verification Code）** - 如果用户系统需要
14. **文件上传服务（Upload）** - 如果商品/用户需要上传图片
15. **邮件发送服务（Email Service）** - 提升用户体验
16. **短信服务（SMS）** - 如果用户系统需要短信验证码

### 🟢 中低优先级（可选功能，按需实现）
17. **流量追踪（Track）** - 数据分析
18. **用户消息中心（User Message Center）** - 消息管理
19. **微信集成（WeChat）** - 特定市场（中国市场必需）
20. **Google订单（Google Food Order）** - 特定业务
21. **Riskified反欺诈** - 特定需求
22. **POS分单机制** - POS系统功能
23. **定时任务服务（Task Service）** - 基础设施
24. **PDF生成服务** - 按需实现
25. **短链接服务（Bitly）** - 营销工具
26. **图片压缩服务** - 性能优化
27. **Excel导出服务** - 运营工具

---

## 🎯 实现建议

### 阶段一：核心功能（1-2个月）
1. ✅ 购物车服务
2. ✅ 钱包服务
3. ✅ 促销活动系统
4. ✅ 用户管理完善

### 阶段二：重要功能（2-3个月）
5. ✅ 礼品卡系统
6. ✅ 热门商品统计
7. ✅ 通知和推送系统
8. ✅ 分单支付
9. ✅ 验证码服务
10. ✅ 文件上传服务
11. ✅ 邮件和短信服务

### 阶段三：运营功能（3-4个月）
12. ✅ 流量追踪
13. ✅ 黑名单管理
14. ✅ 交易记录聚合
15. ✅ 第三方集成（微信等）
16. ✅ 其他工具服务

---

## 📝 总结

**当前项目缺失的功能总数：27个**

- 🔴 极高优先级：4个
- 🟡 高优先级：12个
- 🟢 中低优先级：11个

**建议优先实现的核心功能：**
1. 购物车服务（用户下单必需）
2. 钱包服务（提升支付体验）
3. 促销活动系统（营销核心）
4. 用户管理完善（基础功能）

这些功能实现后，当前项目将具备完整的在线点餐系统能力。



