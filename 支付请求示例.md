# 支付请求填写示例

## 📋 支付请求参数说明

### 1. 创建订单请求

**接口**: `POST /orders`

**请求体**:
```json
{
  "userId": 94,
  "receiverName": "张三",
  "receiverPhone": "13800138000",
  "receiverAddress": "北京市朝阳区xxx街道",
  "remark": "请尽快发货",
  "orderItems": [
    {
      "productId": 2002,
      "productName": "质朴的钢鞋子",
      "productImage": "https://example.com/shoe.jpg",
      "unitPrice": 634.75,
      "quantity": 10
    }
  ]
}
```

**响应**:
```json
{
  "success": true,
  "message": "订单创建成功",
  "data": {
    "id": 1,
    "orderNo": "ORD1703123456789ABCDEFGH",
    "userId": 94,
    "status": "PENDING",
    "totalAmount": 6347.50,
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "receiverAddress": "北京市朝阳区xxx街道",
    "remark": "请尽快发货",
    "createTime": "2024-01-01 10:00:00",
    "orderItems": [...]
  }
}
```

---

### 2. 支付订单请求

**接口**: `POST /orders/{orderId}/pay`

**请求体**:
```json
{
  "paymentMethod": "ALIPAY",
  "amount": 634750,
  "channel": "WEB",
  "clientIp": "192.168.1.100",
  "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
  "remark": "支付宝支付"
}
```

**参数说明**:
- `paymentMethod`: 支付方式
  - `ALIPAY`: 支付宝支付
  - `WECHAT`: 微信支付
  - `BANK`: 银行卡支付
- `amount`: 支付金额（分），例如：634750 = 6347.50元
- `channel`: 支付渠道
  - `WEB`: 网页支付
  - `APP`: 应用支付
  - `H5`: 手机网页支付
- `clientIp`: 客户端IP地址
- `userAgent`: 用户代理信息
- `remark`: 备注信息

**响应**:
```json
{
  "success": true,
  "message": "支付处理成功",
  "data": {
    "paymentNo": "PAY1703123456789ABCDEFGH",
    "status": "PENDING",
    "paymentMethod": "ALIPAY",
    "amount": 634750,
    "payUrl": "https://openapi.alipay.com/gateway.do?charset=UTF-8&method=alipay.trade.page.pay&sign=...",
    "remark": "支付宝支付订单创建成功"
  }
}
```

---

## 🚀 完整测试流程

### 1. 创建订单

```bash
curl -X POST http://localhost:8080/orders \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 94,
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "receiverAddress": "北京市朝阳区xxx街道",
    "remark": "请尽快发货",
    "orderItems": [
      {
        "productId": 2002,
        "productName": "质朴的钢鞋子",
        "productImage": "https://example.com/shoe.jpg",
        "unitPrice": 634.75,
        "quantity": 10
      }
    ]
  }'
```

### 2. 支付订单

```bash
curl -X POST http://localhost:8080/orders/1/pay \
  -H "Content-Type: application/json" \
  -d '{
    "paymentMethod": "ALIPAY",
    "amount": 634750,
    "channel": "WEB",
    "clientIp": "192.168.1.100",
    "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
    "remark": "支付宝支付"
  }'
```

### 3. 查询支付结果

```bash
curl -X GET http://localhost:8080/api/payment/query/PAY1703123456789ABCDEFGH
```

---

## 💡 前端集成示例

### JavaScript 示例

```javascript
// 1. 创建订单
async function createOrder() {
  const orderData = {
    userId: 94,
    receiverName: "张三",
    receiverPhone: "13800138000",
    receiverAddress: "北京市朝阳区xxx街道",
    remark: "请尽快发货",
    orderItems: [
      {
        productId: 2002,
        productName: "质朴的钢鞋子",
        productImage: "https://example.com/shoe.jpg",
        unitPrice: 634.75,
        quantity: 10
      }
    ]
  };
  
  const response = await fetch('/orders', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(orderData)
  });
  
  const result = await response.json();
  return result.data;
}

// 2. 支付订单
async function payOrder(orderId) {
  const paymentData = {
    paymentMethod: "ALIPAY",
    amount: 634750, // 6347.50元 * 100
    channel: "WEB",
    clientIp: "192.168.1.100",
    userAgent: navigator.userAgent,
    remark: "支付宝支付"
  };
  
  const response = await fetch(`/orders/${orderId}/pay`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(paymentData)
  });
  
  const result = await response.json();
  
  if (result.success && result.data.payUrl) {
    // 跳转到支付宝支付页面
    window.location.href = result.data.payUrl;
  }
}

// 3. 查询支付结果
async function queryPayment(paymentNo) {
  const response = await fetch(`/api/payment/query/${paymentNo}`);
  const result = await response.json();
  return result.data;
}
```

### Vue.js 示例

```vue
<template>
  <div>
    <h2>订单支付</h2>
    <form @submit.prevent="createOrder">
      <input v-model="orderForm.receiverName" placeholder="收货人姓名" required>
      <input v-model="orderForm.receiverPhone" placeholder="收货人电话" required>
      <input v-model="orderForm.receiverAddress" placeholder="收货地址" required>
      <button type="submit">创建订单</button>
    </form>
    
    <div v-if="order">
      <h3>订单信息</h3>
      <p>订单号: {{ order.orderNo }}</p>
      <p>总金额: {{ order.totalAmount }}元</p>
      <button @click="payOrder">支付宝支付</button>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      orderForm: {
        userId: 94,
        receiverName: '',
        receiverPhone: '',
        receiverAddress: '',
        remark: '',
        orderItems: [
          {
            productId: 2002,
            productName: "质朴的钢鞋子",
            productImage: "https://example.com/shoe.jpg",
            unitPrice: 634.75,
            quantity: 10
          }
        ]
      },
      order: null
    }
  },
  methods: {
    async createOrder() {
      try {
        const response = await fetch('/orders', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(this.orderForm)
        });
        
        const result = await response.json();
        if (result.success) {
          this.order = result.data;
        }
      } catch (error) {
        console.error('创建订单失败:', error);
      }
    },
    
    async payOrder() {
      try {
        const paymentData = {
          paymentMethod: "ALIPAY",
          amount: Math.round(this.order.totalAmount * 100), // 转换为分
          channel: "WEB",
          clientIp: "192.168.1.100",
          userAgent: navigator.userAgent,
          remark: "支付宝支付"
        };
        
        const response = await fetch(`/orders/${this.order.id}/pay`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(paymentData)
        });
        
        const result = await response.json();
        if (result.success && result.data.payUrl) {
          window.location.href = result.data.payUrl;
        }
      } catch (error) {
        console.error('支付失败:', error);
      }
    }
  }
}
</script>
```

---

## 📱 移动端示例

### 微信小程序

```javascript
// 创建订单
wx.request({
  url: 'https://your-domain.com/orders',
  method: 'POST',
  data: {
    userId: 94,
    receiverName: "张三",
    receiverPhone: "13800138000",
    receiverAddress: "北京市朝阳区xxx街道",
    orderItems: [
      {
        productId: 2002,
        productName: "质朴的钢鞋子",
        unitPrice: 634.75,
        quantity: 10
      }
    ]
  },
  success: function(res) {
    if (res.data.success) {
      // 支付订单
      wx.request({
        url: `https://your-domain.com/orders/${res.data.data.id}/pay`,
        method: 'POST',
        data: {
          paymentMethod: "WECHAT",
          amount: 634750,
          channel: "APP"
        },
        success: function(payRes) {
          if (payRes.data.success) {
            // 调用微信支付
            wx.requestPayment({
              timeStamp: payRes.data.data.timeStamp,
              nonceStr: payRes.data.data.nonceStr,
              package: payRes.data.data.package,
              signType: payRes.data.data.signType,
              paySign: payRes.data.data.paySign,
              success: function() {
                console.log('支付成功');
              }
            });
          }
        }
      });
    }
  }
});
```

---

## 🔧 测试工具

### Postman 测试

1. **创建订单**
   - Method: POST
   - URL: `http://localhost:8080/orders`
   - Headers: `Content-Type: application/json`
   - Body: 使用上面的JSON示例

2. **支付订单**
   - Method: POST
   - URL: `http://localhost:8080/orders/1/pay`
   - Headers: `Content-Type: application/json`
   - Body: 使用上面的支付JSON示例

3. **查询支付结果**
   - Method: GET
   - URL: `http://localhost:8080/api/payment/query/PAY1703123456789ABCDEFGH`

### 浏览器测试

```html
<!DOCTYPE html>
<html>
<head>
    <title>支付测试</title>
</head>
<body>
    <button onclick="testPayment()">测试支付</button>
    
    <script>
        async function testPayment() {
            // 1. 创建订单
            const orderResponse = await fetch('/orders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userId: 94,
                    receiverName: "张三",
                    receiverPhone: "13800138000",
                    receiverAddress: "北京市朝阳区xxx街道",
                    orderItems: [
                        {
                            productId: 2002,
                            productName: "质朴的钢鞋子",
                            unitPrice: 634.75,
                            quantity: 10
                        }
                    ]
                })
            });
            
            const orderResult = await orderResponse.json();
            console.log('订单创建结果:', orderResult);
            
            if (orderResult.success) {
                // 2. 支付订单
                const paymentResponse = await fetch(`/orders/${orderResult.data.id}/pay`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        paymentMethod: "ALIPAY",
                        amount: 634750,
                        channel: "WEB",
                        clientIp: "192.168.1.100",
                        userAgent: navigator.userAgent,
                        remark: "支付宝支付"
                    })
                });
                
                const paymentResult = await paymentResponse.json();
                console.log('支付结果:', paymentResult);
                
                if (paymentResult.success && paymentResult.data.payUrl) {
                    // 3. 跳转到支付宝支付页面
                    window.open(paymentResult.data.payUrl, '_blank');
                }
            }
        }
    </script>
</body>
</html>
```
