server:
  port: 8080
  servlet:
    context-path: /

spring:
  application:
    name: jiaoyi
  
  # 数据库配置
  datasource:
    url: jdbc:mysql://localhost:3306/jiaoyi?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver

  # Redis配置
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 5000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms


# 日志配置
logging:
  level:
    com.jiaoyi: DEBUG
    org.springframework.web: DEBUG
    com.jiaoyi.mapper: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/jiaoyi.log

# PageHelper分页配置 - 暂时注释掉
# pagehelper:
#   helper-dialect: mysql
#   reasonable: true
#   support-methods-arguments: true

# 管理端点配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
mybatis:
  mapper-locations: classpath*:mapper/**/*.xml

# 支付宝配置
alipay:
  app-id: 9021000157614744
  private-key: MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCpF55H9itcdeWgcOVy1xHz0zQKTWo1lnnakQ2oboGHg0mJJQTVW0hb3QMefN3Z13xXwpY9WA3nFWjlFB6TJ+8Nos9a7kVa0LUx5OsgdcQs9vv9dINdJCi2StwhUXY1L76hNncVTBkNFzpv6NW9GKZ997KhVPJmgxqOQXruY8Wy7KCNHu6NW6PWj1ueZ9ZmP0pTxGuSumCAoqCEyiqGkk+P2lw1Vh2Pt/RT5xJv9N8mcpgMm0UIp9rvOQqldvLnX9/CE2JKnBSKrIR+3j5X2l98g6FMXhhYLYw6s+7SH0RJcnVUDvWZA/dK8I7pcH9SodEcYRawoC8I2JiH5tJc0FyZAgMBAAECggEADgh+w1wjxx2lvAYClOBShhjOJdi86sudO010g7kAGP4FWVNwLkDQJYeXHa2hP9YJZMMqctbe+IGnXfOoge/7f/c2HEbQDLRrhUOJW/1KFa09xpAn4tAAbPiTglRfahSXTovVoDfbkGGQIP+C1Zm5H5UyBv+kymsxBgNbL3OqUan84OfV6JaxFxfJrOR/M/xzpH1bNmCVSBnpppxQEst2aTmyf4bRmsrXE7UnCJOVeOXdsX4fzEh5a+ITR/RX0F1IunAXLKBsiXoiBRioen15rQ/p4UmWgNTkn1RrAAdkORL9huequVtCiAzjMYajQm58+iy2UVrOI3rJSGGNia39zQKBgQDuqo3FlbIV0dRMgMi+tRWcxuGdOCQBcEuqryJOHELAoZfpqPP0MSurYVqwHr33TsK73IA4pqA0SbOencup5ld1V2Sdo02CGO2rj/0nXFVmp+y/NvM5XAXtcgYIN2r02/yQlZSKh/CdGyEnn5nkmQ4NxXDLq6kaXPM//nMU2NxpvwKBgQC1X39glMrYuYXKITzPp/QuAA9kmxRXB7eZ+zeetGq04bwJJ1yZ+Ri9jgxrdgoMTBGjdGi+O1Pd+ykdbQXmpZN+53eTh0XbW0NFmeP7HJAegZTotfFOO5VEHxfhmBjhsP4IDLH5rhfsURExPEpykrYaYhu2kL/xBynLC1Gq0ZbfpwKBgQC+e50fP3Sc+ZVpYbfWjYysTgcvhekmxMt/dLv6f4+/Url+IfxivwPNiqvouQCA63l8mmYz0Lk4QkJ7rBEqjs7qtk91iSqJVQAL16YCzizS+992VZMWCp4ofsLVt/VDbHhNpTSixBCEM2zoxPb8fjO7RgPaai1S/zCduKV81ABG3QKBgD6iQ/Kub354UuOCpuVvMrvP+YDcrSGA4L6kKoj79P2SFsVyemARzaFoNJHHqaClhFHWGXXYNxYpbgFjbO5Br7XbaUfhJxahZZHbmwdUzdA7H5lde39wxBNKSYz2YWFPJerRt4RpwokxVaaTE4KNd6WUy804H5C00JH1zrYWuutxAoGBANM7WD2+ZGoUM+Km+/1PVWxEADJMr9y8RyvYZcA19HSDglcs4s6yo0bJzVRvV1pPJI5rE6w5alqMZTvpbqc1EjvCSut7Zzid8PhlIu7YLPkAV4QXa8BylIlrtP71erSNIa/0Repd9UfVNdRdsuS0OaIF40jwPx3YjuF1leMY3s72
  alipay-public-key: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArwnAv9vI/HO6xFiRcAiZgJcf7nSFeLTZeyO32hsRtzoeWs6Wk6ePNEF/WM1rQG005DNXkc7pt58W6Y3aWb45tChrG/NNoftOdNXp4IYoXb60KtvuepBTLxqPu+zaJrMfz4IC72OkJFijFNyCKFNF81lvkFQigEsY5Iqv0Iy88dKdvAHzQQOEFyh6jVnpuDOWmkdR9PpTCNOCx4GDCa9b1FvxBw/zkoWn/Ln/zUmmyu47d5ZwstPpvWP6fAFyJH5ukcNs+p5mkWZK6e14+7LAUkGcNRNPpeeuRCTVwYBJcQzyffALNn9NtYi/sf5eHMadXazM42jtJ9Kdya1huVhgFwIDAQAB
  gateway-url: https://openapi-sandbox.dl.alipaydev.com/gateway.do
  sign-type: RSA2
  charset: UTF-8
  format: JSON
  notify-url:  https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify
  return-url:  https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return

# RocketMQ配置
rocketmq:
  name-server: localhost:9876
  producer:
    group: order-timeout-producer-group
    send-message-timeout: 3000
    retry-times-when-send-failed: 2
  consumer:
    group: order-timeout-consumer-group

# 订单超时配置
order:
  timeout:
    minutes: 40  # 订单超时时间（分钟）
    fallback:
      enabled: true  # 是否启用兜底定时任务
      interval: 300000  # 兜底任务执行间隔（毫秒），默认5分钟

# Outbox配置
outbox:
  # 定时任务执行间隔（毫秒）
  # 建议值：
  # - 高频场景（商品操作频繁）：1000-3000ms（1-3秒）
  # - 中频场景（一般业务）：3000-5000ms（3-5秒）
  # - 低频场景（商品操作较少）：5000-10000ms（5-10秒）
  # 默认2000ms（2秒），平衡实时性和数据库负载
  interval: 2000
  
  # 固定分片数量（用于分片处理）
  # 例如：3个应用实例，可以设置10个分片，每个应用实例处理3-4个分片
  # 分片数量固定后，查询可以使用索引，性能更好
  shard-count: 10
  
  # 节点注册配置（固定分片模式，一个应用一个节点）
  # DB + Redis混合方案（分离心跳频率）：
  # - DB：存储节点元数据（IP、端口、状态等），作为配置中心，节点索引按id desc排序保证稳定性
  #   - DB心跳频率：每10秒更新一次（减少DB写压力）
  # - Redis：存储心跳时间戳，用于快速检测节点是否存活，自动过期
  #   - Redis心跳频率：每2秒更新一次（快速检测，与outbox扫描频率一致）
  # - 查询策略：从DB查询节点列表，用Redis心跳过滤，如果Redis不可用则降级到DB的expired_time判断
  node-registry:
    # DB心跳间隔（秒），节点定期更新DB心跳的时间间隔（默认10秒）
    # Redis心跳频率与outbox扫描频率一致（interval，默认2秒）
    heartbeat-interval: 10
    # 心跳超时时间（秒），超过此时间未心跳的节点将被移除
    heartbeat-timeout: 30
    # 清理过期节点的时间间隔（毫秒），默认60秒
    cleanup-interval: 60000
  
  # 节点状态打印间隔（毫秒），定时打印节点状态信息，默认30秒
  node-status-print-interval: 30000
  
  # 线程池配置
  thread-pool:
    # 核心线程数（默认5）
    core-size: 5
    # 最大线程数（默认10）
    max-size: 10
    # 队列容量（默认100）
    queue-capacity: 100
    # 线程保活时间（秒，默认60）
    keep-alive-seconds: 60