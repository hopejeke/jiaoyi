# æ”¯ä»˜å®äºŒç»´ç æ”¯ä»˜åŠŸèƒ½è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆæ”¯ä»˜å®äºŒç»´ç æ”¯ä»˜åŠŸèƒ½ï¼Œæ”¯æŒåˆ›å»ºè®¢å•åç”Ÿæˆæ”¯ä»˜å®æ”¯ä»˜äºŒç»´ç ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨æ”¯ä»˜å®æ‰«ç å®Œæˆæ”¯ä»˜ã€‚

## ğŸš€ ä¸»è¦åŠŸèƒ½

### 1. è®¢å•åˆ›å»º
- ç”¨æˆ·æäº¤è®¢å•ä¿¡æ¯ï¼ˆå•†å“ã€æ”¶è´§åœ°å€ç­‰ï¼‰
- ç³»ç»Ÿè‡ªåŠ¨é”å®šåº“å­˜
- ç”Ÿæˆè®¢å•å·å’Œæ”¯ä»˜æµæ°´å·

### 2. æ”¯ä»˜å®äºŒç»´ç ç”Ÿæˆ
- è°ƒç”¨æ”¯ä»˜å®é¢„ä¸‹å•API
- ç”Ÿæˆæ”¯ä»˜äºŒç»´ç 
- è¿”å›äºŒç»´ç å†…å®¹å’Œæ”¯ä»˜ä¿¡æ¯

### 3. æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢
- å®æ—¶æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
- æ”¯æŒæ”¯ä»˜æˆåŠŸã€å¾…æ”¯ä»˜ã€æ”¯ä»˜å¤±è´¥ç­‰çŠ¶æ€
- è‡ªåŠ¨æ›´æ–°è®¢å•çŠ¶æ€

## ğŸ“‹ ä½¿ç”¨æµç¨‹

### 1. å¯åŠ¨åº”ç”¨
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
test-alipay-qr.bat

# æˆ–æ‰‹åŠ¨å¯åŠ¨
mvn clean compile -U -s settings.xml
mvn spring-boot:run -s settings.xml
```

### 2. è®¿é—®æµ‹è¯•é¡µé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8080/alipay-qr-test.html`

### 3. æµ‹è¯•æ”¯ä»˜æµç¨‹
1. **åˆ›å»ºè®¢å•**ï¼šå¡«å†™è®¢å•ä¿¡æ¯ï¼Œç‚¹å‡»"åˆ›å»ºè®¢å•"
2. **æ”¯ä»˜è®¢å•**ï¼šç‚¹å‡»"æ”¯ä»˜è®¢å•"ï¼Œç³»ç»Ÿç”Ÿæˆæ”¯ä»˜å®äºŒç»´ç 
3. **æ‰«ç æ”¯ä»˜**ï¼šä½¿ç”¨æ”¯ä»˜å®æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜
4. **æŸ¥è¯¢çŠ¶æ€**ï¼šç‚¹å‡»"æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€"æŸ¥çœ‹æ”¯ä»˜ç»“æœ

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

#### 1. AlipayService.java
```java
@Service
public class AlipayService {
    // åˆ›å»ºæ”¯ä»˜è®¢å•å¹¶ç”ŸæˆäºŒç»´ç 
    public PaymentResponse createPayment(String orderNo, String subject, BigDecimal amount, String paymentNo)
    
    // æŸ¥è¯¢æ”¯ä»˜ç»“æœ
    public PaymentResponse queryPayment(String paymentNo)
}
```

#### 2. æ”¯ä»˜å®é…ç½®
```yaml
alipay:
  app-id: 9021000136674240  # æ²™ç®±åº”ç”¨ID
  private-key: MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC5j8qV+Z6S7V8K
  alipay-public-key: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2b9kSu8+SPk4DQj3BJG9
  gateway-url: https://openapi.alipaydev.com/gateway.do  # æ²™ç®±ç¯å¢ƒ
  notify-url: http://localhost:8080/api/payment/alipay/notify
  return-url: http://localhost:8080/api/payment/alipay/return
```

#### 3. æ”¯ä»˜å“åº”DTO
```java
public class PaymentResponse {
    private String paymentNo;        // æ”¯ä»˜æµæ°´å·
    private String status;          // æ”¯ä»˜çŠ¶æ€
    private String paymentMethod;   // æ”¯ä»˜æ–¹å¼
    private BigDecimal amount;      // æ”¯ä»˜é‡‘é¢
    private String qrCode;          // äºŒç»´ç å†…å®¹
    private String payUrl;          // æ”¯ä»˜URL
    private String remark;          // å¤‡æ³¨
}
```

## ğŸ“± APIæ¥å£

### 1. åˆ›å»ºè®¢å•
```http
POST /orders
Content-Type: application/json

{
  "userId": 94,
  "receiverName": "å¼ ä¸‰",
  "receiverPhone": "13800138000",
  "receiverAddress": "åŒ—äº¬å¸‚æœé˜³åŒºæµ‹è¯•è¡—é“123å·",
  "orderItems": [{
    "productId": 2002,
    "productName": "æµ‹è¯•å•†å“",
    "unitPrice": 100.00,
    "quantity": 1
  }]
}
```

### 2. æ”¯ä»˜è®¢å•
```http
POST /orders/{orderId}/pay
Content-Type: application/json

{
  "paymentMethod": "ALIPAY",
  "amount": 10000,
  "channel": "WEB",
  "clientIp": "127.0.0.1",
  "userAgent": "Mozilla/5.0...",
  "remark": "æ”¯ä»˜å®äºŒç»´ç æ”¯ä»˜"
}
```

### 3. æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
```http
GET /api/payment/query/{paymentNo}
```

## ğŸ” å“åº”ç¤ºä¾‹

### æ”¯ä»˜è®¢å•å“åº”
```json
{
  "success": true,
  "message": "æ”¯ä»˜å¤„ç†æˆåŠŸ",
  "data": {
    "paymentNo": "PAY1703123456789ABCDEFGH",
    "status": "PENDING",
    "paymentMethod": "ALIPAY",
    "amount": 10000,
    "qrCode": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
    "remark": "æ”¯ä»˜å®æ”¯ä»˜è®¢å•åˆ›å»ºæˆåŠŸï¼Œè¯·æ‰«ç æ”¯ä»˜"
  }
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ²™ç®±ç¯å¢ƒ
- å½“å‰é…ç½®ä¸ºæ”¯ä»˜å®æ²™ç®±ç¯å¢ƒ
- ä½¿ç”¨æ²™ç®±æµ‹è¯•è´¦å·è¿›è¡Œæ”¯ä»˜æµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒéœ€è¦æ›´æ¢ä¸ºæ­£å¼é…ç½®

### 2. å¯†é’¥é…ç½®
- å½“å‰ä½¿ç”¨ç¤ºä¾‹å¯†é’¥ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦æ›¿æ¢
- ç¡®ä¿å¯†é’¥æ ¼å¼æ­£ç¡®ï¼ˆåŒ…å«æ¢è¡Œç¬¦ï¼‰
- å®šæœŸæ›´æ–°å¯†é’¥ä»¥ä¿è¯å®‰å…¨

### 3. å›è°ƒå¤„ç†
- æ”¯ä»˜æˆåŠŸåä¼šæ”¶åˆ°æ”¯ä»˜å®å›è°ƒ
- éœ€è¦éªŒè¯å›è°ƒç­¾åç¡®ä¿å®‰å…¨æ€§
- å®ç°å¹‚ç­‰æ€§å¤„ç†é¿å…é‡å¤å›è°ƒ

## ğŸ› ï¸ å¼€å‘è°ƒè¯•

### 1. æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/jiaoyi.log
```

### 2. æ•°æ®åº“çŠ¶æ€
```sql
-- æŸ¥çœ‹è®¢å•çŠ¶æ€
SELECT * FROM orders ORDER BY create_time DESC LIMIT 10;

-- æŸ¥çœ‹åº“å­˜å˜åŒ–
SELECT * FROM inventory WHERE product_id = 2002;
```

### 3. æ”¯ä»˜å®æ²™ç®±
- æ²™ç®±ç¯å¢ƒï¼šhttps://openapi.alipaydev.com/
- æµ‹è¯•è´¦å·ï¼šä½¿ç”¨æ”¯ä»˜å®æä¾›çš„æ²™ç®±ä¹°å®¶è´¦å·
- æ”¯ä»˜å¯†ç ï¼šæ²™ç®±ç¯å¢ƒæä¾›çš„æµ‹è¯•å¯†ç 

## ğŸ‰ åŠŸèƒ½ç‰¹ç‚¹

1. **å®Œæ•´çš„æ”¯ä»˜æµç¨‹**ï¼šä»è®¢å•åˆ›å»ºåˆ°æ”¯ä»˜å®Œæˆçš„å®Œæ•´é“¾è·¯
2. **äºŒç»´ç ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆæ”¯ä»˜å®æ”¯ä»˜äºŒç»´ç 
3. **çŠ¶æ€æŸ¥è¯¢**ï¼šå®æ—¶æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
4. **åº“å­˜ç®¡ç†**ï¼šæ”¯ä»˜å‰é”å®šåº“å­˜ï¼Œæ”¯ä»˜åæ‰£å‡åº“å­˜
5. **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æç¤º
6. **æµ‹è¯•å‹å¥½**ï¼šæä¾›å®Œæ•´çš„æµ‹è¯•é¡µé¢å’ŒAPI

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. åº”ç”¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
2. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
3. æ”¯ä»˜å®é…ç½®æ˜¯å¦æ­£ç¡®
4. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

---

**ğŸ¯ ç°åœ¨æ‚¨å¯ä»¥è¿è¡Œ `test-alipay-qr.bat` å¯åŠ¨åº”ç”¨ï¼Œç„¶åè®¿é—® `http://localhost:8080/alipay-qr-test.html` æµ‹è¯•æ”¯ä»˜å®äºŒç»´ç æ”¯ä»˜åŠŸèƒ½ï¼**


