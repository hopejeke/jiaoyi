<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿæµ‹è¯•ä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }
        
        .test-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-card p {
            color: #7f8c8d;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .test-btn.secondary {
            background: #6c757d;
        }
        
        .test-btn.secondary:hover {
            background: #5a6268;
        }
        
        .result-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .result-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .result {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            border-left: 4px solid #667eea;
        }
        
        .result.error {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }
        
        .result.success {
            border-left-color: #27ae60;
            background: #f0f9f0;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .test-card {
                padding: 20px;
            }
            
            .test-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª ç³»ç»Ÿæµ‹è¯•ä¸­å¿ƒ</h1>
            <p>ä¸€ç«™å¼æµ‹è¯•æ‰€æœ‰ç³»ç»ŸåŠŸèƒ½</p>
        </div>
        
        <div class="test-grid">
            <!-- å•†å“æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ›ï¸ å•†å“åŠŸèƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•å•†å“ç›¸å…³çš„æ‰€æœ‰APIæ¥å£ï¼ŒåŒ…æ‹¬å•†å“åˆ—è¡¨ã€æœç´¢ã€è¯¦æƒ…ç­‰åŠŸèƒ½</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testGetAllProducts()">è·å–æ‰€æœ‰å•†å“</button>
                    <button class="test-btn" onclick="testGetProductCount()">å•†å“ç»Ÿè®¡</button>
                    <a href="product-list.html" class="test-btn secondary" target="_blank">å•†å“åˆ—è¡¨é¡µ</a>
                </div>
                <div class="input-group">
                    <label>æœç´¢å•†å“:</label>
                    <input type="text" id="searchInput" placeholder="è¾“å…¥å•†å“åç§°">
                    <button class="test-btn" onclick="testSearchProducts()" style="margin-top: 10px; width: 100%;">æœç´¢</button>
                </div>
                <div class="input-group">
                    <label>å•†å“ID:</label>
                    <input type="number" id="productIdInput" placeholder="è¾“å…¥å•†å“ID">
                    <button class="test-btn" onclick="testGetProductById()" style="margin-top: 10px; width: 100%;">è·å–è¯¦æƒ…</button>
                </div>
            </div>
            
            <!-- è®¢å•æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ“¦ è®¢å•åŠŸèƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•è®¢å•åˆ›å»ºã€æŸ¥è¯¢ã€å–æ¶ˆç­‰æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testGetAllOrders()">è·å–æ‰€æœ‰è®¢å•</button>
                    <button class="test-btn" onclick="testCreateOrder()">åˆ›å»ºæµ‹è¯•è®¢å•</button>
                    <a href="orders.html" class="test-btn secondary" target="_blank">è®¢å•ç®¡ç†é¡µ</a>
                </div>
                <div class="input-group">
                    <label>è®¢å•ID:</label>
                    <input type="number" id="orderIdInput" placeholder="è¾“å…¥è®¢å•ID">
                    <button class="test-btn" onclick="testGetOrderById()" style="margin-top: 10px; width: 100%;">è·å–è®¢å•è¯¦æƒ…</button>
                </div>
            </div>
            
            <!-- æ”¯ä»˜æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ’³ æ”¯ä»˜åŠŸèƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•æ”¯ä»˜å®æ”¯ä»˜ã€æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢ç­‰æ”¯ä»˜ç›¸å…³åŠŸèƒ½</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testCreatePayment()">åˆ›å»ºæ”¯ä»˜</button>
                    <button class="test-btn" onclick="testQueryPayment()">æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€</button>
                    <a href="payment.html" class="test-btn secondary" target="_blank">æ”¯ä»˜ä¸­å¿ƒ</a>
                </div>
                <div class="input-group">
                    <label>è®¢å•å·:</label>
                    <input type="text" id="paymentOrderNoInput" placeholder="è¾“å…¥è®¢å•å·">
                    <button class="test-btn" onclick="testQueryPaymentByOrderNo()" style="margin-top: 10px; width: 100%;">æŸ¥è¯¢æ”¯ä»˜</button>
                </div>
            </div>
            
            <!-- ä¼˜æƒ åˆ¸æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ« ä¼˜æƒ åˆ¸åŠŸèƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•ä¼˜æƒ åˆ¸éªŒè¯ã€è®¡ç®—ã€ä½¿ç”¨ç­‰ä¼˜æƒ åˆ¸ç›¸å…³åŠŸèƒ½</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testGetAllCoupons()">è·å–æ‰€æœ‰ä¼˜æƒ åˆ¸</button>
                    <button class="test-btn" onclick="testValidateCoupon()">éªŒè¯ä¼˜æƒ åˆ¸</button>
                    <button class="test-btn" onclick="testCalculateDiscount()">è®¡ç®—ä¼˜æƒ é‡‘é¢</button>
                </div>
                <div class="input-group">
                    <label>ä¼˜æƒ åˆ¸ä»£ç :</label>
                    <input type="text" id="couponCodeInput" placeholder="è¾“å…¥ä¼˜æƒ åˆ¸ä»£ç " value="NEWUSER100">
                    <button class="test-btn" onclick="testGetCouponByCode()" style="margin-top: 10px; width: 100%;">è·å–ä¼˜æƒ åˆ¸</button>
                </div>
            </div>
            
            <!-- åº“å­˜æµ‹è¯• -->
            <div class="test-card">
                <h3>ğŸ“Š åº“å­˜åŠŸèƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•åº“å­˜æŸ¥è¯¢ã€é”å®šã€é‡Šæ”¾ç­‰åº“å­˜ç®¡ç†åŠŸèƒ½</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testGetAllInventory()">è·å–æ‰€æœ‰åº“å­˜</button>
                    <button class="test-btn" onclick="testCheckStock()">æ£€æŸ¥åº“å­˜</button>
                    <a href="inventory-cache-test.html" class="test-btn secondary" target="_blank">åº“å­˜ç¼“å­˜æµ‹è¯•</a>
                </div>
                <div class="input-group">
                    <label>å•†å“ID:</label>
                    <input type="number" id="inventoryProductIdInput" placeholder="è¾“å…¥å•†å“ID">
                    <button class="test-btn" onclick="testGetInventoryByProductId()" style="margin-top: 10px; width: 100%;">æŸ¥è¯¢åº“å­˜</button>
                </div>
            </div>
            
            <!-- è¶…æ—¶æµ‹è¯• -->
            <div class="test-card">
                <h3>â° è¶…æ—¶å¤„ç†æµ‹è¯•</h3>
                <p>æµ‹è¯•è®¢å•è¶…æ—¶å¤„ç†ã€å»¶è¿Ÿæ¶ˆæ¯ç­‰é«˜çº§åŠŸèƒ½</p>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testOrderTimeoutFallback()">å…œåº•ä»»åŠ¡æµ‹è¯•</button>
                    <button class="test-btn" onclick="testOrderTimeoutMQ()">MQå»¶è¿Ÿæ¶ˆæ¯æµ‹è¯•</button>
                    <button class="test-btn" onclick="testOrderTimeoutRocketMQ()">RocketMQæµ‹è¯•</button>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•ç»“æœåŒºåŸŸ -->
        <div class="result-section">
            <h3>ğŸ“‹ æµ‹è¯•ç»“æœ</h3>
            <div id="testResult" class="result hidden">æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>
    </div>

    <script>
        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showResult(data, isError = false) {
            const resultDiv = document.getElementById('testResult');
            resultDiv.classList.remove('hidden');
            resultDiv.className = `result ${isError ? 'error' : 'success'}`;
            resultDiv.textContent = JSON.stringify(data, null, 2);
        }
        
        // å•†å“æµ‹è¯•å‡½æ•°
        async function testGetAllProducts() {
            try {
                const response = await fetch('/api/products');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testGetProductCount() {
            try {
                const response = await fetch('/api/products/count');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testSearchProducts() {
            const searchTerm = document.getElementById('searchInput').value;
            if (!searchTerm) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            try {
                const response = await fetch(`/api/products/search?name=${encodeURIComponent(searchTerm)}`);
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testGetProductById() {
            const productId = document.getElementById('productIdInput').value;
            if (!productId) {
                alert('è¯·è¾“å…¥å•†å“ID');
                return;
            }
            try {
                const response = await fetch(`/api/products/${productId}`);
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        // è®¢å•æµ‹è¯•å‡½æ•°
        async function testGetAllOrders() {
            try {
                const response = await fetch('/api/orders');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testCreateOrder() {
            const orderData = {
                userId: 1001,
                receiverName: "æµ‹è¯•ç”¨æˆ·",
                receiverPhone: "13800138000",
                receiverAddress: "æµ‹è¯•åœ°å€",
                remark: "æµ‹è¯•è®¢å•",
                orderItems: [{
                    productId: 1,
                    productName: "æµ‹è¯•å•†å“",
                    productImage: "https://example.com/test.jpg",
                    unitPrice: 100.00,
                    quantity: 1
                }]
            };
            
            try {
                const response = await fetch('/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testGetOrderById() {
            const orderId = document.getElementById('orderIdInput').value;
            if (!orderId) {
                alert('è¯·è¾“å…¥è®¢å•ID');
                return;
            }
            try {
                const response = await fetch(`/api/orders/${orderId}`);
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        // æ”¯ä»˜æµ‹è¯•å‡½æ•°
        async function testCreatePayment() {
            const paymentData = {
                orderNo: "TEST" + Date.now(),
                amount: 100.00,
                subject: "æµ‹è¯•æ”¯ä»˜"
            };
            
            try {
                const response = await fetch('/api/payment/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(paymentData)
                });
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testQueryPayment() {
            try {
                const response = await fetch('/api/payment/query/TEST123');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testQueryPaymentByOrderNo() {
            const orderNo = document.getElementById('paymentOrderNoInput').value;
            if (!orderNo) {
                alert('è¯·è¾“å…¥è®¢å•å·');
                return;
            }
            try {
                const response = await fetch(`/api/payment/query/${orderNo}`);
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        // ä¼˜æƒ åˆ¸æµ‹è¯•å‡½æ•°
        async function testGetAllCoupons() {
            try {
                const response = await fetch('/api/coupons');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testValidateCoupon() {
            const validationData = {
                couponCode: "NEWUSER100",
                userId: 1001,
                orderAmount: 1000.00,
                productIds: [1, 2, 3]
            };
            
            try {
                const response = await fetch('/api/coupons/validate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(validationData)
                });
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testCalculateDiscount() {
            const calculationData = {
                couponId: 1,
                orderAmount: 1000.00
            };
            
            try {
                const response = await fetch('/api/coupons/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(calculationData)
                });
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testGetCouponByCode() {
            const couponCode = document.getElementById('couponCodeInput').value;
            if (!couponCode) {
                alert('è¯·è¾“å…¥ä¼˜æƒ åˆ¸ä»£ç ');
                return;
            }
            try {
                const response = await fetch(`/api/coupons/code/${couponCode}`);
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        // åº“å­˜æµ‹è¯•å‡½æ•°
        async function testGetAllInventory() {
            try {
                const response = await fetch('/api/inventory');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testCheckStock() {
            const checkData = {
                productId: 1,
                quantity: 1
            };
            
            try {
                const response = await fetch('/api/inventory/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(checkData)
                });
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testGetInventoryByProductId() {
            const productId = document.getElementById('inventoryProductIdInput').value;
            if (!productId) {
                alert('è¯·è¾“å…¥å•†å“ID');
                return;
            }
            try {
                const response = await fetch(`/api/inventory/product/${productId}`);
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        // è¶…æ—¶æµ‹è¯•å‡½æ•°
        async function testOrderTimeoutFallback() {
            try {
                const response = await fetch('/api/order-timeout/fallback/test');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testOrderTimeoutMQ() {
            try {
                const response = await fetch('/api/order-timeout/mq/test');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
        
        async function testOrderTimeoutRocketMQ() {
            try {
                const response = await fetch('/api/order-timeout/rocketmq/test');
                const result = await response.json();
                showResult(result);
            } catch (error) {
                showResult({ error: error.message }, true);
            }
        }
    </script>
</body>
</html>
