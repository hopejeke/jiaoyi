# Server配置
server.port=8082
server.servlet.context-path=/

# Spring应用配置
spring.application.name=order-service

# 普通数据源配置（用于 jiaoyi 数据库，存放 outbox_node 和 outbox 表）
spring.datasource.url=jdbc:mysql://localhost:3306/jiaoyi?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# ShardingSphere分库分表配置（使用5.4.1版本，通过Java API手动配置）
# 配置在 src/main/java/com/jiaoyi/order/config/ShardingSphereConfig.java 文件中
# ShardingSphere 只负责分片表（orders、order_items、order_coupons、coupon_usage），不负责 outbox_node 和 outbox 表

# Redis配置
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.database=0
spring.data.redis.timeout=5000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0
spring.data.redis.lettuce.pool.max-wait=-1ms

# 日志配置
logging.level.com.jiaoyi.order=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.com.jiaoyi.order.mapper=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/order-service.log

# 管理端点配置
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always

# MyBatis配置
mybatis.mapper-locations=classpath*:mapper/**/*.xml

# RocketMQ配置
rocketmq.name-server=localhost:9876
rocketmq.producer.group=order-timeout-producer-group
rocketmq.producer.send-message-timeout=3000
rocketmq.producer.retry-times-when-send-failed=2
rocketmq.consumer.group=order-timeout-consumer-group

# 订单超时配置
order.timeout.minutes=40
order.timeout.fallback.enabled=true
order.timeout.fallback.interval=300000

# Outbox配置
outbox.interval=2000
outbox.shard-count=10
outbox.node-registry.heartbeat-interval=10
outbox.node-registry.heartbeat-timeout=30
outbox.node-registry.cleanup-interval=60000
outbox.node-status-print-interval=300000
outbox.thread-pool.core-size=5
outbox.thread-pool.max-size=10
outbox.thread-pool.queue-capacity=100
outbox.thread-pool.keep-alive-seconds=60

# 支付宝配置
# 注意：请使用环境变量或本地配置文件来设置敏感信息，不要提交到代码仓库
alipay.app-id=${ALIPAY_APP_ID:9021000157614744}
alipay.private-key=${ALIPAY_PRIVATE_KEY:}
alipay.alipay-public-key=${ALIPAY_PUBLIC_KEY:}
alipay.gateway-url=https://openapi-sandbox.dl.alipaydev.com/gateway.do
alipay.sign-type=RSA2
alipay.charset=UTF-8
alipay.format=JSON
alipay.notify-url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify
alipay.return-url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return

# Stripe 配置
# 注意：请使用环境变量或本地配置文件来设置敏感信息，不要提交到代码仓库
# 测试环境：从 https://dashboard.stripe.com/test/apikeys 获取
# 生产环境：从 https://dashboard.stripe.com/apikeys 获取
# 
# 获取步骤：
# 1. 访问 https://dashboard.stripe.com/register 注册账户（或登录）
# 2. 确保在 "Test mode"（测试模式）
# 3. 进入 Developers → API keys
# 4. 复制 Publishable key 和 Secret key
# 5. 设置环境变量或创建本地配置文件（不提交到 Git）
#
# 环境变量示例：
# export STRIPE_SECRET_KEY=sk_test_...
# export STRIPE_PUBLISHABLE_KEY=pk_test_...
# export STRIPE_WEBHOOK_SECRET=whsec_...
stripe.enabled=true
stripe.secret-key=${STRIPE_SECRET_KEY:}
stripe.publishable-key=${STRIPE_PUBLISHABLE_KEY:}
stripe.webhook-secret=${STRIPE_WEBHOOK_SECRET:}

# Stripe Connect 平台手续费配置（默认值，可在商户配置中覆盖）
stripe.connect.application-fee-percentage=2.5
stripe.connect.application-fee-fixed=0.30
stripe.connect.amex-application-fee-percentage=3.5
stripe.connect.amex-application-fee-fixed=0.30

# 微服务调用配置
# 商品服务地址
product.service.url=http://localhost:8081
# 优惠券服务地址
coupon.service.url=http://localhost:8083

# DoorDash 配置
# 注意：如果没有 DoorDash API 凭证，系统会自动使用 Mock 模式
# 设置 doordash.mock.enabled=true 强制启用 Mock 模式
doordash.mock.enabled=true
doordash.mock.delivery-fee-base=5.00
doordash.mock.delivery-fee-per-km=1.50
# DoorDash API 配置（当有真实 API Key 时，设置 doordash.mock.enabled=false）
doordash.api.base-url=https://openapi.doordash.com
doordash.api.key=
doordash.api.secret=

