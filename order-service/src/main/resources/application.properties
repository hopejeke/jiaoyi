# Server配置
server.port=8082
server.servlet.context-path=/

# Spring应用配置
spring.application.name=order-service

# Nacos 服务发现配置
spring.cloud.nacos.discovery.server-addr=${NACOS_SERVER_ADDR:127.0.0.1:8848}
spring.cloud.nacos.discovery.namespace=${NACOS_NAMESPACE:}
spring.cloud.nacos.discovery.group=${NACOS_GROUP:DEFAULT_GROUP}
spring.cloud.nacos.discovery.enabled=true

# 普通数据源配置（用于 jiaoyi 数据库，存放日志表等非分片表）
spring.datasource.url=jdbc:mysql://localhost:3306/jiaoyi?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# ShardingSphere分库分表配置（使用5.4.1版本，通过Java API手动配置）
# 配置在 src/main/java/com/jiaoyi/order/config/ShardingSphereConfig.java 文件中
# ShardingSphere 负责分片表（orders、order_items、order_coupons、coupon_usage、outbox 等）

# 雪花算法配置
# worker-id: 工作机器ID（0-1023），用于生成全局唯一ID
# 如果不配置，ShardingSphere 会自动生成（可能基于进程ID或网络地址）
# 多实例部署时，建议为每个实例配置不同的 worker-id，避免ID冲突
shardingsphere.snowflake.worker-id=${SNOWFLAKE_WORKER_ID:}

# Redis配置
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.database=0
spring.data.redis.timeout=5000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0
spring.data.redis.lettuce.pool.max-wait=-1ms

# 日志配置
logging.level.com.jiaoyi.order=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.com.jiaoyi.order.mapper=DEBUG
# outbox 使用 JdbcTemplate 实现，不再需要 Mapper 日志配置
# outbox_node 已删除，不再需要相关日志配置
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/order-service.log

# 管理端点配置
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always

# MyBatis配置
mybatis.mapper-locations=classpath*:mapper/**/*.xml

# RocketMQ配置
rocketmq.name-server=localhost:9876
rocketmq.producer.group=order-timeout-producer-group
rocketmq.producer.send-message-timeout=3000
rocketmq.producer.retry-times-when-send-failed=2
rocketmq.consumer.group=order-timeout-consumer-group

# 订单超时配置
order.timeout.minutes=40
order.timeout.fallback.enabled=true
order.timeout.fallback.interval=300000

# DoorDash 重试配置
doordash.retry.enabled=true
doordash.retry.max-count=3
doordash.retry.interval-minutes=5
doordash.retry.schedule-interval=300000

# Outbox配置
# Outbox 表配置（分库不分表，表名固定为 outbox，ShardingSphere 会根据 shard_id 路由到 jiaoyi_0/1/2）
outbox.table=outbox
outbox.interval=2000
outbox.shard-count=10
outbox.node-registry.heartbeat-interval=10
outbox.node-registry.heartbeat-timeout=30
outbox.node-registry.cleanup-interval=60000
outbox.node-status-print-interval=300000
outbox.thread-pool.core-size=5
outbox.thread-pool.max-size=10
outbox.thread-pool.queue-capacity=100
outbox.thread-pool.keep-alive-seconds=60

# 支付宝配置
# 注意：请使用环境变量或本地配置文件来设置敏感信息，不要提交到代码仓库
alipay.app-id=${ALIPAY_APP_ID:9021000157614744}
alipay.private-key=${ALIPAY_PRIVATE_KEY:}
alipay.alipay-public-key=${ALIPAY_PUBLIC_KEY:}
alipay.gateway-url=https://openapi-sandbox.dl.alipaydev.com/gateway.do
alipay.sign-type=RSA2
alipay.charset=UTF-8
alipay.format=JSON
alipay.notify-url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/notify
alipay.return-url=https://dorotha-gloomful-elfrieda.ngrok-free.dev/api/payment/alipay/return

# Stripe 配置
# 注意：请使用环境变量或本地配置文件来设置敏感信息，不要提交到代码仓库
# 测试环境：从 https://dashboard.stripe.com/test/apikeys 获取
# 生产环境：从 https://dashboard.stripe.com/apikeys 获取
# 
# 获取步骤：
# 1. 访问 https://dashboard.stripe.com/register 注册账户（或登录）
# 2. 确保在 "Test mode"（测试模式）
# 3. 进入 Developers → API keys
# 4. 复制 Publishable key 和 Secret key
# 5. 设置环境变量或创建本地配置文件（不提交到 Git）
#
# 环境变量示例：
# export STRIPE_SECRET_KEY=sk_test_...
# export STRIPE_PUBLISHABLE_KEY=pk_test_...
# export STRIPE_WEBHOOK_SECRET=whsec_...
stripe.enabled=true

stripe.webhook-secret=${STRIPE_WEBHOOK_SECRET:}

# Stripe Connect 平台手续费配置（默认值，可在商户配置中覆盖）
stripe.connect.application-fee-percentage=2.5
stripe.connect.application-fee-fixed=0.30
stripe.connect.amex-application-fee-percentage=3.5
stripe.connect.amex-application-fee-fixed=0.30

# 微服务调用配置（通过 Nacos 服务发现，不再需要硬编码 URL）
# 保留这些配置作为备用，如果 Nacos 不可用可以回退到直接 URL
product.service.url=http://localhost:8081
coupon.service.url=http://localhost:8083

# DoorDash 配置
# 注意：如果没有 DoorDash API 凭证，系统会自动使用 Mock 模式
# 设置 doordash.mock.enabled=true 强制启用 Mock 模式
doordash.mock.enabled=true
doordash.mock.delivery-fee-base=5.00
doordash.mock.delivery-fee-per-km=1.50
# DoorDash API 配置（当有真实 API Key 时，设置 doordash.mock.enabled=false）
doordash.api.base-url=https://openapi.doordash.com
doordash.api.key=
doordash.api.secret=
stripe.secret-key=sk_test_51ScdSXCT67yEvdCoNLORRfCDLwhv38MNJBv3cycNJ9Spa3ivwOITdQ7cjKxokqt5N9WkBDjqLh8b4yvISnWS7Xrp00Ubv3YGz5
stripe.publishable-key=pk_test_51ScdSXCT67yEvdCoRnRLzFEJIXBEDTe943LZAxYjpSHNonXZFFKglRSLsHNn60QeYJFWtlUEUOhPmuK86ARCnAnC00cPio5gYN

# 限流配置（使用 Guava RateLimiter）
# 下单接口限流速率（每秒允许的请求数）
rate.limit.order.create=1000
# 退款接口限流速率（每秒允许的请求数）
rate.limit.refund.create=5

